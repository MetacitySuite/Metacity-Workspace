(this["webpackJsonpmetaworkspace-react"]=this["webpackJsonpmetaworkspace-react"]||[]).push([[0],{150:function(e,t,n){},292:function(e,t,n){"use strict";n.r(t);var i=n(2),a=n.n(i),r=n(44),s=n.n(r),o=n(142),c=n(43),l=n(27),d=(n(150),n(151),"/app"),u="/app/login",h="/app/view/:project_name",f="/app/view/",m="/app/projects/:project_name?",p="/app/projects/",v="/app/jobs",b="/app/upload/:project_name",g="/app/upload/",j="/app/style/:project_name/:style_name",y="/app/style/",O="/app/mapping/:project_name",x="/app/mapping/",_="/api/projects",w="/api/project",k="/api/project/rename",S="/api/project",L="/api/project/build",C="/api/project/meta",M="/api/layers",D="/api/layer",N="/api/layer/rename",I="/api/layer",E="/api/layer/enable",A="/api/layer/disable",z="/api/layer/map",T="/api/jobs",P="/api/logs",R="/api/log",F="/auth/user",U="/auth/token",B="/api/styles",V="/api/style",H="/api/style/create",G="/api/style/update",W="/api/style",K="/api/style/rename",X="/api/style/apply",Y="/api/style/parse",J=n(10),$=n(50),Z=n(294),q=n(59),Q=n(78),ee=n.n(Q);var te=ee.a.create({});!function(){var e=localStorage.getItem("JWT");te.defaults.headers.common.Authorization=null===e?null:"Bearer ".concat(e)}();var ne=te,ie=n(33),ae=n(314),re=n(7),se=function(e){return Object(re.jsx)(ae.a,Object(ie.a)({is:c.b},e))};function oe(e){return Object(re.jsxs)($.a,{className:"header",children:[Object(re.jsx)(se,{to:d,className:"headerLink ".concat(e.home?"selected":""),children:"Home"}),Object(re.jsx)(se,{to:p,className:"headerLink ".concat(e.projects?"selected":""),children:"Projects"}),Object(re.jsx)(se,{to:v,className:"headerLink ".concat(e.jobs?"selected":""),children:"Jobs & Logs"})]})}function ce(){var e=Object(i.useState)([]),t=Object(J.a)(e,2),n=t[0],a=t[1],r=Object(l.g)();return Object(i.useEffect)((function(){return ne.get(_).then((function(e){a(e.data)})),function(){a([])}}),[]),Object(re.jsx)(re.Fragment,{children:Object(re.jsxs)($.a,{className:"home",children:[Object(re.jsx)(Z.a,{className:"homeHeading",children:"Metacity"}),Object(re.jsx)($.a,{className:"homeProjectList",children:n.map((function(e,t){return Object(re.jsx)(q.a,{height:48,appearance:"minimal",onClick:function(){return r.push(f+e)},children:e},t)}))}),Object(re.jsx)(se,{to:p,className:"homeNav",children:"Go to Controls"})]})})}var le=n(361),de=n(336),ue=n(323),he=n(324),fe=n(325),me=n(326),pe=n(327),ve=n(328),be=n(329),ge=n(315),je=n(356),ye=n(296),Oe=n(321),xe=n(360);function _e(e){var t=Object(i.createRef)(),n=Object(i.useState)(!1),a=Object(J.a)(n,2),r=a[0],s=a[1],o=Object(i.useState)(!1),c=Object(J.a)(o,2),l=c[0],d=c[1],u=Object(i.useState)(""),h=Object(J.a)(u,2),f=h[0],m=h[1],p=function(n){var i;n&&n.preventDefault();var a=null===(i=t.current)||void 0===i?void 0:i.value;if(a){var r=e.submitBody(a);ne[e.method](e.submitUrl,r).then((function(){t.current&&(t.current.value=""),s(!1),e.onSubmit(a)})).catch((function(t){var n=e.onError(t,a);d(!0),m(n)}))}};return Object(i.useEffect)((function(){m(""),d(!1)}),[r]),Object(re.jsxs)(re.Fragment,{children:[Object(re.jsx)(ge.a,{isShown:r,title:e.title,onConfirm:function(){return p()},onCloseComplete:function(){return s(!1)},confirmLabel:e.confirmLabel,children:Object(re.jsx)("form",{className:"dialogForm",onSubmit:p,children:l?Object(re.jsx)(je.a,{name:"name",label:e.label,description:e.description,placeholder:e.placeholder,ref:t,isInvalid:l,validationMessage:f}):Object(re.jsx)(je.a,{name:"name",label:e.label,description:e.description,placeholder:e.placeholder,ref:t})})}),Object(i.cloneElement)(e.children,{onClick:function(){return s(!0)}})]})}function we(e){var t=Object(i.useState)(!1),n=Object(J.a)(t,2),a=n[0],r=n[1],s=Object(i.useState)(!1),o=Object(J.a)(s,2),c=o[0],l=o[1],d=Object(i.useState)(""),u=Object(J.a)(d,2),h=u[0],f=u[1];return Object(i.useEffect)((function(){f(""),l(!1)}),[a]),Object(re.jsxs)(re.Fragment,{children:[Object(re.jsxs)(ge.a,{isShown:a,intent:e.intent?e.intent:"none",title:e.title,onConfirm:function(){try{var t=e.submitBody();ne[e.method](e.submitUrl,t).then((function(){r(!1),e.onSubmit()})).catch((function(t){var n=e.onError(t);l(!0),f(n)}))}catch(h){l(!0),f(h)}},onCloseComplete:function(){return r(!1)},confirmLabel:e.confirmLabel,children:[Object(re.jsx)(ye.a,{children:e.label}),c?Object(re.jsx)(Oe.a,{intent:"danger",marginTop:16,children:h}):""]}),e.tooltip?Object(re.jsx)(xe.a,{content:e.tooltip,children:Object(i.cloneElement)(e.children,{onClick:function(){r(!0)}})}):Object(i.cloneElement)(e.children,{onClick:function(){r(!0)}})]})}function ke(e){var t=Object(l.g)();return Object(re.jsxs)($.a,{className:"actions",children:[Object(re.jsx)(q.a,{marginRight:12,marginBottom:12,appearance:"minimal",iconBefore:ue.a,onClick:function(){return t.push(g+e.name)},children:"Add Layer"}),Object(re.jsx)(_e,{submitUrl:H,title:"Add Style",label:"Choose the name of the new style",confirmLabel:"Create",method:"post",submitBody:function(t){return{project:e.name,name:t}},onSubmit:function(n){t.push(y+e.name+"/"+n)},onError:function(e,t){return"Style already exists"},children:Object(re.jsx)(q.a,{marginRight:12,marginBottom:12,appearance:"minimal",iconBefore:he.a,children:"Add Style"})}),Object(re.jsx)(we,{submitUrl:L,title:"Recompile project ".concat(e.name),label:"Are you sure you want to recompile project ".concat(e.name,"?"),confirmLabel:"Recompile",method:"post",submitBody:function(){return{name:e.name}},onSubmit:function(){t.push(v)},onError:function(e){return"Project could not be recompiled"},tooltip:"Publish selected layers and compile data for visualization",children:Object(re.jsx)(q.a,{marginRight:12,marginBottom:12,appearance:"minimal",iconBefore:fe.a,children:"Publish 3D"})}),Object(re.jsx)(q.a,{marginBottom:12,appearance:"minimal",iconBefore:me.a,onClick:function(){t.push(x+e.name)},children:"Map Layers"}),Object(re.jsx)(q.a,{marginRight:12,marginBottom:12,appearance:"minimal",iconBefore:pe.a,onClick:function(){t.push(f+e.name)},children:"View"}),Object(re.jsx)(_e,{submitUrl:k,title:"Rename project ".concat(e.name),label:"Choose a new name for project ".concat(e.name),confirmLabel:"Rename",method:"post",submitBody:function(t){return{new:t,old:e.name}},onSubmit:e.showProject,onError:function(e,t){return"Project already exists"},children:Object(re.jsx)(q.a,{marginRight:12,marginBottom:12,appearance:"minimal",iconBefore:ve.a,children:"Rename"})}),Object(re.jsx)(we,{submitUrl:S,title:"Delete project ".concat(e.name),label:"Do you really want to delete project ".concat(e.name,"?"),confirmLabel:"Delete",method:"delete",intent:"danger",submitBody:function(){return{data:{name:e.name}}},onSubmit:function(){e.showProject()},onError:function(e){return"Project could not be deleted"},children:Object(re.jsx)(q.a,{marginBottom:12,appearance:"minimal",iconBefore:be.a,intent:"danger",children:"Delete Project"})})]})}var Se=n(354),Le=n(297),Ce=n(298),Me=n(331),De=n(332),Ne=n(104);function Ie(e,t){ne.get(F).then((function(e){t()})).catch((function(){e.push(u)}))}function Ee(){var e=Object(i.useState)(""),t=Object(J.a)(e,2),n=t[0],a=t[1],r=Object(l.g)(),s=Object(i.createRef)(),o=Object(i.createRef)();return Object(i.useEffect)((function(){ne.get(F).then((function(){r.push(p)})).catch((function(e){}))}),[r]),Object(re.jsx)($.a,{className:"fullScreen",children:Object(re.jsxs)($.a,{children:[Object(re.jsx)(Z.a,{is:"h1",children:"Login"}),n.length>0?Object(re.jsx)("p",{children:n}):"",Object(re.jsxs)("form",{onSubmit:function(e){var t,n;e.preventDefault();var i=new FormData;i.append("username",(null===(t=s.current)||void 0===t?void 0:t.value)||""),i.append("password",(null===(n=o.current)||void 0===n?void 0:n.value)||""),ne.post(U,i,{headers:{"Content-Type":"multipart/form-data"}}).then((function(e){localStorage.setItem("JWT",e.data.access_token),ne.defaults.headers.common.Authorization="Bearer ".concat(e.data.access_token),r.push(p)})).catch((function(e){console.error(e),a("There was a problem with your login, check your username and password.")}))},children:[Object(re.jsx)(Ne.a,{width:"100%",placeholder:"username",ref:s,type:"text"}),Object(re.jsx)(Ne.a,{width:"100%",placeholder:"password",ref:o,type:"password"}),Object(re.jsx)(Ne.a,{type:"submit"})]})]})})}function Ae(e){var t=Object(i.useState)([]),n=Object(J.a)(t,2),a=n[0],r=n[1],s=Object(l.g)(),o=function(){ne.post(M,{name:e.name}).then((function(e){r(e.data)}))};Object(i.useEffect)((function(){return Ie(s,(function(){ne.post(M,{name:e.name}).then((function(e){r(e.data)}))})),function(){r([])}}),[e.name,s]);var c=function(t){t.disabled?ne.post(E,{project:e.name,name:t.name}).then((function(){o()})):ne.post(A,{project:e.name,name:t.name}).then((function(){o()}))};return Object(re.jsxs)($.a,{className:"section",children:[Object(re.jsx)($.a,{className:"projectHeader",children:Object(re.jsx)(Z.a,{className:"wide",is:"h3",children:" Layers"})}),Object(re.jsxs)(Se.a,{children:[Object(re.jsxs)(Se.a.Head,{className:"row",children:[Object(re.jsx)(Se.a.TextHeaderCell,{className:"wide",children:"Layer"}),Object(re.jsx)(Se.a.TextHeaderCell,{className:"wide",children:"Number of Objects"}),Object(re.jsx)(Se.a.TextHeaderCell,{className:"wide",children:"Type"}),Object(re.jsx)(Se.a.TextHeaderCell,{className:"narrow",children:"Public"}),Object(re.jsx)(Se.a.TextHeaderCell,{className:"narrow",children:"Rename"}),Object(re.jsx)(Se.a.TextHeaderCell,{className:"narrow",children:"Delete"})]}),Object(re.jsx)(Se.a.Body,{children:a.length>0?a.map((function(t){return Object(re.jsxs)(Se.a.Row,{paddingY:12,height:"auto",className:"row",children:[Object(re.jsx)(Se.a.TextCell,{className:"wide",children:t.name}),Object(re.jsx)(Se.a.TextCell,{className:"wide",children:"number"===typeof t.size?t.size:"".concat(t.size[0]," x ").concat(t.size[1])}),Object(re.jsx)(Se.a.TextCell,{className:"wide",children:t.type}),Object(re.jsx)(Se.a.TextCell,{className:"narrow",children:t.disabled?Object(re.jsx)(Le.a,{icon:Ce.a,appearance:"minimal",onClick:function(){return c(t)}}):Object(re.jsx)(Le.a,{icon:Me.a,intent:"success",appearance:"minimal",onClick:function(){return c(t)}})}),Object(re.jsx)(Se.a.TextCell,{className:"narrow",children:Object(re.jsx)(_e,{submitUrl:N,title:"Rename layer ".concat(t.name),label:"Choose a new name for layer ".concat(t.name),confirmLabel:"Rename",method:"post",submitBody:function(n){return{project:e.name,new:n,old:t.name}},onSubmit:o,onError:function(e,t){return"Project already exists"},children:Object(re.jsx)(Le.a,{icon:ve.a,appearance:"minimal"})})}),Object(re.jsx)(Se.a.TextCell,{className:"narrow",children:Object(re.jsx)(we,{submitUrl:I,title:"Delete layer ".concat(t.name),label:"Do you really want to delete layer ".concat(t.name,"?"),confirmLabel:"Delete",method:"delete",submitBody:function(){return{data:{project:e.name,name:t.name}}},onSubmit:o,onError:function(e){return"Layer could not be deleted"},children:Object(re.jsx)(Le.a,{icon:be.a,intent:"danger",appearance:"minimal"})})})]},t.name)})):Object(re.jsx)(le.a,{background:"light",title:"No Layers in this Project",orientation:"horizontal",icon:Object(re.jsx)(De.a,{color:"#C1C4D6"}),iconBgColor:"#EDEFF5",description:"Layers apper after successfull processing of the input files.",anchorCta:Object(re.jsx)(le.a.LinkButton,{is:se,to:g+e.name,children:"Add first layer"})})})]})]})}function ze(e){var t=Object(i.useState)([]),n=Object(J.a)(t,2),a=n[0],r=n[1],s=Object(l.g)(),o=Object(i.useCallback)((function(){ne.post(B,{name:e.project}).then((function(e){r(e.data)}))}),[e.project]);return Object(i.useEffect)((function(){Ie(s,(function(){o()}))}),[e.project,s,o]),Object(re.jsxs)($.a,{className:"styles",children:[Object(re.jsx)($.a,{className:"projectHeader",children:Object(re.jsx)(Z.a,{className:"wide",is:"h3",children:"Styles"})}),Object(re.jsx)($.a,{className:"styleList",children:a.length>0?a.map((function(t){return Object(re.jsxs)($.a,{className:"styleItem",children:[Object(re.jsx)($.a,{className:"styleTitle",onClick:function(){s.push(y+e.project+"/"+t)},children:t}),Object(re.jsxs)($.a,{children:[Object(re.jsx)(_e,{submitUrl:K,title:"Rename style ".concat(t),label:"Choose a new name for style ".concat(t),confirmLabel:"Rename",method:"post",submitBody:function(n){return{project:e.project,new:n,old:t}},onSubmit:function(){o()},onError:function(e,t){return"Project already exists"},children:Object(re.jsx)(q.a,{marginRight:16,appearance:"minimal",iconBefore:ve.a,children:"Rename"})}),Object(re.jsx)(we,{submitUrl:W,title:"Delete style ".concat(t),label:"Do you really want to delete style ".concat(t,"?"),confirmLabel:"Delete",method:"delete",intent:"danger",submitBody:function(){return{data:{project:e.project,name:t}}},onSubmit:function(){o()},onError:function(e){return"Style could not be deleted"},children:Object(re.jsx)(q.a,{appearance:"minimal",intent:"danger",iconBefore:be.a,children:"Delete"})})]})]},t)})):Object(re.jsx)(le.a,{background:"light",title:"No Styles in this Project",orientation:"vertical",icon:Object(re.jsx)(he.a,{color:"#C1C4D6"}),iconBgColor:"#EDEFF5",description:"Styles modify the appearance of the layer in the visualization according to the layer and object metadata"})})]})}function Te(e){return Object(re.jsxs)($.a,{className:"project",children:[Object(re.jsx)($.a,{children:Object(re.jsx)($.a,{className:"projectHeader main",children:Object(re.jsxs)(Z.a,{className:"wide",children:["Project ",e.name]})})}),Object(re.jsx)(ke,{name:e.name,showProject:e.showProject}),Object(re.jsx)(Ae,{name:e.name}),Object(re.jsx)(ze,{project:e.name})]})}var Pe=n(333),Re=n(334),Fe=n(335);function Ue(e){return Object(re.jsxs)($.a,{className:"list",children:[Object(re.jsx)(Z.a,{className:"projectList title",children:"Projects"}),Object(re.jsx)(_e,{submitUrl:w,title:"Add Project",label:"Choose the name of the new project",confirmLabel:"Create",method:"post",submitBody:function(e){return{name:e}},onSubmit:function(t){e.onSelect(t)},onError:function(e,t){return"Project already exists"},children:Object(re.jsxs)($.a,{className:"projectList action",children:[Object(re.jsx)(Pe.a,{}),"Add Project"]})}),Object(re.jsx)(Re.a,{className:"projectList tabs",children:e.projects.map((function(t){return Object(re.jsx)(Fe.a,{id:"tab-".concat(t),onSelect:function(){return e.onSelect(t)},isSelected:t===e.currentProject,children:t},t)}))})]})}function Be(){var e=Object(l.h)().project_name,t=Object(i.useState)(e),n=Object(J.a)(t,2),a=n[0],r=n[1],s=Object(i.useState)([]),o=Object(J.a)(s,2),c=o[0],d=o[1],u=Object(l.g)(),h=function(){ne.get(_).then((function(e){d(e.data)}))};Object(i.useEffect)((function(){return Ie(u,(function(){h()})),function(){d([])}}),[u]);var f=function(e){h(),r(e);var t=p;e&&(t+=e),u.push(t)};return Object(re.jsxs)($.a,{children:[Object(re.jsx)(oe,{projects:!0}),Object(re.jsxs)($.a,{className:"projects",children:[Object(re.jsx)(Ue,{currentProject:a,onSelect:f,projects:c}),Object(re.jsx)($.a,{className:"content ".concat(a?"":"empty"),justifyContent:"center",alignItems:"center",children:a?c.indexOf(a)>-1?Object(re.jsx)(Te,{name:a,showProject:f}):Object(re.jsx)(le.a,{background:"light",title:"Project ".concat(a," not found"),orientation:"vertical",icon:Object(re.jsx)(de.a,{color:"#C1C4D6"}),iconBgColor:"#EDEFF5"}):Object(re.jsx)(le.a,{background:"light",title:"No project selected",orientation:"vertical",icon:Object(re.jsx)(de.a,{color:"#C1C4D6"}),iconBgColor:"#EDEFF5"})})]})]})}var Ve=n(295),He=n(61),Ge=n(38),We=n(141),Ke=n(37);function Xe(e){var t=Object(We.a)(),n=t.acceptedFiles,a=t.getRootProps,r=t.getInputProps,s=Object(i.createRef)(),o=n.map((function(e){return Object(re.jsxs)("li",{children:[Object(re.jsx)("span",{className:"fileName",children:e.name}),Object(re.jsxs)("span",{className:"fileSize",children:[e.size," bytes"]})]},e.name)}));return Object(re.jsxs)($.a,{className:"dropzoneContainer",children:[Object(re.jsxs)("form",{onSubmit:function(t){t.preventDefault(),e.submit(s.current.value,n)},id:"layerUploadForm",children:[Object(re.jsx)(Ne.a,{placeholder:"layer name",ref:s,className:"layerName"}),Object(re.jsxs)("div",Object(ie.a)(Object(ie.a)({},a({className:"dropzone"})),{},{children:[Object(re.jsx)("input",Object(ie.a)({},r())),Object(re.jsx)("p",{children:"Click or drag 'n' drop layer files here"}),Object(re.jsx)("ul",{className:"filelist",children:o})]}))]}),Object(re.jsx)(q.a,{appearance:"primary",type:"submit",form:"layerUploadForm",children:"Upload"})]})}function Ye(){var e=Object(l.h)().project_name,t=Object(l.g)(),n=Object(i.useState)(0),a=Object(J.a)(n,2),r=a[0],s=a[1],o=Object(i.useState)(!1),c=Object(J.a)(o,2),d=c[0],u=c[1];Object(i.useEffect)((function(){Ie(t,(function(){}))}));return Object(re.jsxs)($.a,{children:[Object(re.jsx)(oe,{projects:!0}),Object(re.jsxs)($.a,{className:"upload",children:[d?Object(re.jsx)(Ve.a,{}):Object(re.jsx)(He.a,{icon:De.a,size:30,color:"#C1C4D6",background:"#EDEFF5",className:"uploadIcon",padding:20,borderRadius:40}),Object(re.jsxs)(Z.a,{className:"uploadTitle",children:["Uploading Layer to Project ",e]}),d?Object(re.jsx)($.a,{className:"progress",children:Object(re.jsxs)(Ge.a,{className:"label",children:[r.toFixed(0),"%"]})}):Object(re.jsx)(Xe,{submit:function(n,i){if(!d)if(void 0!==n&&0!==n.length)if(void 0!==i&&0!==i.length){u(!0);var a=new FormData;a.append("project",e),a.append("layer",n),i.forEach((function(e){a.append("files",e)})),ne.post(D,a,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(e){return s(e.loaded/e.total*100)}}).then((function(e){t.push(v)}))}else Object(Ke.b)("No files provided");else Object(Ke.b)("No name specified")}})]})]})}var Je=n(362),$e=n(337),Ze=n(338),qe=n(339),Qe=n(137),et=n.n(Qe);function tt(){var e=Object(i.useState)([]),t=Object(J.a)(e,2),n=t[0],a=t[1],r=Object(i.useState)(void 0),s=Object(J.a)(r,2),o=s[0],c=s[1],l=Object(i.useState)(!1),d=Object(J.a)(l,2),u=d[0],h=d[1];return Object(i.useEffect)((function(){var e;return function t(){ne.get(T).then((function(n){a(n.data),e=setTimeout(t,2e3)}))}(),function(){clearTimeout(e),a([])}}),[]),Object(re.jsxs)($.a,{children:[Object(re.jsx)(Je.a,{isShown:u,onCloseComplete:function(){return h(!1)},preventBodyScrolling:!0,children:Object(re.jsxs)($.a,{className:"jsonRaw",children:[Object(re.jsxs)(Z.a,{className:"jsonHeading",children:["Job ",null===o||void 0===o?void 0:o.job_id]}),Object(re.jsx)($.a,{className:"json",children:Object(re.jsx)(et.a,{src:o,enableClipboard:!1,theme:{base00:"#FFF",base01:"#DDD",base02:"#DDD",base03:"#444",base04:"#BBB",base05:"#444",base06:"#444",base07:"#444",base08:"#444",base09:"#3366FF",base0A:"#3366FF",base0B:"#3366FF",base0C:"#3366FF",base0D:"#BBB",base0E:"#BBB",base0F:"#3366FF"}})})]})}),Object(re.jsxs)(Se.a,{children:[Object(re.jsxs)(Se.a.Head,{className:"row",children:[Object(re.jsx)(Se.a.TextHeaderCell,{className:"wide",children:"Job Type"}),Object(re.jsx)(Se.a.TextHeaderCell,{className:"wide",children:"Status"}),Object(re.jsx)(Se.a.TextHeaderCell,{className:"wide",children:"Project"}),Object(re.jsx)(Se.a.TextHeaderCell,{className:"narrow",children:"Log"}),Object(re.jsx)(Se.a.TextHeaderCell,{className:"narrow",children:"Raw"})]}),Object(re.jsx)(Se.a.Body,{children:n.length>0?n.map((function(e){return Object(re.jsxs)(Se.a.Row,{paddingY:12,height:"auto",className:"row",children:[Object(re.jsx)(Se.a.TextCell,{className:"wide",children:e.type}),Object(re.jsx)(Se.a.TextCell,{className:"wide",children:e.status}),Object(re.jsx)(Se.a.TextCell,{className:"wide",children:e.project?e.project:"--"}),Object(re.jsx)(Se.a.TextCell,{className:"narrow",children:Object(re.jsx)(Le.a,{icon:$e.a,onClick:function(){},disabled:!0})}),Object(re.jsx)(Se.a.TextCell,{className:"narrow",children:Object(re.jsx)(Le.a,{icon:Ze.a,onClick:function(){c(e),h(!0)}})})]},e.job_id)})):Object(re.jsx)(le.a,{background:"light",title:"No Running Jobs",orientation:"horizontal",icon:Object(re.jsx)(qe.a,{color:"#C1C4D6"}),iconBgColor:"#EDEFF5",description:"Jobs run in the background and process input data into visualizable elements"})})]})]})}var nt=n(340);function it(e){var t=Object(i.useState)(""),n=Object(J.a)(t,2),a=n[0],r=n[1];return Object(i.useEffect)((function(){var t;return function n(){ne.post(R,{name:e.name}).then((function(e){r(e.data),t=setTimeout(n,2e3)}))}(),function(){r(""),clearTimeout(t)}}),[e.name]),Object(re.jsx)($.a,{className:"logContents",children:a&&a.length>0?Object(re.jsx)(nt.a,{className:"logLines",children:a.split(/[\r\n]+/).map((function(e,t){return Object(re.jsx)("span",{children:e},t)}))}):Object(re.jsx)(nt.a,{children:"No contents"})})}function at(){var e=Object(i.useState)([]),t=Object(J.a)(e,2),n=t[0],a=t[1],r=Object(i.useState)(void 0),s=Object(J.a)(r,2),o=s[0],c=s[1];return Object(i.useEffect)((function(){var e;return function t(){ne.get(P).then((function(n){a(n.data),e=setTimeout(t,2e3)}))}(),function(){a([]),clearTimeout(e)}}),[]),Object(re.jsxs)($.a,{children:[Object(re.jsx)(Re.a,{className:"logList",marginBottom:16,flexBasis:240,marginRight:24,children:n.map((function(e,t){return Object(re.jsx)(Fe.a,{id:e,onSelect:function(){return c(e)},isSelected:e===o,"aria-controls":"panel-".concat(e),className:"logTab",children:e},e)}))}),Object(re.jsx)($.a,{children:o?Object(re.jsx)(it,{name:o}):Object(re.jsx)(le.a,{background:"light",title:"No Log selected",orientation:"horizontal",icon:Object(re.jsx)($e.a,{color:"#C1C4D6"}),iconBgColor:"#EDEFF5",description:"Logs contain debug information for running processes"})})]})}function rt(){var e=Object(l.g)();return Object(i.useEffect)((function(){Ie(e,(function(){}))}),[e]),Object(re.jsxs)($.a,{children:[Object(re.jsx)(oe,{jobs:!0}),Object(re.jsxs)($.a,{className:"jobs",children:[Object(re.jsx)(Z.a,{className:"jobsHeading",children:"Jobs"}),Object(re.jsx)(tt,{})]}),Object(re.jsxs)($.a,{className:"logs",children:[Object(re.jsx)(Z.a,{className:"logsHeading",children:"Logs"}),Object(re.jsx)(at,{})]})]})}var st=n(341),ot=n(355),ct=n(342);function lt(){var e=Object(l.h)().project_name,t=Object(i.useState)([]),n=Object(J.a)(t,2),a=n[0],r=n[1],s=Object(i.useState)(void 0),o=Object(J.a)(s,2),c=o[0],d=o[1],u=Object(i.useState)(void 0),h=Object(J.a)(u,2),f=h[0],m=h[1],p=Object(i.createRef)(),v=Object(l.g)();Object(i.useEffect)((function(){return Ie(v,(function(){ne.post(M,{name:e}).then((function(e){r(e.data.filter((function(e){return"layer"===e.type})))}))})),function(){r([])}}),[e,v]);return Object(re.jsxs)($.a,{children:[Object(re.jsx)(oe,{projects:!0}),Object(re.jsxs)($.a,{className:"mapping",children:[Object(re.jsx)(He.a,{icon:me.a,size:30,color:"#C1C4D6",background:"#EDEFF5",className:"uploadIcon",padding:20,borderRadius:40}),Object(re.jsxs)(Z.a,{className:"mappingTitle",children:["Layer mapping in Project ",e]}),Object(re.jsxs)($.a,{className:"mappingDialog",children:[Object(re.jsxs)("form",{onSubmit:function(t){t.preventDefault();var n=p.current.value;void 0!==n&&0!==n.length?void 0!==c&&void 0!==f?c!==f?ne.post(z,{project:e,source:c,target:f,overlay:n}).then((function(){Ke.b.success("Mapping layers successfully.")})).catch((function(){Ke.b.error("Mapping layers failed.")})):Ke.b.error("Source and target layer cannot be same."):Ke.b.error("Please select source and target layer."):Ke.b.error("No name specified.")},id:"layerMappingForm",children:[Object(re.jsx)(Ne.a,{placeholder:"overlay name",ref:p,className:"layerName"}),Object(re.jsxs)(ye.a,{className:"mappingDescription",children:["Geometry of source layer is mapped onto geometry of target layer. The output of this operation is a new layer with type ",Object(re.jsx)(st.a,{size:300,children:"overlay"}),". The ",Object(re.jsx)(st.a,{size:300,children:"source"})," layer can contain any geometry, the ",Object(re.jsx)(st.a,{size:300,children:"target"})," layer must contain any ",Object(re.jsx)(st.a,{size:300,children:"polygons"}),"."]}),Object(re.jsxs)($.a,{className:"mappingLayerPicker",children:[Object(re.jsx)(ot.a,{title:"Select source layer",options:a.map((function(e){return{label:e.name,value:e.name}})),selected:c,onSelect:function(e){return d(e.value)},children:Object(re.jsx)(xe.a,{content:"Can contain 2D or 3D points, lines or polygons",children:Object(re.jsx)(q.a,{type:"button",children:c||"select source layer"})})}),Object(re.jsx)($.a,{className:"dialogPart",children:Object(re.jsx)(He.a,{icon:ct.a,color:"#C1C4D6"})}),Object(re.jsx)(ot.a,{title:"Select target layer",options:a.map((function(e){return{label:e.name,value:e.name}})),selected:f,onSelect:function(e){return m(e.value)},children:Object(re.jsx)(xe.a,{content:"Must contain 2D or 3D polygons",children:Object(re.jsx)(q.a,{type:"button",children:f||"select target layer"})})})]})]}),Object(re.jsx)(q.a,{appearance:"primary",type:"submit",form:"layerMappingForm",children:"Apply Mapping"})]})]})]})}var dt=n(0),ut=n(1),ht=n(6),ft=n(11),mt=new ft.u,pt=function(){function e(t){Object(dt.a)(this,e),t=t||{},this.vertices={near:[new ft.L,new ft.L,new ft.L,new ft.L],far:[new ft.L,new ft.L,new ft.L,new ft.L]},void 0!==t.projectionMatrix&&this.setFromProjectionMatrix(t.projectionMatrix,t.maxFar||1e4)}return Object(ut.a)(e,[{key:"setFromProjectionMatrix",value:function(e,t){var n=0===e.elements[11];return mt.copy(e).invert(),this.vertices.near[0].set(1,1,-1),this.vertices.near[1].set(1,-1,-1),this.vertices.near[2].set(-1,-1,-1),this.vertices.near[3].set(-1,1,-1),this.vertices.near.forEach((function(e){e.applyMatrix4(mt)})),this.vertices.far[0].set(1,1,1),this.vertices.far[1].set(1,-1,1),this.vertices.far[2].set(-1,-1,1),this.vertices.far[3].set(-1,1,1),this.vertices.far.forEach((function(e){e.applyMatrix4(mt);var i=Math.abs(e.z);n?e.z*=Math.min(t/i,1):e.multiplyScalar(Math.min(t/i,1))})),this.vertices}},{key:"split",value:function(t,n){for(;t.length>n.length;)n.push(new e);n.length=t.length;for(var i=0;i<t.length;i++){var a=n[i];if(0===i)for(var r=0;r<4;r++)a.vertices.near[r].copy(this.vertices.near[r]);else for(var s=0;s<4;s++)a.vertices.near[s].lerpVectors(this.vertices.near[s],this.vertices.far[s],t[i-1]);if(i===t.length-1)for(var o=0;o<4;o++)a.vertices.far[o].copy(this.vertices.far[o]);else for(var c=0;c<4;c++)a.vertices.far[c].lerpVectors(this.vertices.near[c],this.vertices.far[c],t[i])}}},{key:"toSpace",value:function(e,t){for(var n=0;n<4;n++)t.vertices.near[n].copy(this.vertices.near[n]).applyMatrix4(e),t.vertices.far[n].copy(this.vertices.far[n]).applyMatrix4(e)}}]),e}(),vt={lights_fragment_begin:"\nGeometricContext geometry;\n\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n\n#ifdef CLEARCOAT\n\n\tgeometry.clearcoatNormal = clearcoatNormal;\n\n#endif\n\nIncidentLight directLight;\n\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n\t\tpointLight = pointLights[ i ];\n\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n\t\tspotLight = spotLights[ i ];\n\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_DIR_LIGHTS > 0) && defined( RE_Direct ) && defined( USE_CSM ) && defined( CSM_CASCADES )\n\n\tDirectionalLight directionalLight;\n\tfloat linearDepth = (vViewPosition.z) / (shadowFar - cameraNear);\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\n\t#if defined( USE_SHADOWMAP ) && defined( CSM_FADE )\n\tvec2 cascade;\n\tfloat cascadeCenter;\n\tfloat closestEdge;\n\tfloat margin;\n\tfloat csmx;\n\tfloat csmy;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\n\t\t// NOTE: Depth gets larger away from the camera.\n\t\t// cascade.x is closer, cascade.y is further\n\t\tcascade = CSM_cascades[ i ];\n\t\tcascadeCenter = ( cascade.x + cascade.y ) / 2.0;\n\t\tclosestEdge = linearDepth < cascadeCenter ? cascade.x : cascade.y;\n\t\tmargin = 0.25 * pow( closestEdge, 2.0 );\n\t\tcsmx = cascade.x - margin / 2.0;\n\t\tcsmy = cascade.y + margin / 2.0;\n\t\tif( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS && linearDepth >= csmx && ( linearDepth < csmy || UNROLLED_LOOP_INDEX == CSM_CASCADES - 1 ) ) {\n\n\t\t\tfloat dist = min( linearDepth - csmx, csmy - linearDepth );\n\t\t\tfloat ratio = clamp( dist / margin, 0.0, 1.0 );\n\t\t\tif( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS ) {\n\n\t\t\t\tvec3 prevColor = directLight.color;\n\t\t\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\t\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\n\t\t\t\tbool shouldFadeLastCascade = UNROLLED_LOOP_INDEX == CSM_CASCADES - 1 && linearDepth > cascadeCenter;\n\t\t\t\tdirectLight.color = mix( prevColor, directLight.color, shouldFadeLastCascade ? ratio : 1.0 );\n\n\t\t\t}\n\n\t\t\tReflectedLight prevLight = reflectedLight;\n\t\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t\t\tbool shouldBlend = UNROLLED_LOOP_INDEX != CSM_CASCADES - 1 || UNROLLED_LOOP_INDEX == CSM_CASCADES - 1 && linearDepth < cascadeCenter;\n\t\t\tfloat blendRatio = shouldBlend ? ratio : 1.0;\n\n\t\t\treflectedLight.directDiffuse = mix( prevLight.directDiffuse, reflectedLight.directDiffuse, blendRatio );\n\t\t\treflectedLight.directSpecular = mix( prevLight.directSpecular, reflectedLight.directSpecular, blendRatio );\n\t\t\treflectedLight.indirectDiffuse = mix( prevLight.indirectDiffuse, reflectedLight.indirectDiffuse, blendRatio );\n\t\t\treflectedLight.indirectSpecular = mix( prevLight.indirectSpecular, reflectedLight.indirectSpecular, blendRatio );\n\n\t\t}\n\n\t}\n\t#pragma unroll_loop_end\n\t#else\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tif(linearDepth >= CSM_cascades[UNROLLED_LOOP_INDEX].x && linearDepth < CSM_cascades[UNROLLED_LOOP_INDEX].y) directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\n\t\t#endif\n\n\t\tif(linearDepth >= CSM_cascades[UNROLLED_LOOP_INDEX].x && (linearDepth < CSM_cascades[UNROLLED_LOOP_INDEX].y || UNROLLED_LOOP_INDEX == CSM_CASCADES - 1)) RE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n#endif\n\n\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct ) && !defined( USE_CSM ) && !defined( CSM_CASCADES )\n\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tdirectionalLight = directionalLights[ i ];\n\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\n\tRectAreaLight rectAreaLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if defined( RE_IndirectDiffuse )\n\n\tvec3 iblIrradiance = vec3( 0.0 );\n\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\n\t\t}\n\t\t#pragma unroll_loop_end\n\n\t#endif\n\n#endif\n\n#if defined( RE_IndirectSpecular )\n\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n\n#endif\n",lights_pars_begin:"\n#if defined( USE_CSM ) && defined( CSM_CASCADES )\nuniform vec2 CSM_cascades[CSM_CASCADES];\nuniform float cameraNear;\nuniform float shadowFar;\n#endif\n\t"+ft.E.lights_pars_begin},bt=new ft.u,gt=new pt,jt=new ft.L,yt=new ft.b,Ot=[],xt=[],_t=function(){function e(t){Object(dt.a)(this,e),t=t||{},this.camera=t.camera,this.parent=t.parent,this.cascades=t.cascades||3,this.maxFar=t.maxFar||1e5,this.mode=t.mode||"practical",this.shadowMapSize=t.shadowMapSize||2048,this.shadowBias=[];for(var n=0;n<this.cascades;++n)this.shadowBias.push(t.shadowBias?t.shadowBias[n]:1e-6);this.lightDirection=t.lightDirection||new ft.L(1,-1,1).normalize(),this.lightIntensity=t.lightIntensity||1,this.lightNear=t.lightNear||1,this.lightFar=t.lightFar||2e3,this.lightMargin=t.lightMargin||200,this.customSplitsCallback=t.customSplitsCallback,this.fade=!1,this.mainFrustum=new pt,this.frustums=[],this.breaks=[],this.lights=[],this.shaders=new Map,this.createLights(),this.updateFrustums(),this.injectInclude()}return Object(ut.a)(e,[{key:"createLights",value:function(){for(var e=0;e<this.cascades;e++){var t=new ft.f(16777215,this.lightIntensity);t.castShadow=!0,t.shadow.mapSize.width=this.shadowMapSize,t.shadow.mapSize.height=this.shadowMapSize,t.shadow.camera.near=this.lightNear,t.shadow.camera.far=this.lightFar,t.shadow.bias=this.shadowBias[e],this.parent.add(t),this.parent.add(t.target),this.lights.push(t)}}},{key:"initCascades",value:function(){var e=this.camera;e.updateProjectionMatrix(),this.mainFrustum.setFromProjectionMatrix(e.projectionMatrix,this.maxFar),this.mainFrustum.split(this.breaks,this.frustums)}},{key:"updateShadowBounds",value:function(){for(var e=this.frustums,t=0;t<e.length;t++){var n=this.lights[t].shadow.camera,i=this.frustums[t],a=i.vertices.near,r=i.vertices.far,s=r[0],o=void 0;o=s.distanceTo(r[2])>s.distanceTo(a[2])?r[2]:a[2];var c=s.distanceTo(o);if(this.fade){var l=this.camera,d=Math.max(l.far,this.maxFar),u=i.vertices.far[0].z/(d-l.near);c+=.25*Math.pow(u,2)*(d-l.near)}n.left=-c/2,n.right=c/2,n.top=c/2,n.bottom=-c/2,n.updateProjectionMatrix()}}},{key:"getBreaks",value:function(){var e=this.camera,t=Math.min(e.far,this.maxFar);switch(this.breaks.length=0,this.mode){case"uniform":n(this.cascades,e.near,t,this.breaks);break;case"logarithmic":i(this.cascades,e.near,t,this.breaks);break;case"practical":!function(e,t,a,r,s){Ot.length=0,xt.length=0,i(e,t,a,xt),n(e,t,a,Ot);for(var o=1;o<e;o++)s.push(ft.t.lerp(Ot[o-1],xt[o-1],r));s.push(1)}(this.cascades,e.near,t,.8,this.breaks);break;case"custom":void 0===this.customSplitsCallback&&console.error("CSM: Custom split scheme callback not defined."),this.customSplitsCallback(this.cascades,e.near,t,this.breaks)}function n(e,t,n,i){for(var a=1;a<e;a++)i.push((t+(n-t)*a/e)/n);i.push(1)}function i(e,t,n,i){for(var a=1;a<e;a++)i.push(t*Math.pow(n/t,a/e)/n);i.push(1)}}},{key:"update",value:function(){for(var e=this.camera,t=this.frustums,n=0;n<t.length;n++){var i=this.lights[n],a=i.shadow.camera,r=(a.right-a.left)/this.shadowMapSize,s=(a.top-a.bottom)/this.shadowMapSize;i.shadow.camera.updateMatrixWorld(!0),bt.multiplyMatrices(i.shadow.camera.matrixWorldInverse,e.matrixWorld),t[n].toSpace(bt,gt);var o=gt.vertices.near,c=gt.vertices.far;yt.makeEmpty();for(var l=0;l<4;l++)yt.expandByPoint(o[l]),yt.expandByPoint(c[l]);yt.getCenter(jt),jt.z=yt.max.z+this.lightMargin,jt.x=Math.floor(jt.x/r)*r,jt.y=Math.floor(jt.y/s)*s,jt.applyMatrix4(i.shadow.camera.matrixWorld),i.position.copy(jt),i.target.position.copy(jt),i.target.position.x+=this.lightDirection.x,i.target.position.y+=this.lightDirection.y,i.target.position.z+=this.lightDirection.z}}},{key:"injectInclude",value:function(){ft.E.lights_fragment_begin=vt.lights_fragment_begin,ft.E.lights_pars_begin=vt.lights_pars_begin}},{key:"setupMaterial",value:function(e){e.defines=e.defines||{},e.defines.USE_CSM=1,e.defines.CSM_CASCADES=this.cascades,this.fade&&(e.defines.CSM_FADE="");var t=[],n=this,i=this.shaders;e.onBeforeCompile=function(a){var r=Math.min(n.camera.far,n.maxFar);n.getExtendedBreaks(t),a.uniforms.CSM_cascades={value:t},a.uniforms.cameraNear={value:n.camera.near},a.uniforms.shadowFar={value:r},i.set(e,a)},i.set(e,null)}},{key:"updateUniforms",value:function(){var e=Math.min(this.camera.far,this.maxFar);this.shaders.forEach((function(t,n){if(null!==t){var i=t.uniforms;this.getExtendedBreaks(i.CSM_cascades.value),i.cameraNear.value=this.camera.near,i.shadowFar.value=e}!this.fade&&"CSM_FADE"in n.defines?(delete n.defines.CSM_FADE,n.needsUpdate=!0):this.fade&&!("CSM_FADE"in n.defines)&&(n.defines.CSM_FADE="",n.needsUpdate=!0)}),this)}},{key:"getExtendedBreaks",value:function(e){for(;e.length<this.breaks.length;)e.push(new ft.K);e.length=this.breaks.length;for(var t=0;t<this.cascades;t++){var n=this.breaks[t],i=this.breaks[t-1]||0;e[t].x=i,e[t].y=n}}},{key:"updateFrustums",value:function(){this.getBreaks(),this.initCascades(),this.updateShadowBounds(),this.updateUniforms()}},{key:"remove",value:function(){for(var e=0;e<this.lights.length;e++)this.parent.remove(this.lights[e])}},{key:"dispose",value:function(){var e=this.shaders;e.forEach((function(e,t){delete t.onBeforeCompile,delete t.defines.USE_CSM,delete t.defines.CSM_CASCADES,delete t.defines.CSM_FADE,null!==e&&(delete e.uniforms.CSM_cascades,delete e.uniforms.cameraNear,delete e.uniforms.shadowFar),t.needsUpdate=!0})),e.clear()}}]),e}(),wt=n(4),kt=n(5),St=function(e){Object(wt.a)(n,e);var t=Object(kt.a)(n);function n(e){var i;Object(dt.a)(this,n),(i=t.call(this)).csm=e,i.displayFrustum=!0,i.displayPlanes=!0,i.displayShadowBounds=!0;var a=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),s=new ft.e;s.setIndex(new ft.d(a,1)),s.setAttribute("position",new ft.d(r,3,!1));var o=new ft.r(s,new ft.p);return i.add(o),i.frustumLines=o,i.cascadeLines=[],i.cascadePlanes=[],i.shadowLines=[],i}return Object(ut.a)(n,[{key:"updateVisibility",value:function(){for(var e=this.displayFrustum,t=this.displayPlanes,n=this.displayShadowBounds,i=this.frustumLines,a=this.cascadeLines,r=this.cascadePlanes,s=this.shadowLines,o=0,c=a.length;o<c;o++){var l=a[o],d=r[o],u=s[o];l.visible=e,d.visible=e&&t,u.visible=n}i.visible=e}},{key:"update",value:function(){var e=this.csm,t=e.camera,n=e.cascades,i=e.mainFrustum,a=e.frustums,r=e.lights,s=this.frustumLines.geometry.getAttribute("position"),o=this.cascadeLines,c=this.cascadePlanes,l=this.shadowLines;for(this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.updateMatrixWorld(!0);o.length>n;)this.remove(o.pop()),this.remove(c.pop()),this.remove(l.pop());for(;o.length<n;){var d=new ft.c(new ft.b,0),u=new ft.w({color:0,transparent:!0,opacity:.1,depthWrite:!1,side:ft.g}),h=new ft.v(new ft.B,u),f=new ft.j,m=new ft.c(new ft.b,16711680);f.add(m),this.add(d),this.add(h),this.add(f),o.push(d),c.push(h),l.push(f)}for(var p=0;p<n;p++){var v=a[p],b=r[p].shadow.camera,g=v.vertices.far,j=o[p],y=c[p],O=l[p],x=O.children[0];j.box.min.copy(g[2]),j.box.max.copy(g[0]),j.box.max.z+=1e-4,y.position.addVectors(g[0],g[2]),y.position.multiplyScalar(.5),y.scale.subVectors(g[0],g[2]),y.scale.z=1e-4,this.remove(O),O.position.copy(b.position),O.quaternion.copy(b.quaternion),O.scale.copy(b.scale),O.updateMatrixWorld(!0),this.attach(O),x.box.min.set(b.bottom,b.left,-b.far),x.box.max.set(b.top,b.right,-b.near)}var _=i.vertices.near,w=i.vertices.far;s.setXYZ(0,w[0].x,w[0].y,w[0].z),s.setXYZ(1,w[3].x,w[3].y,w[3].z),s.setXYZ(2,w[2].x,w[2].y,w[2].z),s.setXYZ(3,w[1].x,w[1].y,w[1].z),s.setXYZ(4,_[0].x,_[0].y,_[0].z),s.setXYZ(5,_[3].x,_[3].y,_[3].z),s.setXYZ(6,_[2].x,_[2].y,_[2].z),s.setXYZ(7,_[1].x,_[1].y,_[1].z),s.needsUpdate=!0}}]),n}(ft.j),Lt=(n(106),function(){function e(t){Object(dt.a)(this,e),this.pickingTexture=void 0,this.pixelBuffer=void 0,this.renderer=void 0,this.selected=void 0,this.id=void 0,this.offsets=void 0,this.maxOffest=void 0,this.pickingTexture=new ft.M(1,1),this.pixelBuffer=new Uint8Array(4),this.renderer=t,this.selected=[-1,-1,-1,-1],this.id=-1,this.offsets=new Map,this.maxOffest=0}return Object(ut.a)(e,[{key:"offsetForLayer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;if(!this.offsets.has(e)){if(-1===t)throw new Error("Layer ".concat(e," not registered."));this.offsets.set(e,[this.maxOffest,this.maxOffest+t]),this.maxOffest+=t}var n=this.offsets.get(e);return n[0]}},{key:"layerAndOidForId",value:function(e){var t,n=Object(ht.a)(this.offsets.entries());try{for(n.s();!(t=n.n()).done;){var i=Object(J.a)(t.value,2),a=i[0],r=i[1];if(e>=r[0]&&e<r[1])return{layer:a,oid:e-r[0]}}}catch(s){n.e(s)}finally{n.f()}}},{key:"select",value:function(e){this.id=e;var t=new Uint32Array([e]),n=new DataView(t.buffer);this.selected=[n.getUint8(0)/255,n.getUint8(1)/255,n.getUint8(2)/255,n.getUint8(3)/255]}},{key:"pick",value:function(e,t,n,i){var a=this.pickingTexture,r=this.pixelBuffer,s=this.renderer.getPixelRatio();return i.setViewOffset(this.renderer.getContext().drawingBufferWidth,this.renderer.getContext().drawingBufferHeight,e*s|0,t*s|0,1,1),this.renderer.setRenderTarget(a),this.renderer.render(n,i),this.renderer.setRenderTarget(null),i.clearViewOffset(),this.renderer.readRenderTargetPixels(a,0,0,1,1,r),this.selected=[r[0]/255,r[1]/255,r[2]/255,r[3]/255],this.id=new DataView(r.buffer).getUint32(0,!0),this.id}}]),e}());var Ct,Mt=function(){function e(t){Object(dt.a)(this,e),this.polygonMaterial=void 0,this.pointMaterial=void 0,this.lineMaterial=void 0,this.agentMaterial=void 0,this.pickingPolygonMaterial=void 0,this.pickingLineMaterial=void 0,this.pickingPointMaterial=void 0,this.pickingAgentMaterial=void 0,this.polygonMaterial=function(){var e=ft.J.merge([ft.F.phong.uniforms,{selectedID:{value:[-1,-1,-1,-1]}}]);return new ft.G({uniforms:e,vertexShader:"\n#define PHONG\n\nvarying vec3 vViewPosition;\n\nuniform vec4 selectedID;\n\nattribute vec4 objectID;\nattribute vec3 color;\nvarying float varyingObjectID;\nvarying vec3 colorFrag;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n    int marked = 1;\n\n    for(int i = 0; i < 4; ++i)\n        marked *= int(floor(selectedID[i] * 255.0 + 0.5) == floor(objectID[i] * 255.0 + 0.5));\n\n    varyingObjectID = float(marked);\n\tcolorFrag = color;\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",fragmentShader:"\n#define PHONG\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n\nvarying float varyingObjectID;\nvarying vec3 colorFrag;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4(diffuse, opacity);\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = clamp(reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance, 0.75, 1.0) * colorFrag;\n\t\n\tif (varyingObjectID > 0.5) \n\t\toutgoingLight -= vec3(0.0, 0.6, 0.6); \n\n\n\t//outgoingLight -= vec3(0.8);\n\t//vec3 shade = outgoingLight;\n\t//const vec3 slices = vec3(10.0);\n\t//const vec3 slices_inv = vec3(1.0) / slices;\n\t//outgoingLight *= vec3(5.0);\n\t//outgoingLight *= slices;\n\t//outgoingLight = floor(outgoingLight + vec3(0.5));\n\t//outgoingLight *= slices_inv;\n\t//outgoingLight = pow(outgoingLight, vec3(0.4));\n\t//outgoingLight *= vec3(0.3);\n\t//outgoingLight += vec3(0.7);\n\n\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",lights:!0,side:ft.g,name:"custom-polygon-material"})}(),t.setupMaterial(this.polygonMaterial),this.lineMaterial=function(){var e=ft.J.merge([{zoffset:{value:1}},{thickness:{value:1}},{selectedID:{value:[-1,-1,-1,-1]}}]);return new ft.G({uniforms:e,vertexShader:"\n#define PHONG\n\nvarying vec3 vViewPosition;\n\nattribute vec3 lineStart;\nattribute vec3 lineEnd;\nattribute vec3 color;\nattribute vec4 objectID;\n\nuniform float zoffset;\nuniform vec4 selectedID;\nuniform float thickness;\n\nvarying float varyingObjectID;\nvarying vec3 colorFrag;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\n/**\n * Create rotation matrix from field vector.\n * The returned matrix can rotate vector (1, 0, 0)\n * into the desired setup.\n */\nmat4 getRotationMat(vec3 vector)\n{\n\tvec3 unit = vec3(1, 0, 0);\n\tvec3 f = normalize(vector);\n\tvec3 cross = cross(f, unit);\n\tvec3 a = normalize(cross);\n\tfloat s = length(cross);\n\tfloat c = dot(f, unit);\n\tfloat oc = 1.0 - c;\n\treturn mat4(oc * a.x * a.x + c,        oc * a.x * a.y - a.z * s,  oc * a.z * a.x + a.y * s,  0.0,\n                oc * a.x * a.y + a.z * s,  oc * a.y * a.y + c,        oc * a.y * a.z - a.x * s,  0.0,\n                oc * a.z * a.x - a.y * s,  oc * a.y * a.z + a.x * s,  oc * a.z * a.z + c,        0.0,\n                0.0,                       0.0,                       0.0,                       1.0);\n\n}\n\nvoid main() {\n    int marked = 1;\n\n    for(int i = 0; i < 4; ++i)\n        marked *= int(floor(selectedID[i] * 255.0 + 0.5) == floor(objectID[i] * 255.0 + 0.5));\n\n    varyingObjectID = float(marked);\n\tcolorFrag = color;\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\n\t#include <begin_vertex> //transformed contains location\n\n\tvec3 dir = lineEnd - lineStart;\n    float dist = length(dir);\n    mat4 rot = getRotationMat(dir);\n\n\tfloat end = float(transformed.x >= 0.9);\n\ttransformed.x = end * (dist + (transformed.x - 1.0) * thickness) + (1.0 - end) * transformed.x * thickness; //subtract one because its the original length of the template line\n\ttransformed.y *= thickness;\n\n    transformed = lineStart + (rot * vec4(transformed, 1.0)).xyz;\n\ttransformed.z += zoffset;\n\n\tif (varyingObjectID > 0.5)\n\t\ttransformed.z += zoffset;\n\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = -mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",fragmentShader:"\n#define PHONG\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n\nvarying float varyingObjectID;\nvarying vec3 colorFrag;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\t//vec4 diffuseColor = vec4(diffuse, opacity);\n\t//ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t//vec3 totalEmissiveRadiance = emissive;\n\n\t//#include <logdepthbuf_fragment>\n\t//#include <map_fragment>\n\t//#include <color_fragment>\n\t//#include <alphamap_fragment>\n\t//#include <alphatest_fragment>\n\t//#include <specularmap_fragment>\n\t//#include <normal_fragment_begin>\n\t//#include <normal_fragment_maps>\n\t//#include <emissivemap_fragment>\n\n\t// accumulation\n\t//#include <lights_phong_fragment>\n\t//#include <lights_fragment_begin>\n\t//#include <lights_fragment_maps>\n\t//#include <lights_fragment_end>\n\n\t// modulation\n\t//#include <aomap_fragment>\n\n\t//vec3 outgoingLight = clamp(reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance, 0.75, 1.0) * colorFrag;\n\tvec3 outgoingLight = colorFrag;\n\n\t\n\tif (varyingObjectID > 0.5) \n\t\toutgoingLight -= vec3(0.0, 0.6, 0.6); \n\n\n\t//#include <envmap_fragment>\n\t//#include <output_fragment>\n\t//the output is replaced by the segment bellow\n\tgl_FragColor = vec4( outgoingLight, 1.0 );\n\n\t//#include <tonemapping_fragment>\n\t//#include <encodings_fragment>\n\t//#include <fog_fragment>\n\t//#include <premultiplied_alpha_fragment>\n\t//#include <dithering_fragment>\n}\n",side:ft.g,name:"custom-line-material"})}(),this.pointMaterial=function(){var e=ft.J.merge([ft.F.phong.uniforms,{selectedID:{value:[-1,-1,-1,-1]}},{pointSize:{value:1}}]);return new ft.G({uniforms:e,vertexShader:"\n#define PHONG\n\nvarying vec3 vViewPosition;\n\nuniform vec4 selectedID;\nuniform float pointSize;\n\nattribute vec3 location;\nattribute vec4 objectID;\nattribute vec3 color;\n\nvarying float varyingObjectID;\nvarying vec3 colorFrag;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n    int marked = 1;\n\n    for(int i = 0; i < 4; ++i)\n        marked *= int(floor(selectedID[i] * 255.0 + 0.5) == floor(objectID[i] * 255.0 + 0.5));\n\n    varyingObjectID = float(marked);\n\tcolorFrag = color;\n\n\t//#include <uv_vertex>\n\t//#include <uv2_vertex>\n\t//#include <color_vertex>\n\n\t//#include <beginnormal_vertex>\n\t//#include <morphnormal_vertex>\n\t//#include <skinbase_vertex>\n\t//#include <skinnormal_vertex>\n\t//#include <defaultnormal_vertex>\n\t//#include <normal_vertex>\n\n\t#include <begin_vertex>\n\n\ttransformed *= pointSize;\n\ttransformed += location;\n\n\t//#include <morphtarget_vertex>\n\t//#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t//#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t//#include <envmap_vertex>\n\t//#include <shadowmap_vertex>\n\t//#include <fog_vertex>\n}\n",fragmentShader:"\n#define PHONG\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n\nvarying float varyingObjectID;\nvarying vec3 colorFrag;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\t//vec4 diffuseColor = vec4(diffuse, opacity);\n\t//ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t//vec3 totalEmissiveRadiance = emissive;\n\n\t//#include <logdepthbuf_fragment>\n\t//#include <map_fragment>\n\t//#include <color_fragment>\n\t//#include <alphamap_fragment>\n\t//#include <alphatest_fragment>\n\t//#include <specularmap_fragment>\n\t//#include <normal_fragment_begin>\n\t//#include <normal_fragment_maps>\n\t//#include <emissivemap_fragment>\n\n\t// accumulation\n\t//#include <lights_phong_fragment>\n\t//#include <lights_fragment_begin>\n\t//#include <lights_fragment_maps>\n\t//#include <lights_fragment_end>\n\n\t// modulation\n\t//#include <aomap_fragment>\n\n\t//vec3 outgoingLight = clamp(reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance, 0.75, 1.0) * colorFrag;\n\tvec3 outgoingLight = colorFrag;\n\n\t\n\tif (varyingObjectID > 0.5) \n\t\toutgoingLight -= vec3(0.0, 0.6, 0.6); \n\n\n\t//#include <envmap_fragment>\n\t//#include <output_fragment>\n\t//the output is replaced by the segment bellow\n\tgl_FragColor = vec4( outgoingLight, 1.0 );\n\n\t//#include <tonemapping_fragment>\n\t//#include <encodings_fragment>\n\t//#include <fog_fragment>\n\t//#include <premultiplied_alpha_fragment>\n\t//#include <dithering_fragment>\n}\n",lights:!0,side:ft.g,name:"custom-point-material"})}(),this.agentMaterial=function(){var e=ft.J.merge([{pointSize:{value:1}},{time:{value:0}},{time:{value:0}}]);return new ft.G({uniforms:e,vertexShader:"\nattribute vec4 objectID;\nattribute vec3 from;\nattribute float from_speed;\nattribute vec3 to;\nattribute float to_speed;\n\nvarying float varyingObjectID;\nvarying float speed;\nuniform float pointSize;\nuniform vec4 selectedID;\nuniform float time;\n\n\n/**\n * Create rotation matrix from field vector.\n * The returned matrix can rotate vector (1, 0, 0)\n * into the desired setup.\n */\nmat4 getRotationMat(vec3 vector)\n{\n\tvec3 unit = vec3(1, 0, 0);\n\tvec3 f = normalize(vector);\n\tvec3 cross = cross(f, unit);\n\tvec3 a = normalize(cross);\n\tfloat s = length(cross);\n\tfloat c = dot(f, unit);\n\tfloat oc = 1.0 - c;\n\treturn mat4(oc * a.x * a.x + c,        oc * a.x * a.y - a.z * s,  oc * a.z * a.x + a.y * s,  0.0,\n                oc * a.x * a.y + a.z * s,  oc * a.y * a.y + c,        oc * a.y * a.z - a.x * s,  0.0,\n                oc * a.z * a.x - a.y * s,  oc * a.y * a.z + a.x * s,  oc * a.z * a.z + c,        0.0,\n                0.0,                       0.0,                       0.0,                       1.0);\n\n}\n\nvoid main() {\n\tint marked = 1;\n\n    for(int i = 0; i < 4; ++i)\n        marked *= int(floor(selectedID[i] * 255.0 + 0.5) == floor(objectID[i] * 255.0 + 0.5));\n\n    varyingObjectID = float(marked);\n\n\n\tvec3 transformed = position;\n\t//vec3 dir = from - to;\n    //float dist = length(dir);\n    //if (dist > 0.01)\n\t//{\n\t//\tmat4 rot = getRotationMat(dir);\n\t//\ttransformed = (rot * vec4(transformed, 1.0)).xyz;\n\t//}\n\n\n    gl_Position = projectionMatrix * (modelViewMatrix * vec4( (pointSize * transformed) + from * (1.0 - time) + to * time, 1.0 ));\n\tspeed = clamp((from_speed * (1.0 - time) + to_speed * time) / 20.0, 0.0, 1.0);\n}\n",fragmentShader:"\nvarying float varyingObjectID;\nvarying float speed;\n\nvoid main() {\n\tvec3 color = vec3(1.0 - speed, speed, 0.0) * 0.7 + vec3(0.3, 0.3, 0.3);\n\tif (varyingObjectID > 0.5) \n\t\tcolor -= vec3(0.0, 0.6, 0.6); \n\n\tgl_FragColor = vec4(color, 1.0);\n}\n",side:ft.g,name:"custom-agent-picking-material"})}(),this.pickingPolygonMaterial=function(){var e=ft.J.merge([]);return new ft.G({uniforms:e,vertexShader:"\nattribute vec4 objectID;\nvarying vec4 objectIDColor;\n\nvoid main() {\n    objectIDColor = objectID;\n    gl_Position = projectionMatrix * (modelViewMatrix * vec4( position, 1.0 ));\n}\n",fragmentShader:"\nvarying vec4 objectIDColor;\n\nvoid main() {\n\tgl_FragColor = vec4(objectIDColor);\n}\n",side:ft.g,name:"custom-picking-material"})}(),this.pickingLineMaterial=function(){var e=ft.J.merge([{zoffset:{value:1}},{thickness:{value:5}}]);return new ft.G({uniforms:e,vertexShader:"\nattribute vec4 objectID;\nattribute vec3 lineStart;\nattribute vec3 lineEnd;\n\nuniform float zoffset;\nuniform float thickness;\n\nvarying vec4 objectIDColor;\n\n\n/**\n * Create rotation matrix from field vector.\n * The returned matrix can rotate vector (1, 0, 0)\n * into the desired setup.\n */\nmat4 getRotationMat(vec3 vector)\n{\n\tvec3 unit = vec3(1, 0, 0);\n\tvec3 f = normalize(vector);\n\tvec3 cross = cross(f, unit);\n\tvec3 a = normalize(cross);\n\tfloat s = length(cross);\n\tfloat c = dot(f, unit);\n\tfloat oc = 1.0 - c;\n\treturn mat4(oc * a.x * a.x + c,        oc * a.x * a.y - a.z * s,  oc * a.z * a.x + a.y * s,  0.0,\n                oc * a.x * a.y + a.z * s,  oc * a.y * a.y + c,        oc * a.y * a.z - a.x * s,  0.0,\n                oc * a.z * a.x - a.y * s,  oc * a.y * a.z + a.x * s,  oc * a.z * a.z + c,        0.0,\n                0.0,                       0.0,                       0.0,                       1.0);\n\n}\n\n\nvoid main() {\n    objectIDColor = objectID;\n\n\tvec3 transformed = position;\n\tvec3 dir = lineEnd - lineStart;\n    float dist = length(dir);\n    mat4 rot = getRotationMat(dir);\n\n\tfloat end = float(transformed.x >= 0.9);\n\ttransformed.x = end * (dist + (transformed.x - 1.0) * thickness) + (1.0 - end) * transformed.x * thickness; //subtract one because its the original length of the template line\n\ttransformed.y *= thickness;\n\n    transformed = lineStart + (rot * vec4(transformed, 1.0)).xyz;\n\ttransformed.z += zoffset;\n\n    gl_Position = projectionMatrix * (modelViewMatrix * vec4( transformed, 1.0 ));\n}\n",fragmentShader:"\nvarying vec4 objectIDColor;\n\nvoid main() {\n\tgl_FragColor = vec4(objectIDColor);\n}\n",side:ft.g,name:"custom-point-picking-material"})}(),this.pickingPointMaterial=function(){var e=ft.J.merge([{pointSize:{value:1}}]);return new ft.G({uniforms:e,vertexShader:"\nattribute vec4 objectID;\nattribute vec3 location;\nvarying vec4 objectIDColor;\n\nuniform float pointSize;\nuniform vec4 selectedID;\n\nvoid main() {\n    objectIDColor = objectID;\n    gl_Position = projectionMatrix * (modelViewMatrix * vec4( (pointSize * position) + location, 1.0 ));\n}\n",fragmentShader:"\nvarying vec4 objectIDColor;\n\nvoid main() {\n\tgl_FragColor = vec4(objectIDColor);\n}\n",side:ft.g,name:"custom-point-picking-material"})}(),this.pickingAgentMaterial=function(){var e=ft.J.merge([{pointSize:{value:1}},{time:{value:0}}]);return new ft.G({uniforms:e,vertexShader:"\nattribute vec4 objectID;\nattribute vec3 from;\nattribute vec3 to;\nvarying vec4 objectIDColor;\nuniform float pointSize;\nuniform float time;\n\nvoid main() {\n\tobjectIDColor = objectID;\n    gl_Position = projectionMatrix * (modelViewMatrix * vec4( (pointSize * position) + from * (1.0 - time) + to * time, 1.0 ));\n}\n",fragmentShader:"\nvarying vec4 objectIDColor;\n\nvoid main() {\n\tgl_FragColor = vec4(objectIDColor);\n}\n",side:ft.g,name:"custom-agent-picking-material"})}()}return Object(ut.a)(e,[{key:"setPointSize",value:function(e){this.pointMaterial.uniforms.pointSize.value=e,this.pointMaterial.uniformsNeedUpdate=!0,this.pickingPointMaterial.uniforms.pointSize.value=e,this.pickingPointMaterial.uniformsNeedUpdate=!0,this.agentMaterial.uniforms.pointSize.value=e,this.agentMaterial.uniformsNeedUpdate=!0,this.pickingAgentMaterial.uniforms.pointSize.value=e,this.pickingAgentMaterial.uniformsNeedUpdate=!0}},{key:"setLineWidth",value:function(e){this.lineMaterial.uniforms.thickness={value:e},this.lineMaterial.uniformsNeedUpdate=!0,this.pickingLineMaterial.uniforms.thickness={value:Math.max(e,5)},this.pickingLineMaterial.uniformsNeedUpdate=!0}},{key:"setSelectedID",value:function(e){this.polygonMaterial.uniforms.selectedID={value:e},this.polygonMaterial.uniformsNeedUpdate=!0,this.lineMaterial.uniforms.selectedID={value:e},this.lineMaterial.uniformsNeedUpdate=!0,this.pointMaterial.uniforms.selectedID={value:e},this.pointMaterial.uniformsNeedUpdate=!0,this.pointMaterial.uniforms.selectedID={value:e},this.pointMaterial.uniformsNeedUpdate=!0}},{key:"setTime",value:function(e){this.pickingAgentMaterial.uniforms.time={value:e-Math.floor(e)},this.pickingAgentMaterial.uniformsNeedUpdate=!0,this.agentMaterial.uniforms.time={value:e-Math.floor(e)},this.agentMaterial.uniformsNeedUpdate=!0}}]),e}(),Dt=function(e){Object(wt.a)(n,e);var t=Object(kt.a)(n);function n(e,i){var a;return Object(dt.a)(this,n),e.up=new ft.L(0,0,1),(a=t.call(this,e,i)).screenSpacePanning=!1,a.mouseButtons.LEFT=ft.s.PAN,a.mouseButtons.MIDDLE=ft.s.ROTATE,a.mouseButtons.RIGHT=ft.s.DOLLY,a.touches.ONE=ft.I.PAN,a.touches.TWO=ft.I.DOLLY_ROTATE,a.zoomSpeed=1,a.minDistance=400,a.minPolarAngle=.001,a.maxPolarAngle=.4*Math.PI,a.update(),a}return n}(n(138).a),Nt=function(){function e(t){Object(dt.a)(this,e),this.camera=void 0,this.camera=new ft.A(65,window.innerWidth/window.innerHeight,1,6e3)}return Object(ut.a)(e,[{key:"update",value:function(e){e.update()}},{key:"topView",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3;this.camera.position.copy(e.target),this.camera.position.z=t,this.camera.updateMatrixWorld()}},{key:"enable",value:function(e){e.enableRotate=!0,e.maxDistance=5e3}},{key:"resize",value:function(e,t){this.camera.aspect=e/t,this.camera.updateProjectionMatrix()}}]),e}(),It=function(){function e(t,n){Object(dt.a)(this,e),this.camera=void 0,this.csm=void 0,this.camera=new ft.y(-window.innerWidth/2,window.innerWidth/2,window.innerHeight/2,-window.innerHeight/2,1,1e4),this.csm=n}return Object(ut.a)(e,[{key:"update",value:function(e){var t=e.target.distanceTo(e.object.position),n=e.object.aspect;this.camera.left=t*n/-2,this.camera.right=t*n/2,this.camera.top=t/2,this.camera.bottom=t/-2,this.camera.position.copy(e.object.position),this.camera.updateProjectionMatrix(),e.update(),this.csm.updateFrustums()}},{key:"enable",value:function(e){this.camera.position.copy(e.object.position),e.target.copy(this.camera.position),e.target.z=0,e.maxDistance=1e4,e.enableRotate=!1}},{key:"topView",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3;this.camera.position.copy(e.target),this.camera.position.z=t,this.camera.updateMatrixWorld()}},{key:"resize",value:function(e,t){this.camera.left=-e/2,this.camera.right=e/2,this.camera.top=t/2,this.camera.bottom=-t/2,this.camera.updateProjectionMatrix()}}]),e}(),Et=function(){function e(t){Object(dt.a)(this,e),this.controls=void 0,this.perspective=void 0,this.orthographic=void 0,this.current=void 0,this.csm=void 0,this.perspective=new Nt(t),this.controls=new Dt(this.perspective.camera,t),this.current=this.perspective,this.current.enable(this.controls)}return Object(ut.a)(e,[{key:"initOrthographic",value:function(e,t){this.orthographic=new It(e,t),this.csm=t}},{key:"resize",value:function(e,t){this.perspective.resize(e,t),this.orthographic&&this.orthographic.resize(e,t)}},{key:"zoomIn",value:function(e){var t=this.controls.object.position.clone(),n=(new ft.L).subVectors(t,this.controls.target);n.normalize(),n.multiplyScalar(10*e),this.controls.object.position.sub(n),this.controls.object.updateProjectionMatrix(),this.current.update(this.controls)}},{key:"zoomOut",value:function(e){var t=this.controls.object.position.clone(),n=(new ft.L).subVectors(t,this.controls.target);n.normalize(),n.multiplyScalar(10*e),this.controls.object.position.add(n),this.controls.object.updateProjectionMatrix(),this.current.update(this.controls)}},{key:"update",value:function(){this.current.update(this.controls)}},{key:"enable",value:function(){this.current.enable(this.controls)}},{key:"topView",value:function(){if(this.current.camera.isOrthographicCamera)this.current.topView(this.controls);else{var e=this.controls.target.distanceTo(this.controls.object.position);this.current.topView(this.controls,e)}}},{key:"camera",get:function(){return this.current.camera}},{key:"target",get:function(){return this.controls.target}},{key:"useOrtho",value:function(){this.orthographic&&this.current!==this.orthographic&&this.swap()}},{key:"usePerspective",value:function(){this.current!==this.perspective&&this.swap()}},{key:"swap",value:function(){this.orthographic&&this.csm&&(this.current.topView(this.controls),this.current=this.current===this.perspective?this.orthographic:this.perspective,this.current.enable(this.controls),this.csm.camera=this.current.camera,this.csm.updateFrustums())}},{key:"focus",value:function(e){var t=this.current.camera.isOrthographicCamera;t&&this.swap(),this.controls.target=new ft.L(e.x,e.y,0),this.perspective.camera.position.x=e.x,this.perspective.camera.position.y=e.y,this.perspective.camera.position.z=1e3,t&&this.swap()}},{key:"screenToWorldOrthographic",value:function(e,t){if(this.current.camera.isOrthographicCamera){var n=this.current.camera,i=new ft.L;return i.set(e/window.innerWidth*2-1,-t/window.innerHeight*2+1,(n.near+n.far)/(n.near-n.far)),i.unproject(n)}}}]),e}(),At=function(){function e(t,n){Object(dt.a)(this,e),this.name=void 0,this.counter=void 0,this.manager=void 0,this.name=t,this.counter=0,this.manager=n}return Object(ut.a)(e,[{key:"start",value:function(){this.counter++,this.manager.update()}},{key:"stop",value:function(){this.counter--,this.manager.update()}},{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.counter," remaining")}},{key:"isRunning",get:function(){return this.counter>0}}]),e}(),zt=function(){function e(){Object(dt.a)(this,e),this.actions=void 0,this.actions={loadingGeometry:new At("Loading Geometry",this),parsingGeometry:new At("Parsing Geometry",this),loadingStyles:new At("Loading Styles",this),applyingStyles:new At("Applying Styles",this)}}return Object(ut.a)(e,[{key:"update",value:function(){var e=document.getElementById("viewStatusBar");if(e){for(var t in this.actions)if(this.actions[t].isRunning){var n=this.actions[t].toString();return void(e.innerHTML=n)}e.innerHTML="Ready."}}}]),e}(),Tt=function(){function e(t){Object(dt.a)(this,e),this.renderer=void 0,this.camDirection3=void 0,this.camDirection2=void 0,this.north=void 0,this.angle=void 0,this.renderer=t,this.camDirection3=new ft.L(0,0,0),this.camDirection2=new ft.K(0,0),this.north=new ft.K(0,1),this.angle=0}return Object(ut.a)(e,[{key:"update",value:function(e){this.camDirection3.copy(this.renderer.controls.target),this.camDirection3.sub(this.renderer.controls.camera.position),this.camDirection3.normalize(),this.camDirection2.set(this.camDirection3.x,this.camDirection3.y),1===this.renderer.controls.camera.up.y?this.angle=0:(this.camDirection2.normalize(),this.angle=Math.acos(this.north.dot(this.camDirection2)),this.camDirection2.x<0&&(this.angle=-this.angle)),e&&e(this.angle)}}]),e}(),Pt=function(){function e(t){Object(dt.a)(this,e),this.renderer=void 0,this.timelines=void 0,this.time=void 0,this.start=void 0,this.end=void 0,this.play=void 0,this.speed=void 0,this.renderer=t,this.timelines=[],this.time=31740,this.start=1/0,this.end=-1/0,this.play=!1,this.speed=1}return Object(ut.a)(e,[{key:"addTimeline",value:function(e){this.timelines.push(e),this.start=Math.min(this.start,e.start),this.end=Math.max(this.end,e.end)}},{key:"ready",get:function(){var e,t=Object(ht.a)(this.timelines);try{for(t.s();!(e=t.n()).done;){if(!e.value.ready)return!1}}catch(n){t.e(n)}finally{t.f()}return!0}},{key:"tick",value:function(){var e=1/60*this.speed;this.play&&this.ready&&(this.time+=e,this.renderer.matlib.setTime(this.time),this.renderer.changed=!0),this.render()}},{key:"render",value:function(){var e,t=Object(ht.a)(this.timelines);try{for(t.s();!(e=t.n()).done;){e.value.render(this.time)}}catch(n){t.e(n)}finally{t.f()}this.renderer.changed=!0}}]),e}(),Rt=function(){function e(t,n){Object(dt.a)(this,e),this.canvas=void 0,this.scene=void 0,this.pickingScene=void 0,this.renderer=void 0,this.controls=void 0,this.picker=void 0,this.matlib=void 0,this.csm=void 0,this.helper=void 0,this.compas=void 0,this.stats1=void 0,this.stats2=void 0,this.changed=void 0,this.updateShadows=!1,this.actionCall=void 0,this.status=void 0,this.timeline=void 0,this.canvas=t,this.actionCall=n,this.status=new zt,this.scene=new ft.D,this.pickingScene=new ft.D,this.controls=new Et(this.canvas),this.renderer=new ft.N({canvas:this.canvas,antialias:!0}),this.setupRenderer(),this.setupLightsAndShadows(),this.controls.initOrthographic(this.canvas,this.csm),this.controls.useOrtho(),this.compas=new Tt(this),this.matlib=new Mt(this.csm),this.picker=new Lt(this.renderer),this.changed=!0,this.timeline=new Pt(this)}return Object(ut.a)(e,[{key:"setupLightsAndShadows",value:function(){var e=new ft.k(16777215,5592405,.4);e.position.set(0,1,1),this.scene.add(e),this.scene.add(new ft.a(16777215,.5)),this.csm=new _t({fade:!0,mode:"practical",cascades:4,shadowBias:[-5e-4,-.001,-.001,-.003],shadowMapSize:2048,lightDirection:new ft.L(-1,-1,-1).normalize(),camera:this.controls.camera,parent:this.scene,lightNear:1,lightFar:1e4,maxFar:5e3,margin:0,lightIntensity:.2,autoUpdateHelper:!1}),this.helper=new St(this.csm),this.helper.visible=!0,this.scene.add(this.helper),this.helper.update()}},{key:"setupRenderer",value:function(){var e=this;this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.autoUpdate=!1,this.renderer.shadowMap.type=ft.z,this.renderer.setClearColor(1382688),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setAnimationLoop((function(){return e.frame()}))}},{key:"enableShadows",value:function(){this.updateShadows=!0,this.changed=!0,console.log("shadows enabled")}},{key:"disableShadows",value:function(){var e;this.updateShadows=!1,this.changed=!0;var t,n=Object(ht.a)(this.csm.lights);try{for(n.s();!(t=n.n()).done;){e=t.value;var i=this.renderer.getRenderTarget();e.shadow&&e.shadow.map&&(this.renderer.setRenderTarget(e.shadow.map),this.renderer.clear()),this.renderer.setRenderTarget(i)}}catch(a){n.e(a)}finally{n.f()}console.log("shadows disabled")}},{key:"frame",value:function(){this.actionCall(),this.timeline.tick(),this.controls.update(),this.changed&&(this.csm.update(),this.updateShadows&&(this.renderer.shadowMap.needsUpdate=!0),this.renderer.render(this.scene,this.controls.camera)),this.changed=!1}},{key:"click",value:function(e,t){var n=this.picker.pick(e,t,this.pickingScene,this.controls.camera);return this.select(n)}},{key:"select",value:function(e){this.picker.id!==e&&this.picker.select(e);var t=this.picker.layerAndOidForId(e);return console.log(t,this.picker.selected),t?this.matlib.setSelectedID(this.picker.selected):this.matlib.setSelectedID([-1,-1,-1,-1]),this.changed=!0,t}},{key:"setPointSize",value:function(e){this.matlib.setPointSize(e),this.changed=!0}},{key:"setLineWidth",value:function(e){this.matlib.setLineWidth(e),this.changed=!0}},{key:"updateHelper",value:function(){this.helper.update(),this.updateShadows=!1,this.changed=!0}},{key:"resize",value:function(e,t){this.controls.resize(e,t),this.renderer.setSize(e,t),this.changed=!0}}]),e}();!function(e){e[e.NOSELECT=0]="NOSELECT",e[e.SELECT=1]="SELECT",e[e.SELECTEDFIRST=2]="SELECTEDFIRST"}(Ct||(Ct={}));var Ft,Ut=function(){function e(t){Object(dt.a)(this,e),this.renderer=void 0,this.status=Ct.NOSELECT,this.cube=void 0,this.ends=void 0,this.renderer=t;var n=function(e,t,n){e*=.5,t*=.5,n*=.5;var i=new ft.e,a=[];return a.push(-e,-t,-n,-e,t,-n,-e,t,-n,e,t,-n,e,t,-n,e,-t,-n,e,-t,-n,-e,-t,-n,-e,-t,n,-e,t,n,-e,t,n,e,t,n,e,t,n,e,-t,n,e,-t,n,-e,-t,n,-e,-t,-n,-e,-t,n,-e,t,-n,-e,t,n,e,t,-n,e,t,n,e,-t,-n,e,-t,n),i.setAttribute("position",new ft.i(a,3)),i}(1,1,1),i=new ft.q({color:0,dashSize:3,gapSize:1});this.cube=new ft.r(n,i),this.renderer.scene.add(this.cube),this.ends=[],this.cube.visible=!1}return Object(ut.a)(e,[{key:"select",value:function(e,t){if(this.ends.push(new ft.K(e,t)),this.cube.visible=!0,this.renderer.changed=!0,this.ends.length<2)return this.cube.position.x=e,this.cube.position.y=t,this.cube.position.z=0,this.cube.scale.set(10,10,1e3),this.cube.updateMatrixWorld(),{start:[e,t]};var n=this.ends.pop(),i=this.ends.pop(),a=new ft.K(n.x,n.y);return a.min(i),n.max(i),i.copy(n).sub(a),this.cube.scale.set(i.x,i.y,1e3),this.cube.position.set(a.x+.5*i.x,a.y+.5*i.y,0),this.cube.updateMatrixWorld(),{start:[a.x,a.y],end:[n.x,n.y],size:[i.x,i.y]}}},{key:"clear",value:function(){this.cube.visible=!1,this.renderer.changed=!0}}]),e}(),Bt=n(58),Vt=n(16),Ht=n(17),Gt=function(){function e(){Object(dt.a)(this,e)}return Object(ut.a)(e,null,[{key:"base64tofloat32",value:function(e,t,n){var i=0,a=0,r=16e4,s=Math.floor(e.length/16*3),o=new Float32Array(s);setTimeout((function s(){for(var c=atob(e.substr(i,r)),l=new DataView(Uint8Array.from(c,(function(e){return e.charCodeAt(0)})).buffer),d=0;d<l.byteLength;d+=4)o[a++]=l.getFloat32(d,!0);t()||((i+=r)>=e.length?(n(o),o=null):setTimeout(s,10))}),10)}},{key:"base64toint32",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,a=0,r=0,s=16e4,o=Math.floor(e.length/16*3),c=new Int32Array(o),l=function o(){for(var l=atob(e.substr(a,s)),d=new DataView(Uint8Array.from(l,(function(e){return e.charCodeAt(0)})).buffer),u=0;u<d.byteLength;u+=4)c[r++]=d.getInt32(u,!0)+t;n()||((a+=s)>=e.length?(i(new Uint8Array(c.buffer)),c=null):setTimeout(o,10))};setTimeout(l,10)}},{key:"base64touint8",value:function(e,t){var n=0,i=0,a=Math.floor(e.length/4*3),r=new Uint8Array(a);setTimeout((function a(){for(var s=atob(e.substr(n,4e4)),o=Uint8Array.from(s,(function(e){return e.charCodeAt(0)})),c=0;c<o.length;c++)r[i++]=o[c];(n+=4e4)>=e.length?(t(r),r=null):setTimeout(a,10)}),10)}}]),e}(),Wt=function(){function e(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};Object(dt.a)(this,e),this.styles=void 0,this.styles=t||{},this.styles.buffer&&Gt.base64touint8(this.styles.buffer,(function(e){n.styles.buffer=e,i(n)})),this.styles.buffer_source&&this.styles.buffer_target&&Gt.base64touint8(this.styles.buffer_source,(function(e){n.styles.buffer_source=e,Gt.base64touint8(n.styles.buffer_target,(function(e){n.styles.buffer_target=e,i(n)}))}))}return Object(ut.a)(e,[{key:"pickable",get:function(){return!this.styles.pickable||this.styles.pickable}},{key:"visible",get:function(){return!this.styles.visible||this.styles.visible}},{key:"color_buffer",get:function(){if(this.styles.buffer)return this.styles.buffer;throw new Error("No colors defined")}},{key:"color_buffer_target",get:function(){if(this.styles.buffer_target)return this.styles.buffer_target;throw new Error("No target colors defined")}},{key:"color_buffer_source",get:function(){if(this.styles.buffer_source)return this.styles.buffer_source;throw new Error("No source colors defined")}}]),e}();function Kt(e,t,n,i,a){var r={i:0,ci:0,it:1,total_stop:t.length/Uint32Array.BYTES_PER_ELEMENT,view:new DataView(t.buffer)};setTimeout((function t(){for(var s,o=1e5*r.it,c=Math.min(o,r.total_stop);r.i<c;r.i++)s=3*(r.view.getUint32(r.i*Uint32Array.BYTES_PER_ELEMENT,!0)-e),i[r.ci++]=n[s],i[r.ci++]=n[s+1],i[r.ci++]=n[s+2];r.i<r.total_stop?(r.it++,setTimeout(t,4)):(a(),r=null)}),4)}function Xt(e,t,n){var i={i:0,ci:0,it:1,total_stop:e};setTimeout((function e(){for(var a=1e5*i.it*Uint8Array.BYTES_PER_ELEMENT,r=Math.min(a,i.total_stop);i.i<r;i.i++)t[i.ci++]=255,t[i.ci++]=255,t[i.ci++]=255;i.i<i.total_stop?(i.it++,setTimeout(e,4)):(n(),i=null)}),4)}!function(e){e[e.source=0]="source",e[e.target=1]="target",e[e.object=2]="object"}(Ft||(Ft={}));var Yt,Jt=function(){function e(t){Object(dt.a)(this,e),this.renderer=void 0,this.mesh=void 0,this.pickingMesh=void 0,this.visibility=void 0,this.renderer=t,this.visibility=!0}return Object(ut.a)(e,[{key:"visible",set:function(e){this.visibility=e,this.mesh&&(this.mesh.visible=e),this.pickingMesh&&(this.pickingMesh.visible=e)}},{key:"remove",value:function(){this.mesh=this.removeFrom(this.mesh,this.renderer.scene),this.pickingMesh=this.removeFrom(this.pickingMesh,this.renderer.pickingScene)}},{key:"removeFrom",value:function(e,t){e&&(t.remove(e),e.geometry.dispose())}},{key:"baseColors",value:function(e){for(var t=new Uint8Array(e),n=0;n<e;n++)t[n]=255;return t}},{key:"afterApplyStyle",value:function(){this.renderer.status.actions.applyingStyles.stop(),this.mesh&&(this.mesh.geometry.attributes.color.needsUpdate=!0,this.renderer.changed=!0)}},{key:"applyStyle",value:function(e,t,n){if(this.mesh&&this.mesh.geometry.attributes.objectID){this.renderer.status.actions.applyingStyles.start();var i=this.mesh.geometry.attributes.objectID.array,a=this.mesh.geometry.attributes.color.array;t?Kt(e,i,t.color_buffer,a,this.afterApplyStyle.bind(this)):Xt(i.length,a,this.afterApplyStyle.bind(this))}}}]),e}(),$t=function(e){Object(wt.a)(n,e);var t=Object(kt.a)(n);function n(){return Object(dt.a)(this,n),t.apply(this,arguments)}return Object(ut.a)(n,[{key:"applyStyle",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ft.source;if(this.mesh&&this.mesh.geometry.attributes.objectID){this.renderer.status.actions.applyingStyles.start();var i=this.mesh.geometry.attributes.objectID.array,a=this.mesh.geometry.attributes.color.array;t?n===Ft.source?Kt(e,i,t.color_buffer_source,a,this.afterApplyStyle.bind(this)):Kt(e,i,t.color_buffer_target,a,this.afterApplyStyle.bind(this)):Xt(i.length,a,this.afterApplyStyle.bind(this))}}}]),n}(Jt);!function(e){e[e.float32=0]="float32",e[e.int32=1]="int32",e[e.uint8=2]="uint8"}(Yt||(Yt={}));var Zt=function(){self.onmessage=function(e){var t=e.data,n={jobID:t.jobID,resID:t.resID};switch(t.data.datatype){case 0:n.buffer=function(e){var t=atob(e);return new Float32Array(Uint8Array.from(t,(function(e){return e.charCodeAt(0)})).buffer)}(t.data.buffer);break;case 1:n.buffer=function(e,t){var n=atob(e),i=new Int32Array(Uint8Array.from(n,(function(e){return e.charCodeAt(0)})).buffer);return i.forEach((function(e,n){return i[n]=e+t})),new Uint8Array(i.buffer)}(t.data.buffer,t.data.offset);break;case 2:n.buffer=function(e){var t=atob(e);return Uint8Array.from(t,(function(e){return e.charCodeAt(0)}))}(t.data.buffer)}postMessage(n)}},qt=function(){function e(){var t=this;Object(dt.a)(this,e),this.workers=void 0,this.worker_busy=void 0,this.queue=void 0,this.jobIDs=void 0,this.resultMap=void 0,this.workers=[],this.worker_busy=[],this.jobIDs=0,this.resultMap=new Map;for(var n=function(e){t.workers.push(function(e){var t=e.toString(),n=new Blob(["(".concat(t,")()")]);return new Worker(URL.createObjectURL(n))}(Zt)),t.worker_busy.push(!1),t.workers[e].onmessage=function(n){var i=n.data,a=i.buffer,r=i.jobID,s=i.resID,o=t.resultMap.get(r);o&&(o.data[s]=a,o.recieved++,o.recieved===o.expected&&(o.callback.apply(o,Object(Vt.a)(o.data)),t.resultMap.delete(r)),t.worker_busy[e]=!1,t.submit())}},i=0;i<20;++i)n(i);this.queue=[]}return Object(ut.a)(e,[{key:"worker",get:function(){for(var e=0;e<20;++e)if(!this.worker_busy[e])return e}},{key:"process",value:function(e,t){var n=this.jobIDs++;this.resultMap.set(n,{data:Array.apply(null,Array(e.length)).map((function(){})),recieved:0,expected:e.length,callback:t});for(var i=0;i<e.length;++i)this.queue.push({data:e[i],jobID:n,resID:i});this.submit()}},{key:"submit",value:function(){var e=this.worker;if(void 0!==e){var t=this.queue.shift();t&&(this.worker_busy[e]=!0,this.workers[e].postMessage(t))}}}],[{key:"Instance",get:function(){return this._instance||(this._instance=new this)}}]),e}();qt._instance=void 0;var Qt=function(e){Object(wt.a)(n,e);var t=Object(kt.a)(n);function n(e,i,a,r){var s;Object(dt.a)(this,n),s=t.call(this,i.renderer);var o=i.renderer.picker.offsetForLayer(i.layer.name);return qt.Instance.process([{datatype:Yt.float32,buffer:e.vertices},{datatype:Yt.int32,buffer:e.attributes.oid.data,offset:o}],(function(e,t){s.init(e,t,i),a(Object(Ht.a)(s))})),s}return Object(ut.a)(n,[{key:"init",value:function(e,t,n){var i=this.createGeometry(e,t);this.createMesh(i),this.createPickingMesh(i),this.visible=n.visible,this.renderer.changed=!0}},{key:"createPickingMesh",value:function(e){var t=new ft.v(e,this.renderer.matlib.pickingPolygonMaterial);this.renderer.pickingScene.add(t),this.pickingMesh=t}},{key:"createMesh",value:function(e){var t=this.renderer.matlib.polygonMaterial,n=new ft.v(e,t);n.receiveShadow=!0,n.castShadow=!0,this.renderer.scene.add(n),this.mesh=n}},{key:"createGeometry",value:function(e,t){var n=new ft.e;return n.setAttribute("position",new ft.d(e,3)),n.setAttribute("objectID",new ft.d(t,4,!0)),n.setAttribute("color",new ft.d(this.baseColors(e.length),3,!0)),n.computeVertexNormals(),n}}]),n}(Jt),en=function(e){Object(wt.a)(n,e);var t=Object(kt.a)(n);function n(e,i,a,r){var s;Object(dt.a)(this,n),s=t.call(this,i.renderer);var o=i.renderer.picker.offsetForLayer(i.layer.source);return qt.Instance.process([{datatype:Yt.float32,buffer:e.vertices},{datatype:Yt.int32,buffer:e.attributes.source_oid.data,offset:o}],(function(e,t){s.init(e,t,i),a(Object(Ht.a)(s))})),s}return Object(ut.a)(n,[{key:"init",value:function(e,t,n){var i=this.createGeometry(e,t);this.createMesh(i),this.createPickingMesh(i),this.visible=n.visible,this.renderer.changed=!0}},{key:"createPickingMesh",value:function(e){var t=new ft.v(e,this.renderer.matlib.pickingPolygonMaterial);this.renderer.pickingScene.add(t),this.pickingMesh=t}},{key:"createMesh",value:function(e){var t=this.renderer.matlib.polygonMaterial,n=new ft.v(e,t);n.receiveShadow=!0,n.castShadow=!0,this.renderer.scene.add(n),this.mesh=n}},{key:"createGeometry",value:function(e,t){var n=new ft.e;return n.setAttribute("position",new ft.d(e,3)),n.setAttribute("objectID",new ft.d(t,4,!0)),n.setAttribute("color",new ft.d(this.baseColors(e.length),3,!0)),n.computeVertexNormals(),n}}]),n}($t);function tn(e){for(var t=[],n=Math.PI/2,i=Math.PI/e,a=0;a<e;++a)t.push(0,0,0),t.push(Math.cos(n+i*a),Math.sin(n+i*a),0),t.push(Math.cos(n+i*(a+1)),Math.sin(n+i*(a+1)),0);return t}function nn(e){for(var t=[],n=Math.PI/2,i=Math.PI/e,a=0;a<e;++a)t.push(1,0,0),t.push(1-Math.cos(n+i*a),Math.sin(n+i*a),0),t.push(1-Math.cos(n+i*(a+1)),Math.sin(n+i*(a+1)),0);return t}function an(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[0,-1,0,1,-1,0,1,1,0,0,-1,0,1,1,0,0,1,0];return t=(t=t.concat(tn(e))).concat(nn(e))}var rn=function(e){Object(wt.a)(n,e);var t=Object(kt.a)(n);function n(e,i,a,r){var s;Object(dt.a)(this,n),s=t.call(this,i.renderer);var o=i.renderer.picker.offsetForLayer(i.layer.name);return qt.Instance.process([{datatype:Yt.float32,buffer:e.vertices},{datatype:Yt.int32,buffer:e.attributes.oid.data,offset:o}],(function(e,t){s.init(e,t,i),a(Object(Ht.a)(s))})),s}return Object(ut.a)(n,[{key:"init",value:function(e,t,n){var i=this.createGeometry(e,t);this.createMesh(i),this.createPickingMesh(i),this.visible=n.visible,this.renderer.changed=!0}},{key:"createPickingMesh",value:function(e){var t=new ft.v(e,this.renderer.matlib.pickingLineMaterial);t.frustumCulled=!1,this.renderer.pickingScene.add(t),this.pickingMesh=t}},{key:"createMesh",value:function(e){var t=new ft.v(e,this.renderer.matlib.lineMaterial);t.frustumCulled=!1,this.renderer.scene.add(t),this.mesh=t}},{key:"createGeometry",value:function(e,t){var n=new ft.m;return n.instanceCount=e.length/3,n.setAttribute("position",new ft.d(new Float32Array(an()),3)),n.setAttribute("lineStart",new ft.o(new ft.n(e,6,1),3,0)),n.setAttribute("lineEnd",new ft.o(new ft.n(e,6,1),3,3)),n.setAttribute("objectID",new ft.l(t,4,!0,1)),n.setAttribute("color",new ft.l(this.baseColors(e.length),3,!0,1)),n}}]),n}(Jt),sn=function(e){Object(wt.a)(n,e);var t=Object(kt.a)(n);function n(e,i,a,r){var s;Object(dt.a)(this,n),s=t.call(this,i.renderer);var o=i.renderer.picker.offsetForLayer(i.layer.source);return qt.Instance.process([{datatype:Yt.float32,buffer:e.vertices},{datatype:Yt.int32,buffer:e.attributes.source_oid.data,offset:o}],(function(e,t){s.init(e,t,i),a(Object(Ht.a)(s))})),s}return Object(ut.a)(n,[{key:"init",value:function(e,t,n){var i=this.createGeometry(e,t);this.createMesh(i),this.createPickingMesh(i),this.visible=n.visible,this.renderer.changed=!0}},{key:"createPickingMesh",value:function(e){var t=new ft.v(e,this.renderer.matlib.pickingLineMaterial);t.frustumCulled=!1,this.renderer.pickingScene.add(t),this.pickingMesh=t}},{key:"createMesh",value:function(e){var t=new ft.v(e,this.renderer.matlib.lineMaterial);t.frustumCulled=!1,this.renderer.scene.add(t),this.mesh=t}},{key:"createGeometry",value:function(e,t){var n=new ft.m;return n.instanceCount=e.length/3,n.setAttribute("position",new ft.d(new Float32Array(an()),3)),n.setAttribute("lineStart",new ft.o(new ft.n(e,6,1),3,0)),n.setAttribute("lineEnd",new ft.o(new ft.n(e,6,1),3,3)),n.setAttribute("objectID",new ft.l(t,4,!0,1)),n.setAttribute("color",new ft.l(this.baseColors(e.length),3,!0,1)),n}}]),n}(Jt),on=function(e){Object(wt.a)(n,e);var t=Object(kt.a)(n);function n(e,i,a,r){var s;Object(dt.a)(this,n),s=t.call(this,i.renderer);var o=i.renderer.picker.offsetForLayer(i.layer.name);return qt.Instance.process([{datatype:Yt.float32,buffer:e.vertices},{datatype:Yt.int32,buffer:e.attributes.oid.data,offset:o}],(function(e,t){s.init(e,t,i),a(Object(Ht.a)(s))})),s}return Object(ut.a)(n,[{key:"init",value:function(e,t,n){var i=this.createGeometry(e,t);this.createMesh(i),this.createPickingMesh(i),this.visible=n.visible,this.renderer.changed=!0}},{key:"createPickingMesh",value:function(e){var t=new ft.v(e,this.renderer.matlib.pickingPointMaterial);t.frustumCulled=!1,this.renderer.pickingScene.add(t),this.pickingMesh=t}},{key:"createMesh",value:function(e){var t=this.renderer.matlib.pointMaterial,n=new ft.v(e,t);n.frustumCulled=!1,this.renderer.scene.add(n),this.mesh=n}},{key:"createGeometry",value:function(e,t){var n=new ft.x(5,0),i=new Float32Array(n.attributes.position.array);n.dispose();var a=new ft.m;return a.instanceCount=e.length/3,a.setAttribute("position",new ft.d(i,3)),a.setAttribute("location",new ft.l(e,3,!1,1)),a.setAttribute("objectID",new ft.l(t,4,!0,1)),a.setAttribute("color",new ft.l(this.baseColors(e.length),3,!0,1)),a.computeVertexNormals(),a}}]),n}(Jt),cn=function(e){Object(wt.a)(n,e);var t=Object(kt.a)(n);function n(e,i,a,r){var s;Object(dt.a)(this,n),s=t.call(this,i.renderer);var o=i.renderer.picker.offsetForLayer(i.layer.source);return qt.Instance.process([{datatype:Yt.float32,buffer:e.vertices},{datatype:Yt.int32,buffer:e.attributes.source_oid.data,offset:o}],(function(e,t){s.init(e,t,i),a(Object(Ht.a)(s))})),s}return Object(ut.a)(n,[{key:"init",value:function(e,t,n){var i=this.createGeometry(e,t);this.createMesh(i),this.createPickingMesh(i),this.visible=n.visible,this.renderer.changed=!0}},{key:"createPickingMesh",value:function(e){var t=new ft.v(e,this.renderer.matlib.pickingPointMaterial);t.frustumCulled=!1,this.renderer.pickingScene.add(t),this.pickingMesh=t}},{key:"createMesh",value:function(e){var t=this.renderer.matlib.pointMaterial,n=new ft.v(e,t);n.frustumCulled=!1,this.renderer.scene.add(n),this.mesh=n}},{key:"createGeometry",value:function(e,t){var n=new ft.x(5,0),i=new Float32Array(n.attributes.position.array);n.dispose();var a=new ft.m;return a.instanceCount=e.length/3,a.setAttribute("position",new ft.d(i,3)),a.setAttribute("location",new ft.l(e,3,!1,1)),a.setAttribute("objectID",new ft.l(t,4,!0,1)),a.setAttribute("color",new ft.l(this.baseColors(e.length),3,!0,1)),a.computeVertexNormals(),a}}]),n}($t),ln=function(e){Object(wt.a)(n,e);var t=Object(kt.a)(n);function n(e,i,a,r){var s;Object(dt.a)(this,n),(s=t.call(this,i.renderer)).time=void 0,s.time=e.time;var o=i.layer.getOffset();return qt.Instance.process([{datatype:Yt.float32,buffer:e.from},{datatype:Yt.float32,buffer:e.to},{datatype:Yt.int32,buffer:e.oid,offset:o},{datatype:Yt.float32,buffer:e.from_speed},{datatype:Yt.float32,buffer:e.to_speed}],(function(e,t,n,i,r){s.init(e,t,n,i,r),a(Object(Ht.a)(s))})),s}return Object(ut.a)(n,[{key:"init",value:function(e,t,n,i,a){var r=this.createGeometry(e,t,n,i,a);this.createMesh(r),this.createPickingMesh(r),this.visible=!0,this.renderer.changed=!0}},{key:"createMesh",value:function(e){var t=this.renderer.matlib.agentMaterial,n=new ft.v(e,t);n.frustumCulled=!1,this.renderer.scene.add(n),this.mesh=n}},{key:"createPickingMesh",value:function(e){var t=this.renderer.matlib.pickingAgentMaterial,n=new ft.v(e,t);n.frustumCulled=!1,this.renderer.pickingScene.add(n),this.pickingMesh=n}},{key:"createGeometry",value:function(e,t,n,i,a){var r=new ft.x(35,0),s=new Float32Array(r.attributes.position.array);r.dispose();var o=new ft.m;return o.instanceCount=e.length/3,o.setAttribute("position",new ft.d(s,3)),o.setAttribute("from",new ft.l(e,3,!1,1)),o.setAttribute("from_speed",new ft.l(i,1,!1,1)),o.setAttribute("to",new ft.l(t,3,!1,1)),o.setAttribute("to_speed",new ft.l(a,1,!1,1)),o.setAttribute("objectID",new ft.l(n,4,!0,1)),o.setAttribute("color",new ft.l(this.baseColors(e.length),3,!0,1)),o.computeVertexNormals(),o}}]),n}(Jt),dn={model:{simplepolygon:Qt,simpleline:rn,simplepoint:on},proxy:{simpleline:sn,simplepolygon:en,simplepoint:cn}},un=Object.keys(dn.model),hn=Object.keys(dn.proxy);function fn(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){return!1};if(e.tags&&!0===e.tags.proxy){if(hn.includes(e.type))return new dn.proxy[e.type](e,t,n,i);throw new Error("Proxy type ".concat(e.type," is not registered"))}if(un.includes(e.type))return new dn.model[e.type](e,t,n,i);throw new Error("Model type ".concat(e.type," is not registered"))}var mn=function(){function e(){Object(dt.a)(this,e),this.stopFlag=void 0,this.loaded=void 0,this.loaded=!1}return Object(ut.a)(e,[{key:"get",value:function(e,t){var n=this;this.stopFlag=ee.a.CancelToken.source(),e.renderer.status.actions.loadingGeometry.start();var i=(Math.abs(e.x)+Math.abs(e.y))%6;ne.get("/api/data/".concat(e.layer.project,"/").concat(e.layer.name,"/grid/stream/").concat(e.sourceFile),{cancelToken:this.stopFlag.token,baseURL:"http://static".concat(i,".").concat(Sn)}).then((function(i){e.renderer.status.actions.loadingGeometry.stop(),n.loaded||(n.loaded=!0,n.stopFlag=null,t(i.data))})).catch((function(t){e.renderer.status.actions.loadingGeometry.stop(),n.stopFlag=null}))}},{key:"abort",value:function(){this.stopFlag&&this.stopFlag.cancel(),this.stopFlag=null}}]),e}(),pn=function(){function e(t,n,i){Object(dt.a)(this,e),this.bbox=void 0,this.brect=void 0,this.x=void 0,this.y=void 0,this.renderer=void 0,this.layer=void 0,this.sourceFile=void 0,this.models=void 0,this.isVisible=void 0,this.loader=void 0,this.caching=void 0,this.bbox=[Object(Bt.a)(ft.L,Object(Vt.a)(t.box[0])),Object(Bt.a)(ft.L,Object(Vt.a)(t.box[1]))],this.brect=[new ft.K(this.bbox[0].x,this.bbox[0].y),new ft.K(this.bbox[1].x,this.bbox[1].y)],this.x=t.x,this.y=t.y,this.sourceFile=t.file,this.layer=i,this.renderer=n,this.isVisible=!1,this.models=[],this.loader=new mn,this.caching=!1}return Object(ut.a)(e,[{key:"visible",get:function(){return this.isVisible},set:function(e){this.isVisible!==e&&(this.isVisible=e,e?this.show():this.hide())}},{key:"show",value:function(){var e=this;if(this.loader.loaded||this.loader.get(this,(function(t){if(!e.isVisible&&!e.caching)return e.disposeCache();var n,i=Object(ht.a)(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;e.renderer.status.actions.parsingGeometry.start(),fn(a,e,(function(t){return e.renderer.status.actions.parsingGeometry.stop(),e.models.push(t),e.isVisible||e.caching?(e.layer.applyStyleToModels(e.models),e.isVisible||e.caching?void 0:e.disposeCache()):e.disposeCache()}),(function(){return e.isVisible||(e.renderer.status.actions.parsingGeometry.stop(),e.disposeCache()),!e.isVisible}))}}catch(r){i.e(r)}finally{i.f()}})),this.caching){var t,n=Object(ht.a)(this.models);try{for(n.s();!(t=n.n()).done;){t.value.visible=!0}}catch(i){n.e(i)}finally{n.f()}}}},{key:"hide",value:function(){if(this.loader.loaded||this.loader.abort(),this.caching){var e,t=Object(ht.a)(this.models);try{for(t.s();!(e=t.n()).done;){e.value.visible=!1}}catch(n){t.e(n)}finally{t.f()}}else this.disposeCache()}},{key:"remove",value:function(){if(this.models.length>0){var e,t=Object(ht.a)(this.models);try{for(t.s();!(e=t.n()).done;){e.value.remove()}}catch(n){t.e(n)}finally{t.f()}this.models=[]}}},{key:"enableCache",value:function(){this.caching=!0}},{key:"disableCache",value:function(){this.caching=!1,this.isVisible||this.disposeCache()}},{key:"disposeCache",value:function(){console.log("dispose cache");var e,t=Object(ht.a)(this.models);try{for(t.s();!(e=t.n()).done;){e.value.remove()}}catch(n){t.e(n)}finally{t.f()}this.models=[],this.loader.loaded=!1}}]),e}();function vn(e,t){var n=Math.max(Math.abs(e),Math.abs(t));if(0===e&&0===t)return 0;var i,a=8*((i=n-1)*(i+1)/2);if(e>Math.abs(t)||e===t&&e>0)return a+n+t;if((t>Math.abs(e)||t===-e)&&t>0)return a+4*n-n-e;if(e<t||e===t&&e<0)return a+5*n-t;if(t<e||-t===e&&t<0)return a+7*n+e;throw new Error("Cannot covert to 1D")}var bn,gn=function(){function e(t,n,i){Object(dt.a)(this,e),this.bbox=void 0,this.brect=void 0,this.focusPoint=void 0,this.renderer=void 0,this.tileSize=void 0,this.tiles=void 0,this.visible_radius=void 0,this.visible=void 0,this.visibleSwap=void 0,this.zero2=void 0,this.layer=void 0,this.tileSize=t.tile_size,this.renderer=n,this.layer=i,this.bbox=[new ft.L(1/0,1/0,1/0),new ft.L(-1/0,-1/0,-1/0)],this.tiles=new Map,this.createTiles(t,n,i),this.brect=[new ft.K(this.bbox[0].x,this.bbox[0].y),new ft.K(this.bbox[1].x,this.bbox[1].y)],this.focusPoint=new ft.K(1/0,1/0),this.visible_radius=2e3,this.visibleSwap=new Set,this.visible=new Set,this.zero2=new ft.K}return Object(ut.a)(e,[{key:"center",get:function(){return e=this.bbox,new ft.K(.5*(e[0].x+e[1].x),.5*(e[0].y+e[1].y));var e}},{key:"hide",value:function(){var e,t=Object(ht.a)(this.visible.values());try{for(t.s();!(e=t.n()).done;){e.value.visible=!1}}catch(n){t.e(n)}finally{t.f()}}},{key:"show",value:function(){var e,t=Object(ht.a)(this.visible.values());try{for(t.s();!(e=t.n()).done;){e.value.visible=!0}}catch(n){t.e(n)}finally{t.f()}}},{key:"createTiles",value:function(e,t,n){var i,a,r,s=Object(ht.a)(e.tiles);try{for(s.s();!(i=s.n()).done;){var o=i.value,c=vn(o.x,o.y),l=new pn(o,t,n);a=this.bbox,r=l.bbox,a[0].min(r[0]),a[1].max(r[1]),this.tiles.set(c,l)}}catch(d){s.e(d)}finally{s.f()}}},{key:"updateVisibleTiles",value:function(e){var t=this.focusPoint.clone().divideScalar(this.tileSize).floor(),n=new ft.K(e.x,e.y).divideScalar(this.tileSize).floor();t.equals(n)||(this.focusPoint.set(e.x,e.y),this.updateVisibility(n))}},{key:"reloadVisibility",value:function(){this.updateVisibility(this.focusPoint.clone().divideScalar(this.tileSize).floor())}},{key:"updateVisibility",value:function(e){var t=this,n=this.visible;this.visible=this.visibleSwap,this.visibleSwap=n;var i=Math.ceil(this.visible_radius/this.tileSize),a=e.clone().subScalar(i),r=e.clone().addScalar(i+1);this.visible.clear();for(var s=a.x;s<r.x;++s)for(var o=a.y;o<r.y;++o){var c=vn(s,o),l=this.tiles.get(c);l&&(l.visible=!0,this.visible.add(l))}this.visibleSwap.forEach((function(e){t.visible.has(e)||(e.visible=!1)}))}}]),e}(),jn=function(){function e(t,n,i,a){Object(dt.a)(this,e),this.start=void 0,this.end=void 0,this.length=void 0,this.file=void 0,this.renderer=void 0,this.layer=void 0,this.moves=void 0,this.loading=void 0,this.init=void 0,this.acitve=void 0,this.delayedCall=void 0,this.start=t.start_time,this.length=n,this.end=this.start+n,this.file=t.file,this.renderer=i,this.layer=a,this.loading=!1,this.init=!1,this.delayedCall=void 0,this.acitve=-1,this.moves=[]}return Object(ut.a)(e,[{key:"load",value:function(e){var t=this;return!this.loading&&!this.init&&(this.loading=!0,this.delayedCall=setTimeout((function(){t.delayedCall=void 0,t.renderer.status.actions.loadingGeometry.start(),ne.get("/api/data/".concat(t.layer.project,"/").concat(t.layer.name,"/timeline/stream/").concat(t.file)).then((function(n){var i=n.data;t.renderer.status.actions.loadingGeometry.stop(),t.renderer.status.actions.parsingGeometry.start(),function(e,t,n,i){for(var a=0;a<e.length;++a)new ln({from:e.from[a],to:e.to[a],oid:e.oid[a],time:e.start_time+a,from_speed:e.from_speed[a],to_speed:e.to_speed[a]},t,n,i)}(i,t,(function(n){t.moves.push(n),n.visible=!1,t.moves.length===t.length&&(t.renderer.status.actions.parsingGeometry.stop(),t.finalizeInit(),e())}),(function(){return!1}))}))}),1e3),!0)}},{key:"finalizeInit",value:function(){this.moves.sort((function(e,t){return e.time-t.time})),this.init=!0,this.loading=!1}},{key:"render",value:function(e){if(this.init){var t=Math.floor(e)-this.start;this.acitve!==t&&(-1!==this.acitve&&(this.moves[this.acitve].visible=!1),t>=this.moves.length||(this.moves[t].visible=!0,this.acitve=t))}}},{key:"contains",value:function(e){return e>=this.start&&e<this.end}},{key:"remove",value:function(){var e,t=Object(ht.a)(this.moves);try{for(t.s();!(e=t.n()).done;){e.value.remove()}}catch(n){t.e(n)}finally{t.f()}this.delayedCall&&clearTimeout(this.delayedCall),this.loading=!1,this.init=!1,this.moves=[]}},{key:"hide",value:function(){-1!==this.acitve&&(this.moves[this.acitve].visible=!1)}},{key:"show",value:function(){-1!==this.acitve&&(this.moves[this.acitve].visible=!0)}}]),e}(),yn=n(139);!function(e){e[e.loading=0]="loading",e[e.wontload=1]="wontload",e[e.loaded=2]="loaded"}(bn||(bn={}));var On=function(){function e(t,n,i){Object(dt.a)(this,e),this.intervals=void 0,this.intervalLength=void 0,this.isVisible=void 0,this.active=void 0,this.start=void 0,this.end=void 0,this.fillingBuffer=void 0,this.loaded=void 0,this.intervals=[],this.intervalLength=t.interval_length,this.active=-1,this.isVisible=!0,this.fillingBuffer=!0,this.loaded=new Map;var a,r=Object(ht.a)(t.intervals);try{for(r.s();!(a=r.n()).done;){var s=a.value;this.intervals.push(new jn(s,this.intervalLength,n,i))}}catch(o){r.e(o)}finally{r.f()}this.intervals.sort((function(e,t){return e.start-t.start})),this.start=this.intervals[0].start,this.end=this.intervals[this.intervals.length-1].start+this.intervalLength,n.timeline.addTimeline(this)}return Object(ut.a)(e,[{key:"visible",set:function(e){this.isVisible!==e&&(this.isVisible=e,e?this.show():this.hide())}},{key:"countLoaded",get:function(){var e,t=0,n=Object(ht.a)(this.loaded.values());try{for(n.s();!(e=n.n()).done;){e.value!==bn.loading&&t++}}catch(i){n.e(i)}finally{n.f()}return t}},{key:"ready",get:function(){var e=this.countLoaded;return this.fillingBuffer?e>=2&&(this.fillingBuffer=!1,!0):e>=2}},{key:"render",value:function(e){this.isVisible&&(this.updateLoaded(e),this.intervals[this.active]&&this.intervals[this.active].contains(e)||this.swapActive(e),-1!==this.active&&this.intervals[this.active].render(e))}},{key:"updateLoaded",value:function(e){for(var t=this.current(e),n=t;n<t+5;n++)this.loadInterval(n);this.discard(t)}},{key:"swapActive",value:function(e){var t=this.current(e);this.active=-1,this.intervals[t].init&&(this.active=t)}},{key:"current",value:function(e){return Object(yn.le)(this.intervals,{start:e},(function(e,t){return e.start-t.start}))}},{key:"loadInterval",value:function(e){var t=this,n=this.intervals[e];n?n.init||n.loading||(this.loaded.set(e,bn.loading),n.load((function(){t.loaded.set(e,bn.loaded)}))):this.loaded.set(e,bn.wontload)}},{key:"discard",value:function(e){var t,n=Object(ht.a)(this.loaded.keys());try{for(n.s();!(t=n.n()).done;){var i=t.value;(i<e||i>=e+5)&&this.unloadInterval(i)}}catch(a){n.e(a)}finally{n.f()}}},{key:"unloadInterval",value:function(e){this.loaded.get(e)!==bn.wontload&&this.intervals[e].remove(),this.loaded.delete(e)}},{key:"hide",value:function(){this.visible=!1,-1!==this.active&&this.intervals[this.active].hide()}},{key:"show",value:function(){this.visible=!0,-1!==this.active&&this.intervals[this.active].show()}}]),e}(),xn=function(){function e(t,n,i,a){Object(dt.a)(this,e),this.name=void 0,this.project=void 0,this.renderer=void 0,this.grid=void 0,this.timeline=void 0,this.style=void 0,this.visibility=void 0,this.name=i.name,this.project=n,this.renderer=t,this.visibility=!0}return Object(ut.a)(e,[{key:"visible",get:function(){return this.visibility},set:function(e){e!==this.visibility&&(this.visibility=e,this.visibility?this.show():this.hide())}},{key:"init",value:function(e){e.grid&&(this.grid=new gn(e.grid,this.renderer,this),this.renderer.controls.focus(this.grid.center),this.grid.updateVisibleTiles(this.renderer.controls.target),this.renderer.changed=!0),e.timeline&&(this.timeline=new On(e.timeline,this.renderer,this),this.renderer.changed=!0)}},{key:"updateVisibleRadius",value:function(e){this.visibility&&this.grid&&this.grid.updateVisibleTiles(e)}},{key:"hide",value:function(){this.grid&&this.grid.hide(),this.timeline&&this.timeline.hide(),this.renderer.changed=!0}},{key:"show",value:function(){this.grid&&this.grid.reloadVisibility(),this.timeline&&this.timeline.show(),this.renderer.changed=!0}},{key:"setVisibleRadius",value:function(e){this.grid&&(this.grid.visible_radius=e,this.visible&&this.grid.reloadVisibility()),this.renderer.changed=!0}},{key:"applyStyle",value:function(e){var t=this;ne.get("/api/data/".concat(this.project,"/styles/").concat(e,"/").concat(this.name,".json"),{headers:{"Cache-Control":"no-cache",Pragma:"no-cache",Expires:"0"}}).then((function(e){new Wt(e.data,(function(e){if(t.style=e,t.grid){var n,i=Object(ht.a)(t.grid.tiles.values());try{for(i.s();!(n=i.n()).done;){var a=n.value;t.applyStyleToModels(a.models)}}catch(r){i.e(r)}finally{i.f()}}}))})).catch((function(){t.clearStyle()}))}},{key:"clearStyle",value:function(){if(this.style=void 0,this.grid){var e,t=Object(ht.a)(this.grid.tiles.values());try{for(t.s();!(e=t.n()).done;){var n=e.value;this.applyStyleToModels(n.models)}}catch(i){t.e(i)}finally{t.f()}}}},{key:"enableCache",value:function(){if(this.grid){var e,t=Object(ht.a)(this.grid.tiles.values());try{for(t.s();!(e=t.n()).done;){e.value.enableCache()}}catch(n){t.e(n)}finally{t.f()}}}},{key:"disableCache",value:function(){if(this.grid){var e,t=Object(ht.a)(this.grid.tiles.values());try{for(t.s();!(e=t.n()).done;){e.value.disableCache()}}catch(n){t.e(n)}finally{t.f()}}}}]),e}(),_n=function(e){Object(wt.a)(n,e);var t=Object(kt.a)(n);function n(e,i,a,r){var s;return Object(dt.a)(this,n),(s=t.call(this,e,i,a,r)).size=void 0,s.size=a.size,s.renderer.picker.offsetForLayer(s.name,s.size),s.init(a),s}return Object(ut.a)(n,[{key:"applyStyleToModels",value:function(e){var t,n=this.renderer.picker.offsetForLayer(this.name),i=Object(ht.a)(e);try{for(i.s();!(t=i.n()).done;){t.value.applyStyle(n,this.style)}}catch(a){i.e(a)}finally{i.f()}}},{key:"getOffset",value:function(){return this.renderer.picker.offsetForLayer(this.name)}}]),n}(xn),wn=function(e){Object(wt.a)(n,e);var t=Object(kt.a)(n);function n(e,i,a,r){var s;return Object(dt.a)(this,n),(s=t.call(this,e,i,a,r)).source=void 0,s.target=void 0,s.size=void 0,s.source=a.source,s.target=a.target,s.size=a.size,s.renderer.picker.offsetForLayer(s.source,s.size[0]),s.renderer.picker.offsetForLayer(s.target,s.size[1]),s.init(a),s}return Object(ut.a)(n,[{key:"applyStyleToModels",value:function(e){var t,n=this.renderer.picker.offsetForLayer(this.source),i=Object(ht.a)(e);try{for(i.s();!(t=i.n()).done;){t.value.applyStyle(n,this.style)}}catch(a){i.e(a)}finally{i.f()}}},{key:"getOffset",value:function(){return this.renderer.picker.offsetForLayer(this.source)}}]),n}(xn),kn=function(){function e(t,n){var i=this;Object(dt.a)(this,e),this.name=void 0,this.renderer=void 0,this.layers=void 0,this.styles=void 0,this.usedStyle=void 0,this.name=t,this.renderer=n,this.layers=[],this.styles=[],ne.get("/api/data/".concat(this.name,"/layout.json"),{headers:{"Cache-Control":"no-cache",Pragma:"no-cache",Expires:"0"}}).then((function(e){var t=e.data.styles;i.styles=t;var n,a=Object(ht.a)(e.data.layers);try{for(a.s();!(n=a.n()).done;){var r=n.value;r.disabled||!r.grid&&!r.timeline||"layer"===r.type&&i.layers.push(new _n(i.renderer,i.name,r,t))}}catch(l){a.e(l)}finally{a.f()}var s,o=Object(ht.a)(e.data.layers);try{for(o.s();!(s=o.n()).done;){var c=s.value;c.disabled||!c.grid&&!c.timeline||"overlay"===c.type&&i.layers.push(new wn(i.renderer,i.name,c,t))}}catch(l){o.e(l)}finally{o.f()}}))}return Object(ut.a)(e,[{key:"updateVisibleRadius",value:function(e){var t,n=Object(ht.a)(this.layers);try{for(n.s();!(t=n.n()).done;){t.value.updateVisibleRadius(e)}}catch(i){n.e(i)}finally{n.f()}}},{key:"setVisibleRadius",value:function(e){var t,n=Object(ht.a)(this.layers);try{for(n.s();!(t=n.n()).done;){t.value.setVisibleRadius(e)}}catch(i){n.e(i)}finally{n.f()}}},{key:"useCache",value:function(e){var t,n=Object(ht.a)(this.layers);try{for(n.s();!(t=n.n()).done;){var i=t.value;e?i.enableCache():i.disableCache()}}catch(a){n.e(a)}finally{n.f()}}},{key:"applyStyle",value:function(e){if(-1!==this.styles.indexOf(e)){this.usedStyle=e;var t,n=Object(ht.a)(this.layers);try{for(n.s();!(t=n.n()).done;){t.value.applyStyle(e)}}catch(i){n.e(i)}finally{n.f()}}}},{key:"clearStyle",value:function(){this.usedStyle=void 0;var e,t=Object(ht.a)(this.layers);try{for(t.s();!(e=t.n()).done;){e.value.clearStyle()}}catch(n){t.e(n)}finally{t.f()}}}]),e}(),Sn=window.location.host;var Ln,Cn,Mn=function(){function e(t,n){Object(dt.a)(this,e),this.renderer=void 0,this.project=void 0,this.keymap=void 0,this.showMetaCallback=void 0,this.closeMetaCallback=void 0,this.updateCompasCallback=void 0,this.updateTimeCallback=void 0,this.clickTime=void 0,this.renderer=t,this.project=n,this.keymap={},this.clickTime=0}return Object(ut.a)(e,[{key:"select",value:function(e){this.renderer.select(e)}},{key:"selectCoord",value:function(e,t){var n=this,i=this.renderer.click(e,t);i&&ne.post(C,{project:this.project.name,layer:i.layer,oid:i.oid}).then((function(e){console.log(e.data);var t=e.data;t.oid=i.oid,t.layer=i.layer,n.showMetaCallback&&n.showMetaCallback(e.data)}))}},{key:"mouseDown",value:function(e,t,n,i){this.clickTime=n}},{key:"mouseUp",value:function(e,t,n,i){n-this.clickTime<200&&(0===i?this.selectCoord(e,t):2===i&&this.closeMetaCallback&&this.closeMetaCallback()),this.clickTime=n}},{key:"keyDown",value:function(e){console.log("key down",e),this.keymap[e]=!0}},{key:"keyUp",value:function(e){console.log("key up",e),this.keymap[e]=!1}},{key:"actions",value:function(){this.keymap.KeyU&&(this.renderer.updateHelper(),this.keymap.KeyU=!1),this.updateTimeCallback&&this.updateTimeCallback(this.renderer.timeline.time,this.renderer.timeline.start,this.renderer.timeline.end)}},{key:"swapCamera",value:function(){this.renderer.controls.swap(),this.renderer.changed=!0}},{key:"resize",value:function(e,t){this.renderer.resize(e,t)}},{key:"zoomIn",value:function(){this.renderer.controls.zoomIn(10),this.renderer.changed=!0}},{key:"zoomOut",value:function(){this.renderer.controls.zoomOut(10),this.renderer.changed=!0}},{key:"setPointSize",value:function(e){this.renderer.setPointSize(e)}},{key:"setLineWidth",value:function(e){this.renderer.setLineWidth(e)}},{key:"updateVisibleRadius",value:function(e){this.project.updateVisibleRadius(e)}},{key:"setVisibleRadius",value:function(e){this.project.setVisibleRadius(e)}},{key:"useCache",value:function(e){this.project.useCache(e)}},{key:"applyStyle",value:function(e){this.project.applyStyle(e)}},{key:"useShadows",value:function(e){e?this.renderer.enableShadows():this.renderer.disableShadows()}},{key:"setTime",value:function(e){this.renderer.timeline.time=e}},{key:"setPlay",value:function(e){this.renderer.timeline.play=e}},{key:"getPlay",value:function(){return this.renderer.timeline.play}},{key:"setSpeed",value:function(e){this.renderer.timeline.speed=e}},{key:"getSpeed",value:function(){return this.renderer.timeline.speed}}]),e}(),Dn=function(){function e(t,n){var i=this;Object(dt.a)(this,e),this.project_name=void 0,this.canvas=void 0,this.renderer=void 0,this.selector=void 0,this.project=void 0,this.controls=void 0,this.project_name=t,this.canvas=n,this.renderer=new Rt(this.canvas,(function(){i.controls&&i.controls.actions()})),this.selector=new Ut(this.renderer)}return Object(ut.a)(e,[{key:"init",value:function(){var e=this;this.project=new kn(this.project_name,this.renderer),this.controls=new Mn(this.renderer,this.project),this.renderer.controls.controls.addEventListener("change",(function(){return e.moved()}))}},{key:"moved",value:function(){var e;this.project.updateVisibleRadius(this.renderer.controls.target),this.renderer.compas.update(null===(e=this.controls)||void 0===e?void 0:e.updateCompasCallback),this.renderer.changed=!0}},{key:"exit",value:function(){}}]),e}(),Nn=n(343),In=n(344),En=n(345),An=n(346),zn=n(347),Tn=n(348),Pn=n(349),Rn=n(350),Fn=n(351),Un=n(352);function Bn(e){var t=e.children,n=e.isShown;return Object(re.jsx)($.a,{className:"viewMenu",display:n?"block":"none",children:t})}function Vn(e){var t=e.engine,n=e.visible,a=Object(i.useState)(void 0),r=Object(J.a)(a,2),s=r[0],o=r[1],c=function(e){null!=t&&(o(e),e?t.project.applyStyle(e):t.project.clearStyle())};return Object(i.useEffect)((function(){t&&o(t.project.usedStyle)}),[t]),Object(re.jsx)(re.Fragment,{children:n&&Object(re.jsxs)(re.Fragment,{children:[Object(re.jsx)(Z.a,{size:300,className:"title",children:"Styles"}),Object(re.jsxs)($.a,{className:"styles",children:[null===t||void 0===t?void 0:t.project.styles.map((function(e){return Object(re.jsx)($.a,{onClick:function(){return c(e)},className:"style ".concat(s===e?"selected":""),children:e},e)})),Object(re.jsx)($.a,{onClick:function(){return c()},className:"style ".concat(void 0===s?"selected":""),children:"No Style"})]})]})})}function Hn(e){var t=e.engine,n=e.visible,a=Object(i.useState)([]),r=Object(J.a)(a,2),s=r[0],o=r[1];Object(i.useEffect)((function(){t&&o(t.project.layers.map((function(e){return e.visible})))}),[t,n]);return Object(re.jsx)(re.Fragment,{children:n&&Object(re.jsxs)(re.Fragment,{children:[Object(re.jsx)(Z.a,{size:300,className:"title",children:"Layers"}),Object(re.jsx)($.a,{className:"layers",children:null===t||void 0===t?void 0:t.project.layers.map((function(e,n){return Object(re.jsxs)($.a,{className:"layer",onClick:function(){return e=n,void(t&&(t.project.layers[e].visible=!s[e],o(s.map((function(t,n){return n===e?!t:t})))));var e},children:[s[n]?Object(re.jsx)(He.a,{icon:Nn.a}):Object(re.jsx)(He.a,{icon:In.a}),Object(re.jsx)($.a,{className:"layerName",children:e.name})]},e.name)}))})]})})}function Gn(e){var t=e.engine,n=e.visible,a=Object(i.useState)(0),r=Object(J.a)(a,2),s=r[0],o=r[1],c=Object(i.useState)(0),l=Object(J.a)(c,2),d=l[0],u=l[1],h=Object(i.useState)(!1),f=Object(J.a)(h,2),m=f[0],p=f[1],v=Object(i.useState)(0),b=Object(J.a)(v,2),g=b[0],j=b[1],y=Object(i.useState)(1),O=Object(J.a)(y,2),x=O[0],_=O[1],w=Object(i.useRef)(null),k=function(e,t,n){o(Math.floor(e)),u(t),j(n)};Object(i.useEffect)((function(){t&&t.controls&&t.controls.setSpeed(x)}),[x,t]),Object(i.useEffect)((function(){t&&t.controls&&(t.controls.updateTimeCallback=k,p(t.controls.getPlay()),_(t.controls.getSpeed()))}),[t]);var S=function(e){return e.toString().padStart(2,"0")};return Object(re.jsx)(re.Fragment,{children:n&&Object(re.jsxs)(re.Fragment,{children:[Object(re.jsx)(Z.a,{size:300,className:"title",children:"Timeline"}),Object(re.jsx)($.a,{className:"timeline",children:Object(re.jsxs)($.a,{className:"setting",children:[Object(re.jsxs)($.a,{display:"flex",flexDirection:"row",justifyContent:"center",children:[Object(re.jsxs)($.a,{flexGrow:"1",children:[Object(re.jsx)(Z.a,{size:100,children:"Time"}),Object(re.jsx)(Z.a,{size:400,children:S(Math.floor(s/3600))+":"+S(Math.floor(s%3600/60))+":"+S(Math.floor(s%60))})]}),Object(re.jsxs)($.a,{children:[Object(re.jsx)(Le.a,{icon:m?En.a:An.a,appearance:"minimal",onClick:function(){t&&t.controls&&(t.controls.setPlay(!m),p(!m))}}),Object(re.jsx)(ot.a,{title:"Select speed",options:[.25,.5,1,2,5,10,20,30,60].map((function(e){return{label:"".concat(e,"\xd7"),value:e}})),selected:"".concat(x,"\xd7"),hasFilter:!1,onSelect:function(e){return _(e.value)},children:Object(re.jsx)(q.a,{appearance:"minimal",children:"Speed ".concat(x,"\xd7")})})]})]}),Object(re.jsx)($.a,{className:"controls",children:Object(re.jsx)($.a,{className:"timescroll",children:Object(re.jsx)("input",{ref:w,type:"range",min:d,max:g,step:1,value:s,onChange:function(){return function(){var e,n=null===(e=w.current)||void 0===e?void 0:e.value;if(t&&t.controls&&n){var i=parseFloat(n);isNaN(i)||t.controls.setTime(i)}}()}})})})]})})]})})}function Wn(e){var t=e.engine,n=e.visible,a=Object(i.useState)(2e3),r=Object(J.a)(a,2),s=r[0],o=r[1],c=Object(i.useState)(1),l=Object(J.a)(c,2),d=l[0],u=l[1],h=Object(i.useState)(5),f=Object(J.a)(h,2),m=f[0],p=f[1],v=Object(i.useState)(!1),b=Object(J.a)(v,2),g=b[0],j=b[1],y=Object(i.useState)(!1),O=Object(J.a)(y,2),x=O[0],_=O[1];Object(i.useEffect)((function(){t&&Promise.resolve(1).then((function(){var e;return null===(e=t.controls)||void 0===e?void 0:e.setVisibleRadius(s)}))}),[t,s]),Object(i.useEffect)((function(){t&&Promise.resolve(1).then((function(){var e;null===(e=t.controls)||void 0===e||e.useShadows(g)}))}),[t,g]),Object(i.useEffect)((function(){t&&Promise.resolve(1).then((function(){var e;null===(e=t.controls)||void 0===e||e.useCache(x)}))}),[t,x]),Object(i.useEffect)((function(){t&&Promise.resolve(1).then((function(){var e;return null===(e=t.controls)||void 0===e?void 0:e.setPointSize(d)}))}),[t,d]),Object(i.useEffect)((function(){t&&Promise.resolve(1).then((function(){var e;return null===(e=t.controls)||void 0===e?void 0:e.setLineWidth(m)}))}),[t,m]);return Object(re.jsx)(re.Fragment,{children:n&&Object(re.jsxs)(re.Fragment,{children:[Object(re.jsx)(Z.a,{size:300,className:"title",children:"Settings"}),Object(re.jsxs)($.a,{className:"settings",children:[Object(re.jsxs)($.a,{className:"setting",children:[Object(re.jsxs)(Z.a,{size:100,children:["Visible Radius: ",s]}),Object(re.jsx)($.a,{className:"controls",children:Object(re.jsx)("input",{type:"range",min:0,max:2e4,step:1e3,defaultValue:s,onChange:function(e){return function(e){var t=parseInt(e);t!==s&&o(t)}(e.target.value)}})})]}),Object(re.jsxs)($.a,{className:"setting",children:[Object(re.jsxs)(Z.a,{size:100,children:["Point Size: ",d]}),Object(re.jsx)($.a,{className:"controls",children:Object(re.jsx)("input",{type:"range",min:0,max:5,step:.1,defaultValue:d,onChange:function(e){return function(e){var t=parseFloat(e);t!==d&&u(t)}(e.target.value)}})})]}),Object(re.jsxs)($.a,{className:"setting",children:[Object(re.jsxs)(Z.a,{size:100,children:["Line width: ",m]}),Object(re.jsx)($.a,{className:"controls",children:Object(re.jsx)("input",{type:"range",min:0,max:10,step:.1,defaultValue:m,onChange:function(e){return function(e){var t=parseFloat(e);t!==d&&p(t)}(e.target.value)}})})]}),Object(re.jsx)($.a,{className:"setting",children:Object(re.jsxs)($.a,{className:"inlineControls",children:[Object(re.jsxs)(Z.a,{size:100,children:["Shadows: ",g?"on":"off"]}),Object(re.jsx)(zn.a,{checked:g,onChange:function(e){return function(e){t&&j(e.target.checked)}(e)}})]})}),Object(re.jsx)($.a,{className:"setting",children:Object(re.jsxs)($.a,{className:"inlineControls",children:[Object(re.jsxs)(Z.a,{size:100,children:["Caching Data: ",x?"on":"off"]}),Object(re.jsx)(zn.a,{checked:x,onChange:function(e){return function(e){t&&_(e.target.checked)}(e)}})]})})]})]})})}function Kn(e){var t=e.engine,n=Object(i.useState)(0),a=Object(J.a)(n,2),r=a[0],s=a[1],o=function(e){var t=-180*e/Math.PI;s(t)};Object(i.useEffect)((function(){t&&t.controls&&(t.controls.updateCompasCallback=o)}),[t]);return Object(re.jsx)(xe.a,{content:"Reset view rotation",children:Object(re.jsx)(Le.a,{icon:Object(re.jsx)(Tn.a,{style:{transform:"rotate(".concat(r,"deg)")}}),appearance:"minimal",onClick:function(){null===t||void 0===t||t.renderer.controls.topView()}})})}function Xn(e){var t=e.engine,n=Object(i.useState)(!1),a=Object(J.a)(n,2),r=a[0],s=a[1],o=Object(i.useState)(Cn.D2),c=Object(J.a)(o,2),l=c[0],d=c[1],u=Object(i.useState)(Ln.None),h=Object(J.a)(u,2),f=h[0],m=h[1],p=function(e){r&&e===f?s(!1):(m(e),s(!0))};return Object(re.jsxs)($.a,{className:"viewControls",children:[Object(re.jsxs)($.a,{className:"controlBar",children:[Object(re.jsx)(xe.a,{content:"Layers",children:Object(re.jsx)(Le.a,{icon:De.a,className:f===Ln.Layers&&r?"active":"",appearance:"minimal",onClick:function(){return p(Ln.Layers)}})}),Object(re.jsx)(xe.a,{content:"Styles",children:Object(re.jsx)(Le.a,{icon:he.a,className:f===Ln.Styles&&r?"active":"",appearance:"minimal",onClick:function(){return p(Ln.Styles)}})}),Object(re.jsx)(xe.a,{content:"Settings",children:Object(re.jsx)(Le.a,{icon:Pn.a,className:f===Ln.Settings&&r?"active":"",appearance:"minimal",onClick:function(){return p(Ln.Settings)}})}),Object(re.jsx)(xe.a,{content:"Timeline",children:Object(re.jsx)(Le.a,{icon:Rn.a,className:f===Ln.Timeline&&r?"active":"",appearance:"minimal",onClick:function(){return p(Ln.Timeline)}})}),Object(re.jsx)(xe.a,{content:"Switch between 2D/3D view",children:Object(re.jsx)(q.a,{appearance:"minimal",id:"perspectiveControl",onClick:function(){var e;t&&(null===(e=t.controls)||void 0===e||e.swapCamera(),d(l===Cn.D2?Cn.D3:Cn.D2))},children:l===Cn.D2?"3D":"2D"})}),Object(re.jsx)(xe.a,{content:"Zoom in",children:Object(re.jsx)(Le.a,{icon:Fn.a,appearance:"minimal",onClick:function(){var e;null===t||void 0===t||null===(e=t.controls)||void 0===e||e.zoomIn()}})}),Object(re.jsx)(xe.a,{content:"Zoom out",children:Object(re.jsx)(Le.a,{icon:Un.a,appearance:"minimal",onClick:function(){var e;null===t||void 0===t||null===(e=t.controls)||void 0===e||e.zoomOut()}})}),Object(re.jsx)(Kn,{engine:t})]}),Object(re.jsxs)(Bn,{isShown:r,onClose:function(){return p(f)},children:[Object(re.jsx)(Hn,{engine:t,visible:f===Ln.Layers}),Object(re.jsx)(Vn,{engine:t,visible:f===Ln.Styles}),Object(re.jsx)(Wn,{engine:t,visible:f===Ln.Settings}),Object(re.jsx)(Gn,{engine:t,visible:f===Ln.Timeline})]})]})}!function(e){e[e.None=0]="None",e[e.Layers=1]="Layers",e[e.Styles=2]="Styles",e[e.Settings=3]="Settings",e[e.Timeline=4]="Timeline"}(Ln||(Ln={})),function(e){e[e.D2=0]="D2",e[e.D3=1]="D3"}(Cn||(Cn={}));var Yn=n(363);function Jn(e){var t=e.engine,n=Object(i.useState)({}),a=Object(J.a)(n,2),r=a[0],s=a[1],o=Object(i.useState)(!1),c=Object(J.a)(o,2),l=c[0],d=c[1],u=function(e){s(e),d(!0)},h=Object(i.useCallback)((function(){var e;null===t||void 0===t||null===(e=t.controls)||void 0===e||e.select(-1),d(!1)}),[null===t||void 0===t?void 0:t.controls]);return Object(i.useEffect)((function(){t&&t.controls&&(t.controls.showMetaCallback=u,t.controls.closeMetaCallback=h)}),[t,null===t||void 0===t?void 0:t.controls,h]),Object(re.jsx)(Yn.a,{title:"Metadata",hasCancel:!1,hasFooter:!1,width:"auto",isShown:l,onCloseComplete:h,onCancel:h,children:Object(re.jsx)($.a,{className:"meta",children:Object.keys(r).map((function(e){return Object(re.jsxs)($.a,{className:"attribute",children:[Object(re.jsxs)(Ge.a,{className:"key",children:[e,":"]})," ",Object(re.jsx)(Ge.a,{className:"value",children:r[e]})]},e)}))})})}function $n(){var e=Object(l.h)().project_name,t=function(){var e=Object(i.useState)([0,0]),t=Object(J.a)(e,2),n=t[0],a=t[1];return Object(i.useLayoutEffect)((function(){function e(){a([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",e),e(),function(){return window.removeEventListener("resize",e)}}),[]),n}(),n=Object(J.a)(t,2),a=n[0],r=n[1],s=Object(i.useState)(void 0),o=Object(J.a)(s,2),c=o[0],d=o[1],u=Object(i.createRef)();return Object(i.useEffect)((function(){if(null!=u.current){var t=new Dn(e,u.current);return t.init(),d(t),t.renderer.frame(),function(){window.location.reload()}}}),[e]),Object(i.useEffect)((function(){var e;null!=c&&(null===(e=c.controls)||void 0===e||e.resize(a,r))}),[a,r,c]),Object(re.jsxs)($.a,{className:"canvasAnchor",children:[Object(re.jsx)(Jn,{engine:c}),Object(re.jsx)(Xn,{engine:c}),Object(re.jsx)("canvas",{ref:u,onMouseDown:function(e){var t;c&&(null===(t=c.controls)||void 0===t||t.mouseDown(e.clientX,e.clientY,e.timeStamp,e.button))},onMouseUp:function(e){var t;c&&(null===(t=c.controls)||void 0===t||t.mouseUp(e.clientX,e.clientY,e.timeStamp,e.button))},onKeyDown:function(e){var t;!e.repeat&&c&&(null===(t=c.controls)||void 0===t||t.keyDown(e.code))},onKeyUp:function(e){var t;!e.repeat&&c&&(null===(t=c.controls)||void 0===t||t.keyUp(e.code))},tabIndex:0,children:"Your browser does not support HTML5 canvas"}),Object(re.jsx)($.a,{id:"viewStatusBar",children:"Status"})]})}var Zn=n(353),qn=n(140),Qn=n(36),ei={defaultToken:"",number:/\d+(\.\d+)?/,keywords:["@layer","@target","@source","@meta"],typeKeywords:["@default","@color","@visible"],symbols:/[=><!~?:&|+\-*\/\^%]+/,escapes:/\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,digits:/\d+(_+\d+)*/,octaldigits:/[0-7]+(_+[0-7]+)*/,binarydigits:/[0-1]+(_+[0-1]+)*/,hexdigits:/[[0-9a-fA-F]+(_+[0-9a-fA-F]+)*/,regexpctl:/[(){}\[\]\$\^|\-*+?\.]/,regexpesc:/\\(?:[bBdDfnrstvwWn0\\\/]|@regexpctl|c[A-Z]|x[0-9a-fA-F]{2}|u[0-9a-fA-F]{4})/,tokenizer:{root:[[/[{}]/,"delimiter.bracket"],{include:"common"}],common:[[/@[a-z_$][\w$]*/,{cases:{"@typeKeywords":"keyword","@keywords":"type.identifier","@default":"identifier"}}],{include:"@whitespace"},[/\/(?=([^\\\/]|\\.)+\/([gimsuy]*)(\s*)(\.|;|\/|,|\)|\]|\}|$))/,{token:"regexp",bracket:"@open",next:"@regexp"}],[/[()\[\]]/,"@brackets"],[/[<>](?!@symbols)/,"@brackets"],[/@symbols/,{cases:{"@default":""}}],[/(@digits)[eE]([\-+]?(@digits))?/,"number.float"],[/(@digits)\.(@digits)([eE][\-+]?(@digits))?/,"number.float"],[/0[xX](@hexdigits)/,"number.hex"],[/#(@hexdigits)/,"number.hex"],[/0[oO]?(@octaldigits)/,"number.octal"],[/0[bB](@binarydigits)/,"number.binary"],[/(@digits)/,"number"],[/[;,.]/,"delimiter"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/'([^'\\]|\\.)*$/,"string.invalid"],[/"/,"string","@string_double"],[/'/,"string","@string_single"],[/`/,"string","@string_backtick"]],whitespace:[[/[ \t\r\n]+/,""]],regexp:[[/(\{)(\d+(?:,\d*)?)(\})/,["regexp.escape.control","regexp.escape.control","regexp.escape.control"]],[/(\[)(\^?)(?=(?:[^\]\\\/]|\\.)+)/,["regexp.escape.control",{token:"regexp.escape.control",next:"@regexrange"}]],[/(\()(\?:|\?=|\?!)/,["regexp.escape.control","regexp.escape.control"]],[/[()]/,"regexp.escape.control"],[/@regexpctl/,"regexp.escape.control"],[/[^\\\/]/,"regexp"],[/@regexpesc/,"regexp.escape"],[/\\\./,"regexp.invalid"],[/(\/)([gimsuy]*)/,[{token:"regexp",bracket:"@close",next:"@pop"},"keyword.other"]]],regexrange:[[/-/,"regexp.escape.control"],[/\^/,"regexp.invalid"],[/@regexpesc/,"regexp.escape"],[/[^\]]/,"regexp"],[/\]/,{token:"regexp.escape.control",next:"@pop",bracket:"@close"}]],string_double:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,"string","@pop"]],string_single:[[/[^\\']+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/'/,"string","@pop"]],string_backtick:[[/\$\{/,{token:"delimiter.bracket",next:"@bracketCounting"}],[/[^\\`$]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/`/,"string","@pop"]],bracketCounting:[[/\{/,"delimiter.bracket","@bracketCounting"],[/\}/,"delimiter.bracket","@pop"],{include:"common"}]}},ti={brackets:[["{","}"],["[","]"],["(",")"]]};function ni(e){return[{label:"Layer class",kind:Qn.a.CompletionItemKind.Class,insertTextRules:Qn.a.CompletionItemInsertTextRule.InsertAsSnippet,documentation:"Layer style class",insertText:"layer (${1:layer-key}) {\n    ${2:@properties}\n}",range:e},{label:"Target styles",kind:Qn.a.CompletionItemKind.Class,insertTextRules:Qn.a.CompletionItemInsertTextRule.InsertAsSnippet,documentation:"Styles based on metadata of the overlay source layer",insertText:"target {\n    ${1:value}\n}",range:e},{label:"Source styles",kind:Qn.a.CompletionItemKind.Class,insertTextRules:Qn.a.CompletionItemInsertTextRule.InsertAsSnippet,documentation:"Styles based on metadata of the overlay target layer",insertText:"source {\n    ${1:value}\n}",range:e},{label:"Meta class",kind:Qn.a.CompletionItemKind.Class,insertTextRules:Qn.a.CompletionItemInsertTextRule.InsertAsSnippet,documentation:"Styles based on metadata of the layer",insertText:"meta (${1:identifier}) {\n    ${2:value}\n}",range:e},{label:"Color value",kind:Qn.a.CompletionItemKind.Value,insertTextRules:Qn.a.CompletionItemInsertTextRule.InsertAsSnippet,documentation:"Color style class",insertText:"color: #${1:color};",range:e},{label:"Visibility value",kind:Qn.a.CompletionItemKind.Value,insertTextRules:Qn.a.CompletionItemInsertTextRule.InsertAsSnippet,documentation:"Visibility style class",insertText:"visible: ${1:boolean};",range:e},{label:"Default value",kind:Qn.a.CompletionItemKind.Value,insertTextRules:Qn.a.CompletionItemInsertTextRule.InsertAsSnippet,documentation:"Default style class",insertText:"default: ${1:value};",range:e}]}var ii=new RegExp(/^(\s*)/.source+/@[a-zA-Z]+/.source+/(\s*)$/.source,"mg");function ai(){var e=Object(l.h)(),t=e.project_name,n=e.style_name,a=Object(l.g)(),r=Object(i.useState)(void 0),s=Object(J.a)(r,2),o=s[0],c=s[1];Object(i.useEffect)((function(){o&&ne.post(V,{project:t,name:n}).then((function(e){var t=e.data;o.setValue(t.style)})).catch((function(e){console.error(e)}))}),[o,t,n]);var d=Object(i.useState)(!1),u=Object(J.a)(d,2),h=u[0],f=u[1],m=Object(i.useState)(""),v=Object(J.a)(m,2),b=v[0],g=v[1];return Object(re.jsxs)($.a,{children:[Object(re.jsx)(oe,{projects:!0}),Object(re.jsxs)($.a,{className:"stylesHeader",children:[Object(re.jsxs)(Z.a,{className:"wide",children:["Style ",n]}),Object(re.jsxs)(q.a,{marginRight:12,appearance:"minimal",iconBefore:de.a,onClick:function(){a.push(p+t)},children:["Back to Project ",t]}),Object(re.jsx)(Yn.a,{title:"Style Parsed",hasCancel:!1,hasFooter:!1,width:"auto",isShown:h,onCloseComplete:function(){return f(!1)},children:Object(re.jsx)(nt.a,{className:"parsedMessage",children:b})}),Object(re.jsx)(q.a,{marginRight:12,appearance:"minimal",iconBefore:Ze.a,onClick:function(){if(o){var e=o.getValue();ne.post(Y,{project:t,name:n,styles:e}).then((function(e){"error"===e.data.status?(g(e.data.error),f(!0)):(g("Style parsed successfuly"),f(!0))})).catch((function(e){console.error(e)}))}},children:"Parse"}),Object(re.jsx)(we,{submitUrl:G,title:"Save style ".concat(n),label:"Are you sure you want to save style ".concat(n,"? Your previously compiled styles will be overwriten."),confirmLabel:"Overwrite",method:"post",submitBody:function(){if(!o)throw new Error("Error occured while saving the style.");return{project:t,name:n,styles:o.getValue()}},onSubmit:function(){console.log("Style ".concat(n," saved"))},onError:function(e){return"Style could not be saved"},tooltip:"Saves the new configuration and overwrites previously saved styles.",children:Object(re.jsx)(q.a,{marginRight:12,appearance:"minimal",iconBefore:Zn.a,children:"Save"})}),Object(re.jsx)(we,{submitUrl:G,title:"Apply style ".concat(n),label:"Are you sure you want to recompile style ".concat(n,"?  Your previously compiled styles will be overwriten."),confirmLabel:"Compile",method:"post",submitBody:function(){if(!o)throw new Error("Error occured while saving the style.");return{project:t,name:n,styles:o.getValue()}},onSubmit:function(){ne.post(X,{project:t,name:n}).then((function(e){Object(Ke.b)("Compilation job submitted")})).catch((function(e){Object(Ke.b)("Job could not be submitted")}))},onError:function(e){return"Style could not be recompiled"},tooltip:"Recompile styles after updating to view the changes in the visualization",children:Object(re.jsx)(q.a,{appearance:"minimal",iconBefore:fe.a,children:"Save and Compile"})})]}),Object(re.jsx)($.a,{className:"styleView",children:Object(re.jsx)(qn.a,{beforeMount:function(e){e.languages.getLanguages().some((function(e){return"estimatemd"===e.id}))||(e.languages.register({id:"estimatemd"}),e.languages.setMonarchTokensProvider("estimatemd",ei),e.languages.setLanguageConfiguration("estimatemd",ti),e.languages.registerCompletionItemProvider("estimatemd",{provideCompletionItems:function(e,t){if(!e.getValueInRange({startLineNumber:0,startColumn:0,endLineNumber:t.lineNumber,endColumn:t.column}).match(ii))return{suggestions:[]};var n=e.getWordUntilPosition(t);return{suggestions:ni({startLineNumber:t.lineNumber,endLineNumber:t.lineNumber,startColumn:n.startColumn,endColumn:n.endColumn})}}}))},onMount:function(e,t){c(e)},className:"editor",height:"100%",defaultLanguage:"estimatemd"})})]})}function ri(){return Object(re.jsxs)(c.a,{children:[Object(re.jsx)(Ke.a,{position:"top-center",autoClose:5e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0}),Object(re.jsxs)(l.d,{children:[Object(re.jsx)(l.b,{exact:!0,path:["/"],children:Object(re.jsx)(l.a,{to:"/app"})}),Object(re.jsx)(l.b,{path:u,children:Object(re.jsx)(Ee,{})}),Object(re.jsx)(l.b,{path:O,children:Object(re.jsx)(lt,{})}),Object(re.jsx)(l.b,{path:b,children:Object(re.jsx)(Ye,{})}),Object(re.jsx)(l.b,{path:m,children:Object(re.jsx)(Be,{})}),Object(re.jsx)(l.b,{path:j,children:Object(re.jsx)(ai,{})}),Object(re.jsx)(l.b,{path:v,children:Object(re.jsx)(rt,{})}),Object(re.jsx)(l.b,{path:h,children:Object(re.jsx)($n,{})}),Object(re.jsx)(l.b,{path:d,children:Object(re.jsx)(ce,{})})]})]})}s.a.render(Object(re.jsx)(a.a.StrictMode,{children:Object(re.jsx)(o.a.Provider,{value:{className:"react-icons"},children:Object(re.jsx)(ri,{})})}),document.getElementById("root"))}},[[292,1,2]]]);
//# sourceMappingURL=main.b6f74ffe.chunk.js.map