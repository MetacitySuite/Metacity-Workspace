(this["webpackJsonpmetaworkspace-react"]=this["webpackJsonpmetaworkspace-react"]||[]).push([[0],{295:function(e,t,n){},296:function(e,t,n){"use strict";n.r(t);var i=n(2),a=n.n(i),r=n(44),s=n.n(r),o=n(144),c=n(49),l=n(26),d=n(29),h=(n(154),n(30)),u=n(11),f=n(51),m=n(368),p=n(300),v=n(60),g=n(303),b=n(80),j=n.n(b);var y=j.a.create({});!function(){var e=localStorage.getItem("JWT");y.defaults.headers.common.Authorization=null===e?null:"Bearer ".concat(e)}();var x=y,O="/app",_="/app/view/:project_name",w="/app/view/",S="/app/projects/:project_name?",k="/app/projects/",C="/app/upload/:project_name",L="/app/upload/",M="/app/style/:project_name/:style_name",D="/app/style/",N="/app/mapping/:project_name",I="/app/mapping/",E="/app/exports/:export_name",z="/app/exports/",P="/api/projects",T="/api/project",A="/api/project/rename",R="/api/project",F="/api/project/build",U="/api/project/meta",B="/api/layers",V="/api/layer",G="/api/layer/rename",H="/api/layer",W="/api/layer/enable",X="/api/layer/disable",Y="/api/layer/map",$="/api/jobs",K="/api/log",J="/auth/user",q="/auth/token",Z="/api/styles",Q="/api/style",ee="/api/style/create",te="/api/style/update",ne="/api/style",ie="/api/style/rename",ae="/api/style/apply",re="/api/style/parse",se="/api/data/",oe="/api/exports/",ce="/api/exports",le="/api/export/",de="/api/export/obj",he="/api/export/lego",ue=n(0),fe=n(1),me=n(298),pe=n(299),ve=n(362),ge=n(10),be=n(129),je=n(145),ye=n(130),xe=n(4),Oe=n(5),_e=function(e){Object(xe.a)(n,e);var t=Object(Oe.a)(n);function n(e,i){var a;return Object(ue.a)(this,n),e.up=new ge.X(0,0,1),(a=t.call(this,e,i)).screenSpacePanning=!1,a.mouseButtons.LEFT=ge.y.PAN,a.mouseButtons.MIDDLE=ge.y.ROTATE,a.mouseButtons.RIGHT=ge.y.DOLLY,a.touches.ONE=ge.U.PAN,a.touches.TWO=ge.U.DOLLY_ROTATE,a.zoomSpeed=1,a.minDistance=400,a.minPolarAngle=.001,a.maxPolarAngle=.4*Math.PI,a.update(),a}return n}(n(131).a),we=n(7),Se=100;var ke,Ce=function(){function e(t){var n=this;Object(ue.a)(this,e),this.renderer=void 0,this.composer=void 0,this.scene=void 0,this.camera=void 0,this.controls=void 0,this.layers=void 0,this.shader=void 0,this.changed=!1,this.scene=new ge.P,this.camera=new ge.J(75,window.innerWidth/(window.innerHeight-Se),.1,2e3),this.renderer=new ge.Z({canvas:t,antialias:!0}),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=ge.I,this.renderer.setClearColor(15658734,1),this.controls=new _e(this.camera,this.renderer.domElement),this.controls.minDistance=10,this.controls.update();var i=new ge.o(16777215,15658751,.7),a=new ge.i(16777215,.2);a.position.set(1,1,1),this.scene.add(a),this.scene.add(i),this.shader=function(){var e=ge.V.merge([ge.R.phong.uniforms,{vertical_dim:{value:3.2},max_layer:{value:4},top_layer:{value:4}}]);return new ge.S({uniforms:e,vertexShader:"\n#define PHONG\n\nvarying vec3 vViewPosition;\nvarying float topLayer;\nvarying float height_color;\n\nuniform float vertical_dim;\nuniform float max_layer;\nuniform float top_layer;\n\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\n    vec4 mvPosition = vec4( transformed, 1.0 );\n\n    #ifdef USE_INSTANCING\n\n        mvPosition = instanceMatrix * mvPosition;\n        height_color = min(float(int(abs(mvPosition.z + vertical_dim / 3.0) * 10.0) / int(vertical_dim * 10.0)) / top_layer + 0.3, 1.0);\n        topLayer = float(int(abs(mvPosition.z + vertical_dim / 3.0) * 10.0) / int(vertical_dim * 10.0) / int(top_layer));\n\n    #endif\n\n    mvPosition = modelViewMatrix * mvPosition;\n\n    gl_Position = projectionMatrix * mvPosition;\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",fragmentShader:"\n#define PHONG\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n\nvarying float height_color;\nvarying float topLayer;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\n\tvec4 diffuseColor = vec4( diffuse * vec3(height_color, height_color, height_color), opacity );\n    if (topLayer > 0.1) {\n        diffuseColor = vec4(vec3(0.9, 1.0, 1.0), 1.0);\n    }\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",lights:!0,side:ge.j,name:"custom-lego-material"})}(),this.renderer.setSize(window.innerWidth,window.innerHeight-Se),this.composer=new je.a(this.renderer);var r=new ye.a(this.scene,this.camera);this.composer.addPass(r),this.layers=[],this.controls.addEventListener("change",(function(){n.changed=!0}));var s=function(){n.changed&&(n.controls.update(),n.renderer.render(n.scene,n.camera),n.changed=!1)};this.renderer.setAnimationLoop(s),window.addEventListener("resize",(function(){n.camera.aspect=window.innerWidth/(window.innerHeight-Se),n.camera.updateProjectionMatrix(),n.renderer.setSize(window.innerWidth,window.innerHeight-Se)}),!1),s()}return Object(fe.a)(e,[{key:"generateLegoModel",value:function(e,t,n,i,a){var r,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];r=t>3.2?this.round2Darray(e):e;for(var o=this.max2Darray(r),c=0;c<o;c++)this.initLayer(r,c,t,n,i);return s&&this.setCamera(r,o,t),this.showLayer(a),this.shader.uniforms.vertical_dim.value=t,this.shader.uniforms.max_layer.value=o,this.shader.needsUpdate=!0,this.changed=!0,o}},{key:"getInstancedUnitModel",value:function(e,t){var n,i=new be.a;n=t>3.2?i.parse("\n# Blender v2.93.5 OBJ File: ''\n# www.blender.org\no pCylinder6_Mesh\nv 0.057064 0.061065 -0.000001\nv 7.942935 0.061065 -0.000001\nv 0.057064 7.946936 0.000001\nv 7.942935 7.946936 0.000001\nv 6.305408 4.965252 9.599999\nv 6.489283 4.003999 9.599999\nv 6.305408 3.042744 9.599999\nv 4.961254 1.698590 9.599999\nv 3.038745 1.698590 9.599999\nv 2.218222 2.222222 9.599999\nv 1.694591 3.042745 9.599999\nv 1.510716 4.004000 9.599999\nv 1.694591 4.965254 9.599999\nv 3.038746 6.309407 9.599999\nv 4.000000 6.493282 9.599999\nv 4.961255 6.309406 9.599999\nv 5.781777 5.785775 9.599999\nv 5.697057 5.701054 9.677279\nv 4.918441 6.221309 9.677279\nv 3.081560 6.221310 9.677279\nv 1.782689 4.922440 9.677279\nv 1.600000 4.003999 9.677279\nv 1.782688 3.085559 9.677279\nv 2.302943 2.306943 9.677279\nv 3.081559 1.786688 9.677279\nv 4.918439 1.786688 9.677279\nv 6.217310 3.085558 9.677279\nv 6.399999 4.003999 9.677279\nv 6.217310 4.922438 9.677279\nv 7.899988 0.102690 9.599998\nv 7.948085 5.975600 9.599999\nv 7.941407 7.945406 9.600000\nv 4.000000 7.954429 9.600000\nv 0.058592 7.945406 9.600000\nv 0.058592 0.062591 9.599998\nv 6.399999 4.003998 11.116522\nv 6.217310 3.085558 11.116522\nv 4.918439 1.786687 11.116522\nv 3.999999 1.603998 11.116522\nv 3.081559 1.786688 11.116522\nv 2.302943 2.306942 11.116522\nv 1.782688 3.085559 11.116522\nv 1.600000 4.003999 11.116522\nv 1.782689 4.922440 11.116522\nv 3.081560 6.221310 11.116522\nv 4.918441 6.221309 11.116522\nv 5.697057 5.701054 11.116522\nv 5.636730 5.640727 11.200000\nv 4.885792 6.142488 11.200000\nv 3.114209 6.142488 11.200000\nv 1.861510 4.889791 11.200000\nv 1.861509 3.118207 11.200000\nv 2.363270 2.367270 11.200000\nv 3.999999 1.689313 11.200000\nv 4.885791 1.865508 11.200000\nv 6.138489 3.118207 11.200000\nv 6.314684 4.003998 11.200000\nv 0.128480 8.003999 9.475410\nv 7.871519 8.003999 9.475410\nv 0.128480 8.004000 0.075381\nv 7.871519 8.004000 0.075381\nv -0.000001 7.888550 0.075381\nv -0.000001 0.119451 0.075380\nv -0.000001 7.888548 9.475410\nv -0.000001 0.119449 9.475408\nv 0.081614 0.004000 0.075380\nv 7.918385 0.004000 0.075380\nv 0.081614 0.003999 9.475408\nv 7.918385 0.003999 9.475408\nv 8.000000 7.923712 0.075381\nv 8.000000 7.923710 9.475410\nv 8.000000 0.084287 9.475408\nv 8.000000 0.084289 0.075380\ns 1\nf 46 20 45\nf 44 20 21\nf 46 50 49\nf 2 66 1\nf 53 40 54\nf 36 27 28\nf 40 24 25\nf 43 21 22\nf 31 30 72\nf 26 39 25\nf 46 18 19\nf 63 64 62\nf 27 7 6\nf 19 16 15\nf 17 18 5\nf 21 13 12\nf 14 21 20\nf 30 68 69\nf 16 17 32\nf 37 26 27\nf 43 42 52\nf 56 36 57\nf 55 39 38\nf 58 61 60\nf 51 45 44\nf 53 42 41\nf 1 62 3\nf 9 26 25\nf 64 35 34\nf 67 68 66\nf 72 30 69\nf 73 4 70\nf 67 2 73\nf 62 64 60\nf 58 34 33\nf 23 24 41\nf 71 70 59\nf 24 11 10\nf 7 26 8\nf 66 68 63\nf 29 18 47\nf 51 55 57\nf 35 9 10\nf 55 37 56\nf 48 46 49\nf 61 3 60\nf 71 73 70\nf 57 47 48\nf 46 19 20\nf 44 45 20\nf 46 45 50\nf 2 67 66\nf 41 40 53\nf 40 39 54\nf 36 37 27\nf 40 41 24\nf 43 44 21\nf 72 71 31\nf 71 32 31\nf 38 39 26\nf 39 40 25\nf 46 47 18\nf 63 65 64\nf 5 29 6\nf 29 28 6\nf 28 27 6\nf 14 20 15\nf 20 19 15\nf 17 16 18\nf 16 19 18\nf 18 29 5\nf 11 23 12\nf 23 22 12\nf 22 21 12\nf 14 13 21\nf 30 35 68\nf 31 32 17\nf 32 33 16\nf 33 15 16\nf 37 38 26\nf 52 51 43\nf 51 44 43\nf 56 37 36\nf 55 54 39\nf 58 59 61\nf 51 50 45\nf 53 52 42\nf 1 63 62\nf 9 8 26\nf 64 65 35\nf 67 69 68\nf 73 2 4\nf 73 72 69\nf 69 67 73\nf 34 58 64\nf 58 60 64\nf 60 3 62\nf 33 32 59\nf 59 58 33\nf 41 42 23\nf 42 43 23\nf 43 22 23\nf 4 61 70\nf 61 59 70\nf 59 32 71\nf 24 23 11\nf 10 9 24\nf 9 25 24\nf 7 27 26\nf 35 65 68\nf 65 63 68\nf 63 1 66\nf 47 36 29\nf 36 28 29\nf 57 48 49\nf 49 50 51\nf 51 52 53\nf 53 54 55\nf 55 56 57\nf 57 49 51\nf 51 53 55\nf 14 15 33\nf 31 17 5\nf 31 5 6\nf 14 33 34\nf 13 14 34\nf 30 31 6\nf 30 6 7\nf 13 34 12\nf 34 35 12\nf 30 7 8\nf 30 8 9\nf 11 12 35\nf 10 11 35\nf 35 30 9\nf 55 38 37\nf 48 47 46\nf 61 4 3\nf 71 72 73\nf 57 36 47\n"):i.parse("\n# Blender v2.93.5 OBJ File: ''\n# www.blender.org\no pCylinder6_Mesh\nv 0.057064 0.061065 -0.000001\nv 7.942935 0.061065 -0.000001\nv 0.057064 7.946936 0.000001\nv 7.942935 7.946936 0.000001\nv 6.305408 4.965252 3.200000\nv 6.489283 4.003999 3.199999\nv 6.305408 3.042744 3.199999\nv 4.961254 1.698590 3.199999\nv 3.038745 1.698590 3.199999\nv 2.218222 2.222222 3.199999\nv 1.694591 3.042745 3.199999\nv 1.510716 4.004000 3.199999\nv 1.694591 4.965254 3.200000\nv 3.038746 6.309408 3.200000\nv 4.000000 6.493282 3.200000\nv 4.961255 6.309407 3.200000\nv 5.781777 5.785775 3.200000\nv 5.697057 5.701054 3.277279\nv 4.918441 6.221309 3.277279\nv 3.081560 6.221310 3.277279\nv 1.782689 4.922440 3.277279\nv 1.600000 4.003999 3.277278\nv 1.782688 3.085559 3.277278\nv 2.302943 2.306943 3.277278\nv 3.081559 1.786688 3.277278\nv 4.918439 1.786688 3.277278\nv 6.217310 3.085558 3.277278\nv 6.399999 4.003999 3.277278\nv 6.217310 4.922438 3.277279\nv 7.899988 0.102690 3.199999\nv 7.948085 5.975600 3.200000\nv 7.941407 7.945406 3.200000\nv 4.000000 7.954429 3.200000\nv 0.058592 7.945406 3.200000\nv 0.058592 0.062591 3.199999\nv 6.399999 4.003998 4.716522\nv 6.217310 3.085558 4.716522\nv 4.918439 1.786688 4.716521\nv 3.999999 1.603999 4.716521\nv 3.081559 1.786688 4.716521\nv 2.302943 2.306942 4.716521\nv 1.782688 3.085559 4.716522\nv 1.600000 4.003999 4.716522\nv 1.782689 4.922440 4.716522\nv 3.081560 6.221310 4.716522\nv 4.918441 6.221309 4.716522\nv 5.697057 5.701054 4.716522\nv 5.636730 5.640727 4.800000\nv 4.885792 6.142488 4.800000\nv 3.114209 6.142488 4.800000\nv 1.861510 4.889791 4.800000\nv 1.861509 3.118207 4.800000\nv 2.363270 2.367270 4.799999\nv 3.999999 1.689314 4.799999\nv 4.885791 1.865509 4.799999\nv 6.138489 3.118207 4.800000\nv 6.314684 4.003998 4.800000\nv 0.128480 8.003999 3.075409\nv 7.871519 8.003999 3.075409\nv 0.128480 8.004000 0.075381\nv 7.871519 8.004000 0.075381\nv -0.000001 7.888550 0.075381\nv -0.000001 0.119451 0.075380\nv -0.000001 7.888548 3.075409\nv -0.000001 0.119449 3.075408\nv 0.081614 0.004000 0.075380\nv 7.918385 0.004000 0.075380\nv 0.081614 0.003999 3.075408\nv 7.918385 0.003999 3.075408\nv 8.000000 7.923712 0.075381\nv 8.000000 7.923710 3.075409\nv 8.000000 0.084287 3.075408\nv 8.000000 0.084289 0.075380\ns 1\nf 46 20 45\nf 44 20 21\nf 46 50 49\nf 2 66 1\nf 53 40 54\nf 36 27 28\nf 40 24 25\nf 43 21 22\nf 31 30 72\nf 26 39 25\nf 46 18 19\nf 63 64 62\nf 27 7 6\nf 19 16 15\nf 17 18 5\nf 21 13 12\nf 14 21 20\nf 30 68 69\nf 16 17 32\nf 37 26 27\nf 43 42 52\nf 56 36 57\nf 55 39 38\nf 58 61 60\nf 51 45 44\nf 53 42 41\nf 1 62 3\nf 9 26 25\nf 64 35 34\nf 67 68 66\nf 72 30 69\nf 73 4 70\nf 67 2 73\nf 62 64 60\nf 58 34 33\nf 23 24 41\nf 71 70 59\nf 24 11 10\nf 7 26 8\nf 66 68 63\nf 29 18 47\nf 51 55 57\nf 35 9 10\nf 55 37 56\nf 48 46 49\nf 61 3 60\nf 71 73 70\nf 57 47 48\nf 46 19 20\nf 44 45 20\nf 46 45 50\nf 2 67 66\nf 41 40 53\nf 40 39 54\nf 36 37 27\nf 40 41 24\nf 43 44 21\nf 72 71 31\nf 71 32 31\nf 38 39 26\nf 39 40 25\nf 46 47 18\nf 63 65 64\nf 5 29 6\nf 29 28 6\nf 28 27 6\nf 14 20 15\nf 20 19 15\nf 17 16 18\nf 16 19 18\nf 18 29 5\nf 11 23 12\nf 23 22 12\nf 22 21 12\nf 14 13 21\nf 30 35 68\nf 31 32 17\nf 32 33 16\nf 33 15 16\nf 37 38 26\nf 52 51 43\nf 51 44 43\nf 56 37 36\nf 55 54 39\nf 58 59 61\nf 51 50 45\nf 53 52 42\nf 1 63 62\nf 9 8 26\nf 64 65 35\nf 67 69 68\nf 73 2 4\nf 73 72 69\nf 69 67 73\nf 34 58 64\nf 58 60 64\nf 60 3 62\nf 33 32 59\nf 59 58 33\nf 41 42 23\nf 42 43 23\nf 43 22 23\nf 4 61 70\nf 61 59 70\nf 59 32 71\nf 24 23 11\nf 10 9 24\nf 9 25 24\nf 7 27 26\nf 35 65 68\nf 65 63 68\nf 63 1 66\nf 47 36 29\nf 36 28 29\nf 57 48 49\nf 49 50 51\nf 51 52 53\nf 53 54 55\nf 55 56 57\nf 57 49 51\nf 51 53 55\nf 14 15 33\nf 31 17 5\nf 31 5 6\nf 14 33 34\nf 13 14 34\nf 30 31 6\nf 30 6 7\nf 13 34 12\nf 34 35 12\nf 30 7 8\nf 30 8 9\nf 11 12 35\nf 10 11 35\nf 35 30 9\nf 55 38 37\nf 48 47 46\nf 61 4 3\nf 71 72 73\nf 57 36 47\n");var a=this.shader,r=n.children[0].geometry.clone();return n.remove(),new ge.s(r,a,e)}},{key:"max2Darray",value:function(e){return e.reduce((function(e,t){return Math.max(e,t.reduce((function(e,t){return Math.max(e,t)}),0))}),0)}},{key:"round2Darray",value:function(e){return e.map((function(e){return e.map((function(e){return Math.round(e/3)}))}))}},{key:"generatePositionsForLayer",value:function(e,t,n,i,a){for(var r,s,o=[],c=0;c<e.length;c++)for(var l=0;l<e[c].length;l++)e[c][l]>=t&&(r=Math.floor(c/i)*a*8,s=Math.floor(l/i)*a*8,o.push(new ge.X(8*l+s,8*-c-r,t*n)));return o}},{key:"setCamera",value:function(e,t,n){this.camera.position.z=t*n+100,this.camera.position.y=8*-e.length/2,this.camera.position.x=8*e[0].length/2,this.controls.target.set(8*e[0].length/2,8*-e.length/2,0)}},{key:"initLayer",value:function(e,t,n,i,a){var r=this.generatePositionsForLayer(e,t,n,i,a),s=this.getInstancedUnitModel(r.length,n);this.layers.push(s);for(var o=new ge.F,c=0;c<r.length;c++)o.position.copy(r[c]),o.updateMatrix(),s.setMatrixAt(c,o.matrix);s.instanceMatrix.needsUpdate=!0,s.castShadow=!0,s.receiveShadow=!0,this.scene.add(s)}},{key:"showLayer",value:function(e){for(var t=0;t<this.layers.length;t++)this.layers[t].visible=!(t>=e);this.shader.uniforms.top_layer.value=e,this.shader.needsUpdate=!0,this.changed=!0}},{key:"remove",value:function(){for(var e=0;e<this.layers.length;e++)this.scene.remove(this.layers[e]);this.layers=[],this.changed=!0}}]),e}();function Le(e,t,n){x.get("".concat(oe).concat(e,"/lego").concat(t,".json")).then((function(e){n(e.data)}))}function Me(e){var t=e.start,n=e.end,a=e.project,r=e.exportID,s=e.unit_precision,o=e.box_filter_size_range,c=e.box_filter_step,h=Object(i.useRef)(null),m=Array.from(Array(Math.floor((o[1]-o[0])/c)),(function(e,t){return o[0]+t*c})),p=Object(i.useState)(m[m.length-1]),g=Object(u.a)(p,2),b=g[0],j=g[1],y=[3.2,9.6],O=Object(i.useState)(y[0]),_=Object(u.a)(O,2),w=_[0],S=_[1],k=Object(i.useState)(0),C=Object(u.a)(k,2),L=C[0],M=C[1],D=Object(i.useState)(8),N=Object(u.a)(D,2),I=N[0],E=N[1],z=Object(i.useState)(0),P=Object(u.a)(z,2),T=P[0],A=P[1],R=Object(i.useState)(0),F=Object(u.a)(R,2),U=F[0],B=F[1],V=Object(i.useState)(),G=Object(u.a)(V,2),H=G[0],W=G[1],X=Object(l.g)(),Y=Object(i.useState)(),$=Object(u.a)(Y,2),K=$[0],J=$[1],q=Object(i.useState)(),Z=Object(u.a)(q,2),Q=Z[0],ee=Z[1];Object(i.useEffect)((function(){if(h.current){var e=new Ce(h.current);W(e),Le(r,b,(function(t){if(e){e.remove();var n=e.generateLegoModel(t.map,w,I,L,U,!0);A(n),B(n+1),J(t.lego_size),ee(t.model_size_mm)}}))}}),[h]),Object(i.useEffect)((function(){Le(r,b,(function(e){if(H){H.remove();var t=H.generateLegoModel(e.map,w,I,L,U);A(t),B(t+1),J(e.lego_size),ee(e.model_size_mm)}}))}),[w,I,L]),Object(i.useEffect)((function(){Le(r,b,(function(e){if(H){H.remove();var t=H.generateLegoModel(e.map,w,I,L,U);A(t),B(t+1),H.showLayer(U),J(e.lego_size),ee(e.model_size_mm)}}))}),[b]),Object(i.useEffect)((function(){H&&H.showLayer(U)}),[U]);var te=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return e.toFixed(t)};return Object(we.jsxs)(f.a,{className:"lego-page",children:[Object(we.jsxs)(f.a,{className:"export-description page",children:[Object(we.jsxs)(me.a,{marginBottom:16,children:["Lego Model ",r]}),Object(we.jsx)(pe.a,{marginBottom:16,children:"Your Lego export is ready."}),Object(we.jsx)(v.a,{appearance:"primary",intent:"danger",onClick:function(){x.delete("".concat(le).concat(r)).then((function(e){d.b.success("Export deleted"),X.push("/")})).catch((function(e){d.b.error("Error deleting export")}))},marginTop:20,marginBottom:40,children:"Delete"}),Object(we.jsx)(pe.a,{marginBottom:16,size:300,children:"You can also share this export with others, this page is publicly available. Once you don't need it anymore, please consider deleting it from the server and helping us to save disk space. The export might also get deleted after a while automatically."}),Object(we.jsxs)(f.a,{className:"field",children:[Object(we.jsx)(me.a,{size:100,children:"Project"}),Object(we.jsx)(f.a,{className:"values",children:a})]}),Object(we.jsxs)(f.a,{className:"field",children:[Object(we.jsx)(me.a,{size:100,children:"Start coordinate"}),Object(we.jsxs)(f.a,{className:"values",children:[te(t[0])," ",te(t[1])]})]}),Object(we.jsxs)(f.a,{className:"field",children:[Object(we.jsx)(me.a,{size:100,children:"End coordinate"}),Object(we.jsxs)(f.a,{className:"values",children:[te(n[0])," ",te(n[1])]})]}),Object(we.jsx)(me.a,{marginBottom:32,marginTop:32,children:"Current setup"}),Object(we.jsxs)(f.a,{className:"field",children:[Object(we.jsx)(me.a,{size:100,children:"General"}),Object(we.jsxs)(f.a,{className:"values",children:["1 Lego block is ",b/s," units (coordinate units)"]})]}),Object(we.jsxs)(f.a,{className:"field",children:[Object(we.jsx)(me.a,{size:100,children:"Model dimensions"}),Object(we.jsx)(f.a,{className:"values",children:Q?"".concat(te(Q.x)," x ").concat(te(Q.y)," x ").concat(te(T*w)," mm"):"loading..."})]}),Object(we.jsxs)(f.a,{className:"field",children:[Object(we.jsx)(me.a,{size:100,children:"Lego resolution"}),Object(we.jsx)(f.a,{className:"values",children:K?"".concat(te(K.x,0)," x ").concat(te(K.y,0)," x ").concat(te(T,0)," bricks"):"loading..."})]})]}),Object(we.jsxs)(f.a,{className:"lego-controls",children:[Object(we.jsx)(ve.a,{title:"Lego brick resolution",options:m.map((function(e){return{label:"1 brick is ".concat(e/s," units"),value:e}})),selected:"1 brick is ".concat(b/s," units"),hasFilter:!1,onSelect:function(e){return j(e.value)},children:Object(we.jsx)(v.a,{appearance:"minimal",children:"Horizontal step: 1 brick is ".concat(b/s," units")})}),Object(we.jsx)(ve.a,{title:"Vertical resolution",options:y.map((function(e){return{label:"".concat(e," mm bricks"),value:e}})),selected:"".concat(w," mm bricks"),hasFilter:!1,onSelect:function(e){return S(e.value)},children:Object(we.jsx)(v.a,{appearance:"minimal",children:"Vertical step: ".concat(w," mm bricks")})}),Object(we.jsx)(ve.a,{title:"Tile spacing",options:[0,1,2,4,8,16,32].map((function(e){return{label:"".concat(e," bricks"),value:e}})),selected:"".concat(L," bricks"),hasFilter:!1,onSelect:function(e){return M(e.value)},children:Object(we.jsx)(v.a,{appearance:"minimal",children:"Tile spacing: ".concat(L," bricks")})}),Object(we.jsx)(ve.a,{title:"Tile size",options:[4,8,16,32].map((function(e){return{label:"".concat(e," bricks"),value:e}})),selected:"".concat(I," bricks"),hasFilter:!1,onSelect:function(e){return E(e.value)},children:Object(we.jsx)(v.a,{appearance:"minimal",disabled:0===L,children:"Tile size: ".concat(I," bricks")})}),Object(we.jsx)(ve.a,{title:"Show Layer",options:[{label:"All",value:T+1}].concat(Array.from(Array(T),(function(e,t){return{label:"".concat(t+1),value:t+1}}))),selected:"".concat(U),hasFilter:!1,onSelect:function(e){return B(e.value)},children:Object(we.jsx)(v.a,{appearance:"minimal",children:"Show layer: ".concat(U)})})]}),Object(we.jsx)("canvas",{ref:h})]})}function De(e){var t=e.start,n=e.end,a=e.project,r=e.exportID,s=Object(i.useState)(!1),o=Object(u.a)(s,2),c=o[0],h=o[1],m=Object(i.useState)("0 Bytes"),p=Object(u.a)(m,2),g=p[0],b=p[1],j=Object(l.g)(),y=function(e){return e.toFixed(2)};return Object(we.jsx)(f.a,{className:"fullScreen",children:Object(we.jsxs)(f.a,{className:"export-description",children:[Object(we.jsxs)(me.a,{marginBottom:16,children:["Export ",r]}),Object(we.jsx)(pe.a,{marginBottom:16,children:"Your OBJ export is ready, please download it."}),Object(we.jsx)(pe.a,{marginBottom:16,size:300,children:"You can also share this download with others, this page is publicly available. Once you've downloaded it, please consider deleting it from the server and helping us to save disk space. The export might also get deleted after a while automatically."}),Object(we.jsxs)(f.a,{className:"field",children:[Object(we.jsx)(me.a,{size:100,children:"Project"}),Object(we.jsx)(f.a,{className:"values",children:a})]}),Object(we.jsxs)(f.a,{className:"field",children:[Object(we.jsx)(me.a,{size:100,children:"Start coordinate"}),Object(we.jsxs)(f.a,{className:"values",children:[y(t[0])," ",y(t[1])]})]}),Object(we.jsxs)(f.a,{className:"field",children:[Object(we.jsx)(me.a,{size:100,children:"End coordinate"}),Object(we.jsxs)(f.a,{className:"values",children:[y(n[0])," ",y(n[1])]})]}),Object(we.jsx)(v.a,{appearance:"primary",intent:"success",onClick:function(){h(!0),x.get("".concat(oe).concat(r,"/export.obj"),{onDownloadProgress:function(e){b(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(0===e)return"0 Bytes";var n=1024,i=t<0?0:t,a=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],r=Math.floor(Math.log(e)/Math.log(n));return parseFloat((e/Math.pow(n,r)).toFixed(i))+" "+a[r]}(e.loaded))}}).then((function(e){var t=new Blob([e.data],{type:"application/octet-stream"}),n=window.URL.createObjectURL(t),i=document.createElement("a");i.href=n,i.setAttribute("download","".concat(r,".obj")),document.body.appendChild(i),i.click()}))},marginTop:20,marginRight:10,children:c?"Downloading ".concat(g):"Download"}),Object(we.jsx)(v.a,{appearance:"primary",intent:"danger",onClick:function(){x.delete("".concat(le).concat(r)).then((function(e){d.b.success("Export deleted"),j.push("/")})).catch((function(e){d.b.error("Error deleting export")}))},marginTop:20,children:"Delete"})]})})}function Ne(){var e=Object(l.h)().export_name,t=Object(i.useState)(void 0),n=Object(u.a)(t,2),a=n[0],r=n[1],s=Object(i.useState)(ke.PROCESSING),o=Object(u.a)(s,2),c=o[0],b=o[1],j=Object(i.useCallback)((function(){x.get("".concat(le).concat(e)).then((function(e){204===e.status?(b(ke.PROCESSING),d.b.info("Not yet, processing...",{autoClose:3e3})):200===e.status&&(r(e.data),b(ke.SUCCESS))})).catch((function(e){404===e.response.status&&b(ke.NOTFOUND)}))}),[e]);return Object(i.useEffect)((function(){j()}),[j]),Object(we.jsxs)(we.Fragment,{children:[c===ke.PROCESSING&&Object(we.jsx)(f.a,{className:"fullScreen",children:Object(we.jsx)(f.a,{className:"export-wait",children:Object(we.jsx)(m.a,{background:"light",title:"Export ".concat(e," is still processing"),orientation:"horizontal",icon:Object(we.jsx)(p.a,{}),iconBgColor:"#EDEFF5",description:"Refresh the site once in a while, outputs will appear on this page when they are succesfully processed",anchorCta:Object(we.jsx)(m.a.LinkButton,{is:v.a,onClick:j,children:"Click me to refresh!"})})})}),c===ke.NOTFOUND&&Object(we.jsx)(f.a,{className:"fullScreen",children:Object(we.jsx)(f.a,{className:"export-wait",children:Object(we.jsx)(m.a,{background:"light",title:"Export ".concat(e," was not found"),orientation:"vertical",icon:Object(we.jsx)(g.a,{color:"#C1C4D6"}),iconBgColor:"#EDEFF5",description:"Outputs have been deleted or are no longer available"})})}),c===ke.SUCCESS&&("obj"===a.type&&Object(we.jsx)(De,Object(h.a)(Object(h.a)({},a),{},{exportID:e}))||"lego"===a.type&&Object(we.jsx)(Me,Object(h.a)(Object(h.a)({},a),{},{exportID:e})))]})}!function(e){e[e.PROCESSING=0]="PROCESSING",e[e.SUCCESS=1]="SUCCESS",e[e.NOTFOUND=2]="NOTFOUND"}(ke||(ke={}));var Ie=n(325),Ee=n(329),ze=n(330),Pe=n(369),Te=n(361),Ae=n(326),Re=n(327),Fe=n(328);function Ue(){var e=Object(i.useState)([]),t=Object(u.a)(e,2),n=t[0],a=t[1],r=Object(i.useState)(!1),s=Object(u.a)(r,2),o=s[0],c=s[1],l=Object(i.useState)(),d=Object(u.a)(l,2),h=d[0],p=d[1],g=Object(i.useState)(void 0),b=Object(u.a)(g,2),j=b[0],y=b[1],O=Object(i.useState)(""),_=Object(u.a)(O,2),w=_[0],S=_[1];return Object(i.useEffect)((function(){var e;return j&&clearTimeout(j),y(setTimeout((function t(){h&&0!==h.length?x.post(K,{name:h}).then((function(n){S(n.data),e=setTimeout(t,2e3)})):S("")}),1e3)),function(){S(""),clearTimeout(e)}}),[h]),Object(i.useEffect)((function(){var e;return function t(){x.get($).then((function(n){a(n.data),e=setTimeout(t,2e3)}))}(),function(){clearTimeout(e),a([])}}),[]),Object(we.jsxs)(we.Fragment,{children:[Object(we.jsx)(Pe.a,{isShown:o,onCloseComplete:function(){return c(!1)},preventBodyScrolling:!0,children:Object(we.jsxs)(f.a,{children:[Object(we.jsx)(me.a,{margin:15,children:"Running Jobs"}),Object(we.jsx)(pe.a,{margin:15,children:"These are the jobs that are currently running or have been queued."}),Object(we.jsxs)(Te.a,{margin:15,children:[Object(we.jsxs)(Te.a.Head,{className:"row",children:[Object(we.jsx)(Te.a.TextHeaderCell,{className:"wide",children:"Job Type"}),Object(we.jsx)(Te.a.TextHeaderCell,{className:"wide",children:"Status"}),Object(we.jsx)(Te.a.TextHeaderCell,{className:"wide",children:"Project"}),Object(we.jsx)(Te.a.TextHeaderCell,{className:"narrow",children:"Log"})]}),Object(we.jsx)(Te.a.Body,{children:n.length>0?n.map((function(e){return Object(we.jsxs)(Te.a.Row,{paddingY:12,height:"auto",className:"row",children:[Object(we.jsx)(Te.a.TextCell,{className:"wide",children:e.type}),Object(we.jsx)(Te.a.TextCell,{className:"wide",children:e.status}),Object(we.jsx)(Te.a.TextCell,{className:"wide",children:e.project?e.project:"--"}),Object(we.jsx)(Te.a.TextCell,{className:"narrow",children:Object(we.jsx)(v.a,{onClick:function(){return p("worker0")},children:"Log"})})]},e.job_id)})):Object(we.jsx)(m.a,{background:"light",title:"No Running Jobs",orientation:"horizontal",icon:Object(we.jsx)(Ae.a,{color:"#C1C4D6"}),iconBgColor:"#EDEFF5",description:"Jobs run in the background and process input data into visualizable elements"})})]}),Object(we.jsx)(Re.a,{placeholder:"Type worker0 to see processing logs",width:"calc(100% - 30px)",margin:15,onChange:function(e){return p(e.target.value)},value:h}),Object(we.jsx)(f.a,{className:"logContents",children:w&&w.length>0?Object(we.jsx)(Fe.a,{className:"logLines",children:w.split(/[\r\n]+/).map((function(e,t){return Object(we.jsx)("span",{children:e},t)}))}):Object(we.jsx)(Fe.a,{children:"No contents or no log selected"})})]})}),Object(we.jsx)(v.a,{iconBefore:Ae.a,appearance:"minimal",onClick:function(){return c(!0)},children:"Running Tasks"})]})}var Be=function(e){return Object(we.jsx)(Ie.a,Object(h.a)({is:c.b},e))};function Ve(e){return Object(we.jsxs)(f.a,{className:"header",children:[Object(we.jsx)(v.a,{is:Be,to:O,appearance:"minimal",children:"Metacity"}),Object(we.jsx)(f.a,{flexGrow:1}),Object(we.jsx)(v.a,{is:Ie.a,href:"https://github.com/MetacitySuite",iconBefore:Ee.a,appearance:"minimal",children:"Github"}),Object(we.jsx)(Ue,{})]})}function Ge(){var e=Object(i.useState)([]),t=Object(u.a)(e,2),n=t[0],a=t[1],r=Object(i.useState)([]),s=Object(u.a)(r,2),o=s[0],c=s[1];return Object(i.useEffect)((function(){return x.get(P).then((function(e){a(e.data)})),x.get(ce).then((function(e){c(e.data)})),function(){a([]),c([])}}),[]),Object(we.jsx)(we.Fragment,{children:Object(we.jsxs)(f.a,{className:"home page",children:[Object(we.jsx)(me.a,{size:900,marginBottom:64,children:"Metacity"}),Object(we.jsx)(pe.a,{marginBottom:64,children:"Metacity is a set of tools for urban data synthesis, analysis & visualization. Our goal is to create a new generation of open-source tools and services targeted at developers, urban planners and the general public. We believe that urban data visualization should make the city look like a city, not a giant spreadsheet."}),Object(we.jsxs)(f.a,{position:"absolute",top:10,right:10,children:[Object(we.jsx)(v.a,{is:Ie.a,href:"https://github.com/MetacitySuite",iconBefore:Ee.a,appearance:"minimal",children:"Github"}),Object(we.jsx)(v.a,{is:Be,to:k,iconBefore:ze.a,appearance:"minimal",children:"Login"})]}),Object(we.jsxs)(f.a,{className:"homeLists",marginBottom:64,children:[Object(we.jsxs)(f.a,{className:"homeList",children:[Object(we.jsx)(me.a,{size:300,className:"homeListHeading",children:"Projects"}),n.map((function(e,t){return Object(we.jsx)(Be,{to:w+e,size:500,children:e},"project-".concat(t))})),0===n.length&&Object(we.jsx)(f.a,{children:Object(we.jsx)(me.a,{size:500,children:"No projects found"})})]}),Object(we.jsxs)(f.a,{className:"homeList",children:[Object(we.jsx)(me.a,{size:300,className:"homeListHeading",children:"Exports"}),o.map((function(e,t){return Object(we.jsx)(Be,{to:z+e,children:e},"export-".concat(t))})),0===o.length&&Object(we.jsx)(f.a,{children:Object(we.jsx)(me.a,{size:300,children:"No exports"})})]})]}),Object(we.jsx)(me.a,{size:300,children:"Partners"}),Object(we.jsxs)(f.a,{className:"logos",children:[Object(we.jsx)(Ie.a,{href:"http://praha.camp/",children:Object(we.jsx)("img",{className:"logo",src:"../../assets/logos/camp.png",alt:"CAMP"})}),Object(we.jsx)(Ie.a,{href:"https://iprpraha.cz/",children:Object(we.jsx)("img",{className:"logo",src:"../../assets/logos/ipr.png",alt:"IPR"})}),Object(we.jsx)(Ie.a,{href:"https://fel.cvut.cz/en/",children:Object(we.jsx)("img",{className:"logo",src:"../../assets/logos/electrical_engeneering.svg",alt:"FEL CTU"})}),Object(we.jsx)(Ie.a,{href:"https://dcgi.fel.cvut.cz/",children:Object(we.jsx)("img",{className:"logo",src:"../../assets/logos/dcgi.png",alt:"DCGI"})}),Object(we.jsx)(Ie.a,{href:"https://fit.cvut.cz/cs",children:Object(we.jsx)("img",{className:"logo",src:"../../assets/logos/information_technology.svg",alt:"FIT CTU"})}),Object(we.jsx)(Ie.a,{href:"https://www.cesnet.cz/",children:Object(we.jsx)("img",{className:"logo",src:"../../assets/logos/cesnet.svg",alt:"Cesnet"})}),Object(we.jsx)(Ie.a,{href:"https://www.oncue.design/",children:Object(we.jsx)("img",{className:"logo",src:"../../assets/logos/ocd_logo_2.png",alt:"Ira Winder"})})]})]})})}var He,We=n(72);function Xe(e){var t=e.onLogin,n=Object(i.useState)(""),a=Object(u.a)(n,2),r=a[0],s=a[1],o=Object(i.createRef)(),c=Object(i.createRef)();return Object(we.jsx)(f.a,{className:"fullScreen",children:Object(we.jsxs)(f.a,{children:[Object(we.jsx)(me.a,{is:"h1",children:"Login"}),r.length>0?Object(we.jsx)("p",{children:r}):"",Object(we.jsxs)("form",{onSubmit:function(e){var n,i;e.preventDefault();var a=new FormData;a.append("username",(null===(n=o.current)||void 0===n?void 0:n.value)||""),a.append("password",(null===(i=c.current)||void 0===i?void 0:i.value)||""),x.post(q,a,{headers:{"Content-Type":"multipart/form-data"}}).then((function(e){localStorage.setItem("JWT",e.data.access_token),x.defaults.headers.common.Authorization="Bearer ".concat(e.data.access_token),t()})).catch((function(e){console.error(e),s("There was a problem with your login, check your username and password.")}))},children:[Object(we.jsx)(We.a,{width:"100%",placeholder:"username",ref:o,type:"text"}),Object(we.jsx)(We.a,{width:"100%",placeholder:"password",ref:c,type:"password"}),Object(we.jsx)(We.a,{type:"submit"})]})]})})}function Ye(e){var t=e.children,n=Object(i.useState)(He.AUTHENTICATING),a=Object(u.a)(n,2),r=a[0],s=a[1],o=Object(l.g)();return Object(i.useEffect)((function(){var e,t;e=function(){s(He.LOGGED_IN)},t=function(){s(He.LOGGED_OUT)},x.get(J).then((function(t){e()})).catch((function(){t()}))}),[o]),Object(we.jsxs)(we.Fragment,{children:[r===He.LOGGED_IN&&t,r===He.LOGGED_OUT&&Object(we.jsx)(Xe,{onLogin:function(){return s(He.LOGGED_IN)}}),r===He.AUTHENTICATING&&Object(we.jsx)(f.a,{className:"fullScreen",children:Object(we.jsx)(p.a,{})})]})}!function(e){e[e.LOGGED_IN=0]="LOGGED_IN",e[e.LOGGED_OUT=1]="LOGGED_OUT",e[e.AUTHENTICATING=2]="AUTHENTICATING"}(He||(He={}));var $e=n(63),Ke=n(331),Je=n(332),qe=n(366),Ze=n(333);function Qe(){var e=Object(l.h)().project_name,t=Object(i.useState)([]),n=Object(u.a)(t,2),a=n[0],r=n[1],s=Object(i.useState)(void 0),o=Object(u.a)(s,2),c=o[0],h=o[1],m=Object(i.useState)(void 0),p=Object(u.a)(m,2),g=p[0],b=p[1],j=Object(i.createRef)(),y=Object(l.g)();Object(i.useEffect)((function(){return x.post(B,{name:e}).then((function(e){r(e.data.filter((function(e){return"layer"===e.type})))})),function(){r([])}}),[e,y]);return Object(we.jsxs)(f.a,{children:[Object(we.jsx)(Ve,{projects:!0}),Object(we.jsxs)(f.a,{className:"mapping",children:[Object(we.jsx)($e.a,{icon:Ke.a,size:30,color:"#C1C4D6",background:"#EDEFF5",className:"uploadIcon",padding:20,borderRadius:40}),Object(we.jsxs)(me.a,{className:"mappingTitle",children:["Layer mapping in Project ",e]}),Object(we.jsxs)(f.a,{className:"mappingDialog",children:[Object(we.jsxs)("form",{onSubmit:function(t){t.preventDefault();var n=j.current.value;void 0!==n&&0!==n.length?void 0!==c&&void 0!==g?c!==g?x.post(Y,{project:e,source:c,target:g,overlay:n}).then((function(){d.b.success("Mapping layers successfully.")})).catch((function(){d.b.error("Mapping layers failed.")})):d.b.error("Source and target layer cannot be same."):d.b.error("Please select source and target layer."):d.b.error("No name specified.")},id:"layerMappingForm",children:[Object(we.jsx)(We.a,{placeholder:"overlay name",ref:j,className:"layerName"}),Object(we.jsxs)(pe.a,{className:"mappingDescription",children:["Geometry of source layer is mapped onto geometry of target layer. The output of this operation is a new layer with type ",Object(we.jsx)(Je.a,{size:300,children:"overlay"}),". The ",Object(we.jsx)(Je.a,{size:300,children:"source"})," layer can contain any geometry, the ",Object(we.jsx)(Je.a,{size:300,children:"target"})," layer must contain any ",Object(we.jsx)(Je.a,{size:300,children:"polygons"}),"."]}),Object(we.jsxs)(f.a,{className:"mappingLayerPicker",children:[Object(we.jsx)(ve.a,{title:"Select source layer",options:a.map((function(e){return{label:e.name,value:e.name}})),selected:c,onSelect:function(e){return h(e.value)},children:Object(we.jsx)(qe.a,{content:"Can contain 2D or 3D points, lines or polygons",children:Object(we.jsx)(v.a,{type:"button",children:c||"select source layer"})})}),Object(we.jsx)(f.a,{className:"dialogPart",children:Object(we.jsx)($e.a,{icon:Ze.a,color:"#C1C4D6"})}),Object(we.jsx)(ve.a,{title:"Select target layer",options:a.map((function(e){return{label:e.name,value:e.name}})),selected:g,onSelect:function(e){return b(e.value)},children:Object(we.jsx)(qe.a,{content:"Must contain 2D or 3D polygons",children:Object(we.jsx)(v.a,{type:"button",children:g||"select target layer"})})})]})]}),Object(we.jsx)(v.a,{appearance:"primary",type:"submit",form:"layerMappingForm",children:"Apply Mapping"})]})]})]})}var et=n(347),tt=n(336),nt=n(337),it=n(338),at=n(339),rt=n(340),st=n(341),ot=n(334),ct=n(363),lt=n(335);function dt(e){var t=Object(i.createRef)(),n=Object(i.useState)(!1),a=Object(u.a)(n,2),r=a[0],s=a[1],o=Object(i.useState)(!1),c=Object(u.a)(o,2),l=c[0],d=c[1],h=Object(i.useState)(""),f=Object(u.a)(h,2),m=f[0],p=f[1],v=function(n){var i;n&&n.preventDefault();var a=null===(i=t.current)||void 0===i?void 0:i.value;if(a){var r=e.submitBody(a);x[e.method](e.submitUrl,r).then((function(){t.current&&(t.current.value=""),s(!1),e.onSubmit(a)})).catch((function(t){var n=e.onError(t,a);d(!0),p(n)}))}};return Object(i.useEffect)((function(){p(""),d(!1)}),[r]),Object(we.jsxs)(we.Fragment,{children:[Object(we.jsx)(ot.a,{isShown:r,title:e.title,onConfirm:function(){return v()},onCloseComplete:function(){return s(!1)},confirmLabel:e.confirmLabel,children:Object(we.jsx)("form",{className:"dialogForm",onSubmit:v,children:l?Object(we.jsx)(ct.a,{name:"name",label:e.label,description:e.description,placeholder:e.placeholder,ref:t,isInvalid:l,validationMessage:m}):Object(we.jsx)(ct.a,{name:"name",label:e.label,description:e.description,placeholder:e.placeholder,ref:t})})}),Object(i.cloneElement)(e.children,{onClick:function(){return s(!0)}})]})}function ht(e){var t=Object(i.useState)(!1),n=Object(u.a)(t,2),a=n[0],r=n[1],s=Object(i.useState)(!1),o=Object(u.a)(s,2),c=o[0],l=o[1],d=Object(i.useState)(""),h=Object(u.a)(d,2),f=h[0],m=h[1];return Object(i.useEffect)((function(){m(""),l(!1)}),[a]),Object(we.jsxs)(we.Fragment,{children:[Object(we.jsxs)(ot.a,{isShown:a,intent:e.intent?e.intent:"none",title:e.title,onConfirm:function(){try{var t=e.submitBody();x[e.method](e.submitUrl,t).then((function(){r(!1),e.onSubmit()})).catch((function(t){var n=e.onError(t);l(!0),m(n)}))}catch(f){l(!0),m(f)}},onCloseComplete:function(){return r(!1)},confirmLabel:e.confirmLabel,children:[Object(we.jsx)(pe.a,{children:e.label}),c?Object(we.jsx)(lt.a,{intent:"danger",marginTop:16,children:f}):""]}),e.tooltip?Object(we.jsx)(qe.a,{content:e.tooltip,children:Object(i.cloneElement)(e.children,{onClick:function(){r(!0)}})}):Object(i.cloneElement)(e.children,{onClick:function(){r(!0)}})]})}function ut(e){var t=Object(l.g)();return Object(we.jsxs)(f.a,{className:"actions",children:[Object(we.jsx)(v.a,{marginRight:12,marginBottom:12,appearance:"minimal",iconBefore:tt.a,onClick:function(){return t.push(L+e.name)},children:"Add Layer"}),Object(we.jsx)(dt,{submitUrl:ee,title:"Add Style",label:"Choose the name of the new style",confirmLabel:"Create",method:"post",submitBody:function(t){return{project:e.name,name:t}},onSubmit:function(n){t.push(D+e.name+"/"+n)},onError:function(e,t){return"Style already exists"},children:Object(we.jsx)(v.a,{marginRight:12,marginBottom:12,appearance:"minimal",iconBefore:nt.a,children:"Add Style"})}),Object(we.jsx)(ht,{submitUrl:F,title:"Recompile project ".concat(e.name),label:"Are you sure you want to recompile project ".concat(e.name,"?"),confirmLabel:"Recompile",method:"post",submitBody:function(){return{name:e.name}},onSubmit:function(){t.push(k)},onError:function(e){return"Project could not be recompiled"},tooltip:"Publish selected layers and styles and compile data for visualization",children:Object(we.jsx)(v.a,{marginRight:12,marginBottom:12,appearance:"minimal",iconBefore:it.a,children:"Publish 3D & Styles"})}),Object(we.jsx)(v.a,{marginBottom:12,appearance:"minimal",iconBefore:Ke.a,onClick:function(){t.push(I+e.name)},children:"Map Layers"}),Object(we.jsx)(v.a,{marginRight:12,marginBottom:12,appearance:"minimal",iconBefore:at.a,onClick:function(){t.push(w+e.name)},children:"View"}),Object(we.jsx)(dt,{submitUrl:A,title:"Rename project ".concat(e.name),label:"Choose a new name for project ".concat(e.name),confirmLabel:"Rename",method:"post",submitBody:function(t){return{new:t,old:e.name}},onSubmit:e.showProject,onError:function(e,t){return"Project already exists"},children:Object(we.jsx)(v.a,{marginRight:12,marginBottom:12,appearance:"minimal",iconBefore:rt.a,children:"Rename"})}),Object(we.jsx)(ht,{submitUrl:R,title:"Delete project ".concat(e.name),label:"Do you really want to delete project ".concat(e.name,"?"),confirmLabel:"Delete",method:"delete",intent:"danger",submitBody:function(){return{data:{name:e.name}}},onSubmit:function(){e.showProject()},onError:function(e){return"Project could not be deleted"},children:Object(we.jsx)(v.a,{marginBottom:12,appearance:"minimal",iconBefore:st.a,intent:"danger",children:"Delete Project"})})]})}var ft=n(302),mt=n(342),pt=n(343);function vt(e){var t=Object(i.useState)([]),n=Object(u.a)(t,2),a=n[0],r=n[1],s=Object(l.g)(),o=function(){x.post(B,{name:e.name}).then((function(e){r(e.data)}))};Object(i.useEffect)((function(){return x.post(B,{name:e.name}).then((function(e){r(e.data)})),function(){r([])}}),[e.name,s]);var c=function(t){t.disabled?x.post(W,{project:e.name,name:t.name}).then((function(){o()})):x.post(X,{project:e.name,name:t.name}).then((function(){o()}))};return Object(we.jsxs)(f.a,{className:"section",children:[Object(we.jsx)(f.a,{className:"projectHeader",children:Object(we.jsx)(me.a,{className:"wide",is:"h3",children:" Layers"})}),Object(we.jsxs)(Te.a,{children:[Object(we.jsxs)(Te.a.Head,{className:"row",children:[Object(we.jsx)(Te.a.TextHeaderCell,{className:"wide",children:"Layer"}),Object(we.jsx)(Te.a.TextHeaderCell,{className:"wide",children:"Number of Objects"}),Object(we.jsx)(Te.a.TextHeaderCell,{className:"wide",children:"Type"}),Object(we.jsx)(Te.a.TextHeaderCell,{className:"narrow",children:"Public"}),Object(we.jsx)(Te.a.TextHeaderCell,{className:"narrow",children:"Rename"}),Object(we.jsx)(Te.a.TextHeaderCell,{className:"narrow",children:"Delete"})]}),Object(we.jsx)(Te.a.Body,{children:a.length>0?a.map((function(t){return Object(we.jsxs)(Te.a.Row,{paddingY:12,height:"auto",className:"row",children:[Object(we.jsx)(Te.a.TextCell,{className:"wide",children:t.name}),Object(we.jsx)(Te.a.TextCell,{className:"wide",children:"number"===typeof t.size?t.size:"".concat(t.size[0]," x ").concat(t.size[1])}),Object(we.jsx)(Te.a.TextCell,{className:"wide",children:t.type}),Object(we.jsx)(Te.a.TextCell,{className:"narrow",children:t.disabled?Object(we.jsx)(ft.a,{icon:g.a,appearance:"minimal",onClick:function(){return c(t)}}):Object(we.jsx)(ft.a,{icon:mt.a,intent:"success",appearance:"minimal",onClick:function(){return c(t)}})}),Object(we.jsx)(Te.a.TextCell,{className:"narrow",children:Object(we.jsx)(dt,{submitUrl:G,title:"Rename layer ".concat(t.name),label:"Choose a new name for layer ".concat(t.name),confirmLabel:"Rename",method:"post",submitBody:function(n){return{project:e.name,new:n,old:t.name}},onSubmit:o,onError:function(e,t){return"Project already exists"},children:Object(we.jsx)(ft.a,{icon:rt.a,appearance:"minimal"})})}),Object(we.jsx)(Te.a.TextCell,{className:"narrow",children:Object(we.jsx)(ht,{submitUrl:H,title:"Delete layer ".concat(t.name),label:"Do you really want to delete layer ".concat(t.name,"?"),confirmLabel:"Delete",method:"delete",submitBody:function(){return{data:{project:e.name,name:t.name}}},onSubmit:o,onError:function(e){return"Layer could not be deleted"},children:Object(we.jsx)(ft.a,{icon:st.a,intent:"danger",appearance:"minimal"})})})]},t.name)})):Object(we.jsx)(m.a,{background:"light",title:"No Layers in this Project",orientation:"horizontal",icon:Object(we.jsx)(pt.a,{color:"#C1C4D6"}),iconBgColor:"#EDEFF5",description:"Layers apper after successfull processing of the input files.",anchorCta:Object(we.jsx)(m.a.LinkButton,{is:Be,to:L+e.name,children:"Add first layer"})})})]})]})}function gt(e){var t=Object(i.useState)([]),n=Object(u.a)(t,2),a=n[0],r=n[1],s=Object(l.g)(),o=Object(i.useCallback)((function(){x.post(Z,{name:e.project}).then((function(e){r(e.data)}))}),[e.project]);return Object(i.useEffect)((function(){o()}),[e.project,s,o]),Object(we.jsxs)(f.a,{className:"styles",children:[Object(we.jsx)(f.a,{className:"projectHeader",children:Object(we.jsx)(me.a,{className:"wide",is:"h3",children:"Styles"})}),Object(we.jsx)(f.a,{className:"styleList",children:a.length>0?a.map((function(t){return Object(we.jsxs)(f.a,{className:"styleItem",children:[Object(we.jsx)(f.a,{className:"styleTitle",onClick:function(){s.push(D+e.project+"/"+t)},children:t}),Object(we.jsxs)(f.a,{children:[Object(we.jsx)(dt,{submitUrl:ie,title:"Rename style ".concat(t),label:"Choose a new name for style ".concat(t),confirmLabel:"Rename",method:"post",submitBody:function(n){return{project:e.project,new:n,old:t}},onSubmit:function(){o()},onError:function(e,t){return"Project already exists"},children:Object(we.jsx)(v.a,{marginRight:16,appearance:"minimal",iconBefore:rt.a,children:"Rename"})}),Object(we.jsx)(ht,{submitUrl:ne,title:"Delete style ".concat(t),label:"Do you really want to delete style ".concat(t,"?"),confirmLabel:"Delete",method:"delete",intent:"danger",submitBody:function(){return{data:{project:e.project,name:t}}},onSubmit:function(){o()},onError:function(e){return"Style could not be deleted"},children:Object(we.jsx)(v.a,{appearance:"minimal",intent:"danger",iconBefore:st.a,children:"Delete"})})]})]},t)})):Object(we.jsx)(m.a,{background:"light",title:"No Styles in this Project",orientation:"vertical",icon:Object(we.jsx)(nt.a,{color:"#C1C4D6"}),iconBgColor:"#EDEFF5",description:"Styles modify the appearance of the layer in the visualization according to the layer and object metadata"})})]})}function bt(e){return Object(we.jsxs)(f.a,{className:"project",children:[Object(we.jsx)(f.a,{children:Object(we.jsx)(f.a,{className:"projectHeader main",children:Object(we.jsxs)(me.a,{className:"wide",children:["Project ",e.name]})})}),Object(we.jsx)(ut,{name:e.name,showProject:e.showProject}),Object(we.jsx)(vt,{name:e.name}),Object(we.jsx)(gt,{project:e.name})]})}var jt=n(344),yt=n(345),xt=n(346);function Ot(e){return Object(we.jsxs)(f.a,{className:"list",children:[Object(we.jsx)(me.a,{className:"projectList title",children:"Projects"}),Object(we.jsx)(dt,{submitUrl:T,title:"Add Project",label:"Choose the name of the new project",confirmLabel:"Create",method:"post",submitBody:function(e){return{name:e}},onSubmit:function(t){e.onSelect(t)},onError:function(e,t){return"Project already exists"},children:Object(we.jsxs)(f.a,{className:"projectList action",children:[Object(we.jsx)(jt.a,{}),"Add Project"]})}),Object(we.jsx)(yt.a,{className:"projectList tabs",children:e.projects.map((function(t){return Object(we.jsx)(xt.a,{id:"tab-".concat(t),onSelect:function(){return e.onSelect(t)},isSelected:t===e.currentProject,children:t},t)}))})]})}function _t(){var e=Object(l.h)().project_name,t=Object(i.useState)(e),n=Object(u.a)(t,2),a=n[0],r=n[1],s=Object(i.useState)([]),o=Object(u.a)(s,2),c=o[0],d=o[1],h=Object(l.g)(),p=function(){x.get(P).then((function(e){d(e.data)}))};Object(i.useEffect)((function(){return p(),function(){d([])}}),[h]);var v=function(e){p(),r(e);var t=k;e&&(t+=e),h.push(t)};return Object(we.jsxs)(f.a,{children:[Object(we.jsx)(Ve,{projects:!0}),Object(we.jsxs)(f.a,{className:"projects",children:[Object(we.jsx)(Ot,{currentProject:a,onSelect:v,projects:c}),Object(we.jsx)(f.a,{className:"content ".concat(a?"":"empty"),justifyContent:"center",alignItems:"center",children:a?c.indexOf(a)>-1?Object(we.jsx)(bt,{name:a,showProject:v}):Object(we.jsx)(m.a,{background:"light",title:"Project ".concat(a," not found"),orientation:"vertical",icon:Object(we.jsx)(et.a,{color:"#C1C4D6"}),iconBgColor:"#EDEFF5"}):Object(we.jsx)(m.a,{background:"light",title:"No project selected",orientation:"vertical",icon:Object(we.jsx)(et.a,{color:"#C1C4D6"}),iconBgColor:"#EDEFF5"})})]})]})}var wt=n(142),St=n(370),kt=n(348),Ct=n(349),Lt=n(35),Mt={defaultToken:"",number:/\d+(\.\d+)?/,keywords:["@layer","@target","@source","@meta","@legend"],typeKeywords:["@default","@color","@visible"],symbols:/[=><!~?:&|+\-*\/\^%]+/,escapes:/\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,digits:/\d+(_+\d+)*/,octaldigits:/[0-7]+(_+[0-7]+)*/,binarydigits:/[0-1]+(_+[0-1]+)*/,hexdigits:/[[0-9a-fA-F]+(_+[0-9a-fA-F]+)*/,regexpctl:/[(){}\[\]\$\^|\-*+?\.]/,regexpesc:/\\(?:[bBdDfnrstvwWn0\\\/]|@regexpctl|c[A-Z]|x[0-9a-fA-F]{2}|u[0-9a-fA-F]{4})/,tokenizer:{root:[[/[{}]/,"delimiter.bracket"],{include:"common"}],common:[[/@[a-z_$][\w$]*/,{cases:{"@typeKeywords":"keyword","@keywords":"type.identifier","@default":"identifier"}}],{include:"@whitespace"},[/\/(?=([^\\\/]|\\.)+\/([gimsuy]*)(\s*)(\.|;|\/|,|\)|\]|\}|$))/,{token:"regexp",bracket:"@open",next:"@regexp"}],[/[()\[\]]/,"@brackets"],[/[<>](?!@symbols)/,"@brackets"],[/@symbols/,{cases:{"@default":""}}],[/(@digits)[eE]([\-+]?(@digits))?/,"number.float"],[/(@digits)\.(@digits)([eE][\-+]?(@digits))?/,"number.float"],[/0[xX](@hexdigits)/,"number.hex"],[/#(@hexdigits)/,"number.hex"],[/0[oO]?(@octaldigits)/,"number.octal"],[/0[bB](@binarydigits)/,"number.binary"],[/(@digits)/,"number"],[/[;,.]/,"delimiter"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/'([^'\\]|\\.)*$/,"string.invalid"],[/"/,"string","@string_double"],[/'/,"string","@string_single"],[/`/,"string","@string_backtick"]],whitespace:[[/[ \t\r\n]+/,""]],regexp:[[/(\{)(\d+(?:,\d*)?)(\})/,["regexp.escape.control","regexp.escape.control","regexp.escape.control"]],[/(\[)(\^?)(?=(?:[^\]\\\/]|\\.)+)/,["regexp.escape.control",{token:"regexp.escape.control",next:"@regexrange"}]],[/(\()(\?:|\?=|\?!)/,["regexp.escape.control","regexp.escape.control"]],[/[()]/,"regexp.escape.control"],[/@regexpctl/,"regexp.escape.control"],[/[^\\\/]/,"regexp"],[/@regexpesc/,"regexp.escape"],[/\\\./,"regexp.invalid"],[/(\/)([gimsuy]*)/,[{token:"regexp",bracket:"@close",next:"@pop"},"keyword.other"]]],regexrange:[[/-/,"regexp.escape.control"],[/\^/,"regexp.invalid"],[/@regexpesc/,"regexp.escape"],[/[^\]]/,"regexp"],[/\]/,{token:"regexp.escape.control",next:"@pop",bracket:"@close"}]],string_double:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,"string","@pop"]],string_single:[[/[^\\']+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/'/,"string","@pop"]],string_backtick:[[/\$\{/,{token:"delimiter.bracket",next:"@bracketCounting"}],[/[^\\`$]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/`/,"string","@pop"]],bracketCounting:[[/\{/,"delimiter.bracket","@bracketCounting"],[/\}/,"delimiter.bracket","@pop"],{include:"common"}]}},Dt={brackets:[["{","}"],["[","]"],["(",")"]]};function Nt(e){return[{label:"Layer class",kind:Lt.a.CompletionItemKind.Class,insertTextRules:Lt.a.CompletionItemInsertTextRule.InsertAsSnippet,documentation:"Layer style class",insertText:"layer (${1:layer-key}) {\n    ${2:@properties}\n}",range:e},{label:"Target styles",kind:Lt.a.CompletionItemKind.Class,insertTextRules:Lt.a.CompletionItemInsertTextRule.InsertAsSnippet,documentation:"Styles based on metadata of the overlay source layer",insertText:"target {\n    ${1:value}\n}",range:e},{label:"Source styles",kind:Lt.a.CompletionItemKind.Class,insertTextRules:Lt.a.CompletionItemInsertTextRule.InsertAsSnippet,documentation:"Styles based on metadata of the overlay target layer",insertText:"source {\n    ${1:value}\n}",range:e},{label:"Meta class",kind:Lt.a.CompletionItemKind.Class,insertTextRules:Lt.a.CompletionItemInsertTextRule.InsertAsSnippet,documentation:"Styles based on metadata of the layer",insertText:"meta (${1:identifier}) {\n    ${2:value}\n}",range:e},{label:"Legend class",kind:Lt.a.CompletionItemKind.Class,insertTextRules:Lt.a.CompletionItemInsertTextRule.InsertAsSnippet,documentation:"Legend - description of the used colors",insertText:"legend {\n    ${1:value}\n}",range:e},{label:"Color value",kind:Lt.a.CompletionItemKind.Value,insertTextRules:Lt.a.CompletionItemInsertTextRule.InsertAsSnippet,documentation:"Color style class",insertText:"color: #${1:color};",range:e},{label:"Visibility value",kind:Lt.a.CompletionItemKind.Value,insertTextRules:Lt.a.CompletionItemInsertTextRule.InsertAsSnippet,documentation:"Visibility style class",insertText:"visible: ${1:boolean};",range:e},{label:"Default value",kind:Lt.a.CompletionItemKind.Value,insertTextRules:Lt.a.CompletionItemInsertTextRule.InsertAsSnippet,documentation:"Default style class",insertText:"default: ${1:value};",range:e}]}var It=new RegExp(/^(\s*)/.source+/@[a-zA-Z]+/.source+/(\s*)$/.source,"mg");function Et(){var e=Object(l.h)(),t=e.project_name,n=e.style_name,a=Object(l.g)(),r=Object(i.useState)(void 0),s=Object(u.a)(r,2),o=s[0],c=s[1];Object(i.useEffect)((function(){o&&x.post(Q,{project:t,name:n}).then((function(e){var t=e.data;o.setValue(t.style)})).catch((function(e){console.error(e)}))}),[o,t,n]);var h=Object(i.useState)(!1),m=Object(u.a)(h,2),p=m[0],g=m[1],b=Object(i.useState)(""),j=Object(u.a)(b,2),y=j[0],O=j[1];return Object(we.jsxs)(f.a,{children:[Object(we.jsx)(Ve,{projects:!0}),Object(we.jsxs)(f.a,{className:"stylesHeader",children:[Object(we.jsxs)(me.a,{className:"wide",children:["Style ",n]}),Object(we.jsxs)(v.a,{marginRight:12,appearance:"minimal",iconBefore:et.a,onClick:function(){a.push(k+t)},children:["Back to Project ",t]}),Object(we.jsx)(St.a,{title:"Style Parsed",hasCancel:!1,hasFooter:!1,width:"auto",isShown:p,onCloseComplete:function(){return g(!1)},children:Object(we.jsx)(Fe.a,{className:"parsedMessage",children:y})}),Object(we.jsx)(v.a,{marginRight:12,appearance:"minimal",iconBefore:kt.a,onClick:function(){if(o){var e=o.getValue();x.post(re,{project:t,name:n,styles:e}).then((function(e){"error"===e.data.status?(O(e.data.error),g(!0)):(O("Style parsed successfuly"),g(!0))})).catch((function(e){console.error(e)}))}},children:"Parse"}),Object(we.jsx)(ht,{submitUrl:te,title:"Save style ".concat(n),label:"Are you sure you want to save style ".concat(n,"? Your previously compiled styles will be overwriten."),confirmLabel:"Overwrite",method:"post",submitBody:function(){if(!o)throw new Error("Error occured while saving the style.");return{project:t,name:n,styles:o.getValue()}},onSubmit:function(){console.log("Style ".concat(n," saved"))},onError:function(e){return"Style could not be saved"},tooltip:"Saves the new configuration and overwrites previously saved styles.",children:Object(we.jsx)(v.a,{marginRight:12,appearance:"minimal",iconBefore:Ct.a,children:"Save"})}),Object(we.jsx)(ht,{submitUrl:te,title:"Apply style ".concat(n),label:"Are you sure you want to recompile style ".concat(n,"?  Your previously compiled styles will be overwriten."),confirmLabel:"Compile",method:"post",submitBody:function(){if(!o)throw new Error("Error occured while saving the style.");return{project:t,name:n,styles:o.getValue()}},onSubmit:function(){x.post(ae,{project:t,name:n}).then((function(e){Object(d.b)("Compilation job submitted")})).catch((function(e){Object(d.b)("Job could not be submitted")}))},onError:function(e){return"Style could not be recompiled"},tooltip:"Recompile styles after updating to view the changes in the visualization",children:Object(we.jsx)(v.a,{appearance:"minimal",iconBefore:it.a,children:"Save and Compile"})})]}),Object(we.jsx)(f.a,{className:"styleView",children:Object(we.jsx)(wt.a,{beforeMount:function(e){e.languages.getLanguages().some((function(e){return"estimatemd"===e.id}))||(e.languages.register({id:"estimatemd"}),e.languages.setMonarchTokensProvider("estimatemd",Mt),e.languages.setLanguageConfiguration("estimatemd",Dt),e.languages.registerCompletionItemProvider("estimatemd",{provideCompletionItems:function(e,t){if(!e.getValueInRange({startLineNumber:0,startColumn:0,endLineNumber:t.lineNumber,endColumn:t.column}).match(It))return{suggestions:[]};var n=e.getWordUntilPosition(t);return{suggestions:Nt({startLineNumber:t.lineNumber,endLineNumber:t.lineNumber,startColumn:n.startColumn,endColumn:n.endColumn})}}}))},onMount:function(e,t){c(e)},className:"editor",height:"100%",defaultLanguage:"estimatemd"})})]})}var zt=n(38),Pt=n(143);function Tt(e){var t=Object(Pt.a)(),n=t.acceptedFiles,a=t.getRootProps,r=t.getInputProps,s=Object(i.createRef)(),o=n.map((function(e){return Object(we.jsxs)("li",{children:[Object(we.jsx)("span",{className:"fileName",children:e.name}),Object(we.jsxs)("span",{className:"fileSize",children:[e.size," bytes"]})]},e.name)}));return Object(we.jsxs)(f.a,{className:"dropzoneContainer",children:[Object(we.jsxs)("form",{onSubmit:function(t){t.preventDefault(),e.submit(s.current.value,n)},id:"layerUploadForm",children:[Object(we.jsx)(We.a,{placeholder:"layer name",ref:s,className:"layerName"}),Object(we.jsxs)("div",Object(h.a)(Object(h.a)({},a({className:"dropzone"})),{},{children:[Object(we.jsx)("input",Object(h.a)({},r())),Object(we.jsx)("p",{children:"Click or drag 'n' drop layer files here"}),Object(we.jsx)("ul",{className:"filelist",children:o})]}))]}),Object(we.jsx)(v.a,{appearance:"primary",type:"submit",form:"layerUploadForm",children:"Upload"})]})}function At(){var e=Object(l.h)().project_name,t=Object(l.g)(),n=Object(i.useState)(0),a=Object(u.a)(n,2),r=a[0],s=a[1],o=Object(i.useState)(!1),c=Object(u.a)(o,2),h=c[0],m=c[1];return Object(we.jsxs)(f.a,{children:[Object(we.jsx)(Ve,{projects:!0}),Object(we.jsxs)(f.a,{className:"upload",children:[h?Object(we.jsx)(p.a,{}):Object(we.jsx)($e.a,{icon:pt.a,size:30,color:"#C1C4D6",background:"#EDEFF5",className:"uploadIcon",padding:20,borderRadius:40}),Object(we.jsxs)(me.a,{className:"uploadTitle",children:["Uploading Layer to Project ",e]}),h?Object(we.jsx)(f.a,{className:"progress",children:Object(we.jsxs)(zt.a,{className:"label",children:[r.toFixed(0),"%"]})}):Object(we.jsx)(Tt,{submit:function(n,i){if(!h)if(void 0!==n&&0!==n.length)if(void 0!==i&&0!==i.length){m(!0);var a=new FormData;a.append("project",e),a.append("layer",n),i.forEach((function(e){a.append("files",e)})),x.post(V,a,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(e){return s(e.loaded/e.total*100)}}).then((function(e){t.push(k)}))}else Object(d.b)("No files provided");else Object(d.b)("No name specified")}})]})]})}var Rt,Ft=n(6),Ut=n(16);!function(e){e[e.float32=0]="float32",e[e.int32=1]="int32",e[e.uint8=2]="uint8"}(Rt||(Rt={}));var Bt=function(){self.onmessage=function(e){var t=e.data,n={jobID:t.jobID,resID:t.resID};switch(t.data.datatype){case 0:n.buffer=function(e){var t=atob(e);return new Float32Array(Uint8Array.from(t,(function(e){return e.charCodeAt(0)})).buffer)}(t.data.buffer);break;case 1:n.buffer=function(e,t){var n=atob(e),i=new Int32Array(Uint8Array.from(n,(function(e){return e.charCodeAt(0)})).buffer);return i.forEach((function(e,n){return i[n]=e+t})),new Uint8Array(i.buffer)}(t.data.buffer,t.data.offset);break;case 2:n.buffer=function(e){var t=atob(e);return Uint8Array.from(t,(function(e){return e.charCodeAt(0)}))}(t.data.buffer)}postMessage(n)}},Vt=function(){function e(){var t=this;Object(ue.a)(this,e),this.workers=void 0,this.worker_busy=void 0,this.queue=void 0,this.jobIDs=void 0,this.resultMap=void 0,this.workers=[],this.worker_busy=[],this.jobIDs=0,this.resultMap=new Map;for(var n=function(e){t.workers.push(function(e){var t=e.toString(),n=new Blob(["(".concat(t,")()")]);return new Worker(URL.createObjectURL(n))}(Bt)),t.worker_busy.push(!1),t.workers[e].onmessage=function(n){var i=n.data,a=i.buffer,r=i.jobID,s=i.resID,o=t.resultMap.get(r);o&&(o.data[s]=a,o.recieved++,o.recieved===o.expected&&(o.callback.apply(o,Object(Ut.a)(o.data)),t.resultMap.delete(r)),t.worker_busy[e]=!1,t.submit())}},i=0;i<20;++i)n(i);this.queue=[]}return Object(fe.a)(e,[{key:"worker",get:function(){for(var e=0;e<20;++e)if(!this.worker_busy[e])return e}},{key:"process",value:function(e,t){var n=this.jobIDs++;this.resultMap.set(n,{data:Array.apply(null,Array(e.length)).map((function(){})),recieved:0,expected:e.length,callback:t});for(var i=0;i<e.length;++i)this.queue.push({data:e[i],jobID:n,resID:i});this.submit()}},{key:"submit",value:function(){var e=this.worker;if(void 0!==e){var t=this.queue.shift();t&&(this.worker_busy[e]=!0,this.workers[e].postMessage(t))}}}],[{key:"Instance",get:function(){return this._instance||(this._instance=new this)}}]),e}();Vt._instance=void 0;var Gt=function(){function e(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};Object(ue.a)(this,e),this.styles=void 0,this.styles=t||{},this.styles.buffer&&Vt.Instance.process([{datatype:Rt.uint8,buffer:this.styles.buffer}],(function(e){n.styles.buffer=e,i(n)})),this.styles.buffer_source&&this.styles.buffer_target&&Vt.Instance.process([{datatype:Rt.uint8,buffer:this.styles.buffer_source},{datatype:Rt.uint8,buffer:this.styles.buffer_target}],(function(e,t){n.styles.buffer_source=e,n.styles.buffer_target=t,i(n)}))}return Object(fe.a)(e,[{key:"pickable",get:function(){return!this.styles.pickable||this.styles.pickable}},{key:"visible",get:function(){return!this.styles.visible||this.styles.visible}},{key:"color_buffer",get:function(){if(this.styles.buffer)return this.styles.buffer;throw new Error("No colors defined")}},{key:"color_buffer_target",get:function(){if(this.styles.buffer_target)return this.styles.buffer_target;throw new Error("No target colors defined")}},{key:"color_buffer_source",get:function(){if(this.styles.buffer_source)return this.styles.buffer_source;throw new Error("No source colors defined")}}]),e}();function Ht(e,t,n,i,a){var r={i:0,ci:0,it:1,total_stop:t.length/Uint32Array.BYTES_PER_ELEMENT,view:new DataView(t.buffer)};setTimeout((function t(){for(var s,o=1e5*r.it,c=Math.min(o,r.total_stop);r.i<c;r.i++)s=3*(r.view.getUint32(r.i*Uint32Array.BYTES_PER_ELEMENT,!0)-e),i[r.ci++]=n[s],i[r.ci++]=n[s+1],i[r.ci++]=n[s+2];r.i<r.total_stop?(r.it++,setTimeout(t,4)):(a(),r=null)}),4)}function Wt(e,t,n){var i={i:0,ci:0,it:1,total_stop:e};setTimeout((function e(){for(var a=1e5*i.it*Uint8Array.BYTES_PER_ELEMENT,r=Math.min(a,i.total_stop);i.i<r;i.i++)t[i.ci++]=255,t[i.ci++]=255,t[i.ci++]=255;i.i<i.total_stop?(i.it++,setTimeout(e,4)):(n(),i=null)}),4)}function Xt(e,t){var n=Math.max(Math.abs(e),Math.abs(t));if(0===e&&0===t)return 0;var i,a=8*((i=n-1)*(i+1)/2);if(e>Math.abs(t)||e===t&&e>0)return a+n+t;if((t>Math.abs(e)||t===-e)&&t>0)return a+4*n-n-e;if(e<t||e===t&&e<0)return a+5*n-t;if(t<e||-t===e&&t<0)return a+7*n+e;throw new Error("Cannot covert to 1D")}var Yt,$t=n(59),Kt=n(17);!function(e){e[e.source=0]="source",e[e.target=1]="target",e[e.object=2]="object"}(Yt||(Yt={}));var Jt=function(){function e(t){Object(ue.a)(this,e),this.renderer=void 0,this.mesh=void 0,this.pickingMesh=void 0,this.visibility=void 0,this.renderer=t,this.visibility=!0}return Object(fe.a)(e,[{key:"visible",set:function(e){this.visibility=e,this.mesh&&(this.mesh.visible=e),this.pickingMesh&&(this.pickingMesh.visible=e)}},{key:"remove",value:function(){this.mesh=this.removeFrom(this.mesh,this.renderer.scene),this.pickingMesh=this.removeFrom(this.pickingMesh,this.renderer.pickingScene)}},{key:"removeFrom",value:function(e,t){e&&(t.remove(e),e.geometry.dispose())}},{key:"baseColors",value:function(e){for(var t=new Uint8Array(e),n=0;n<e;n++)t[n]=255;return t}},{key:"afterApplyStyle",value:function(){this.renderer.status.actions.applyingStyles.stop(),this.mesh&&(this.mesh.geometry.attributes.color.needsUpdate=!0,this.renderer.changed=!0)}},{key:"applyStyle",value:function(e,t,n){if(this.mesh&&this.mesh.geometry.attributes.objectID){this.renderer.status.actions.applyingStyles.start();var i=this.mesh.geometry.attributes.objectID.array,a=this.mesh.geometry.attributes.color.array;t?Ht(e,i,t.color_buffer,a,this.afterApplyStyle.bind(this)):Wt(i.length,a,this.afterApplyStyle.bind(this))}}}]),e}(),qt=function(e){Object(xe.a)(n,e);var t=Object(Oe.a)(n);function n(){return Object(ue.a)(this,n),t.apply(this,arguments)}return Object(fe.a)(n,[{key:"applyStyle",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Yt.source;if(this.mesh&&this.mesh.geometry.attributes.objectID){this.renderer.status.actions.applyingStyles.start();var i=this.mesh.geometry.attributes.objectID.array,a=this.mesh.geometry.attributes.color.array;t?n===Yt.source?Ht(e,i,t.color_buffer_source,a,this.afterApplyStyle.bind(this)):Ht(e,i,t.color_buffer_target,a,this.afterApplyStyle.bind(this)):Wt(i.length,a,this.afterApplyStyle.bind(this))}}}]),n}(Jt),Zt=function(e){Object(xe.a)(n,e);var t=Object(Oe.a)(n);function n(e,i,a,r){var s;Object(ue.a)(this,n),s=t.call(this,i.renderer);var o=i.renderer.picker.offsetForLayer(i.layer.name);return Vt.Instance.process([{datatype:Rt.float32,buffer:e.vertices},{datatype:Rt.int32,buffer:e.attributes.oid.data,offset:o}],(function(e,t){s.init(e,t,i),a(Object(Kt.a)(s))})),s}return Object(fe.a)(n,[{key:"init",value:function(e,t,n){var i=this.createGeometry(e,t);this.createMesh(i),this.createPickingMesh(i),this.visible=n.visible,this.renderer.changed=!0}},{key:"createPickingMesh",value:function(e){var t=new ge.C(e,this.renderer.matlib.pickingPolygonMaterial);this.renderer.pickingScene.add(t),this.pickingMesh=t}},{key:"createMesh",value:function(e){var t=this.renderer.matlib.polygonMaterial,n=new ge.C(e,t);n.receiveShadow=!0,n.castShadow=!0,this.renderer.scene.add(n),this.mesh=n}},{key:"createGeometry",value:function(e,t){var n=new ge.f;return n.setAttribute("position",new ge.e(e,3)),n.setAttribute("objectID",new ge.e(t,4,!0)),n.setAttribute("color",new ge.e(this.baseColors(e.length),3,!0)),n.computeVertexNormals(),n}}]),n}(Jt),Qt=function(e){Object(xe.a)(n,e);var t=Object(Oe.a)(n);function n(e,i,a,r){var s;Object(ue.a)(this,n),s=t.call(this,i.renderer);var o=i.renderer.picker.offsetForLayer(i.layer.source);return Vt.Instance.process([{datatype:Rt.float32,buffer:e.vertices},{datatype:Rt.int32,buffer:e.attributes.source_oid.data,offset:o}],(function(e,t){s.init(e,t,i),a(Object(Kt.a)(s))})),s}return Object(fe.a)(n,[{key:"init",value:function(e,t,n){var i=this.createGeometry(e,t);this.createMesh(i),this.createPickingMesh(i),this.visible=n.visible,this.renderer.changed=!0}},{key:"createPickingMesh",value:function(e){var t=new ge.C(e,this.renderer.matlib.pickingPolygonMaterial);this.renderer.pickingScene.add(t),this.pickingMesh=t}},{key:"createMesh",value:function(e){var t=this.renderer.matlib.polygonMaterial,n=new ge.C(e,t);n.receiveShadow=!0,n.castShadow=!0,this.renderer.scene.add(n),this.mesh=n}},{key:"createGeometry",value:function(e,t){var n=new ge.f;return n.setAttribute("position",new ge.e(e,3)),n.setAttribute("objectID",new ge.e(t,4,!0)),n.setAttribute("color",new ge.e(this.baseColors(e.length),3,!0)),n.computeVertexNormals(),n}}]),n}(qt);function en(e){for(var t=[],n=Math.PI/2,i=Math.PI/e,a=0;a<e;++a)t.push(0,0,0),t.push(Math.cos(n+i*a),Math.sin(n+i*a),0),t.push(Math.cos(n+i*(a+1)),Math.sin(n+i*(a+1)),0);return t}function tn(e){for(var t=[],n=Math.PI/2,i=Math.PI/e,a=0;a<e;++a)t.push(1,0,0),t.push(1-Math.cos(n+i*a),Math.sin(n+i*a),0),t.push(1-Math.cos(n+i*(a+1)),Math.sin(n+i*(a+1)),0);return t}function nn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[0,-1,0,1,-1,0,1,1,0,0,-1,0,1,1,0,0,1,0];return t=(t=t.concat(en(e))).concat(tn(e))}var an=function(e){Object(xe.a)(n,e);var t=Object(Oe.a)(n);function n(e,i,a,r){var s;Object(ue.a)(this,n),s=t.call(this,i.renderer);var o=i.renderer.picker.offsetForLayer(i.layer.name);return Vt.Instance.process([{datatype:Rt.float32,buffer:e.vertices},{datatype:Rt.int32,buffer:e.attributes.oid.data,offset:o}],(function(e,t){s.init(e,t,i),a(Object(Kt.a)(s))})),s}return Object(fe.a)(n,[{key:"init",value:function(e,t,n){var i=this.createGeometry(e,t);this.createMesh(i),this.createPickingMesh(i),this.visible=n.visible,this.renderer.changed=!0}},{key:"createPickingMesh",value:function(e){var t=new ge.C(e,this.renderer.matlib.pickingLineMaterial);t.frustumCulled=!1,this.renderer.pickingScene.add(t),this.pickingMesh=t}},{key:"createMesh",value:function(e){var t=new ge.C(e,this.renderer.matlib.lineMaterial);t.frustumCulled=!1,this.renderer.scene.add(t),this.mesh=t}},{key:"createGeometry",value:function(e,t){var n=new ge.q;return n.instanceCount=e.length/3,n.setAttribute("position",new ge.e(new Float32Array(nn()),3)),n.setAttribute("lineStart",new ge.t(new ge.r(e,6,1),3,0)),n.setAttribute("lineEnd",new ge.t(new ge.r(e,6,1),3,3)),n.setAttribute("objectID",new ge.p(t,4,!0,1)),n.setAttribute("color",new ge.p(this.baseColors(e.length),3,!0,1)),n}}]),n}(Jt),rn=function(e){Object(xe.a)(n,e);var t=Object(Oe.a)(n);function n(e,i,a,r){var s;Object(ue.a)(this,n),s=t.call(this,i.renderer);var o=i.renderer.picker.offsetForLayer(i.layer.source);return Vt.Instance.process([{datatype:Rt.float32,buffer:e.vertices},{datatype:Rt.int32,buffer:e.attributes.source_oid.data,offset:o}],(function(e,t){s.init(e,t,i),a(Object(Kt.a)(s))})),s}return Object(fe.a)(n,[{key:"init",value:function(e,t,n){var i=this.createGeometry(e,t);this.createMesh(i),this.createPickingMesh(i),this.visible=n.visible,this.renderer.changed=!0}},{key:"createPickingMesh",value:function(e){var t=new ge.C(e,this.renderer.matlib.pickingLineMaterial);t.frustumCulled=!1,this.renderer.pickingScene.add(t),this.pickingMesh=t}},{key:"createMesh",value:function(e){var t=new ge.C(e,this.renderer.matlib.lineMaterial);t.frustumCulled=!1,this.renderer.scene.add(t),this.mesh=t}},{key:"createGeometry",value:function(e,t){var n=new ge.q;return n.instanceCount=e.length/3,n.setAttribute("position",new ge.e(new Float32Array(nn()),3)),n.setAttribute("lineStart",new ge.t(new ge.r(e,6,1),3,0)),n.setAttribute("lineEnd",new ge.t(new ge.r(e,6,1),3,3)),n.setAttribute("objectID",new ge.p(t,4,!0,1)),n.setAttribute("color",new ge.p(this.baseColors(e.length),3,!0,1)),n}}]),n}(qt),sn=function(e){Object(xe.a)(n,e);var t=Object(Oe.a)(n);function n(e,i,a,r){var s;Object(ue.a)(this,n),s=t.call(this,i.renderer);var o=i.renderer.picker.offsetForLayer(i.layer.name);return Vt.Instance.process([{datatype:Rt.float32,buffer:e.vertices},{datatype:Rt.int32,buffer:e.attributes.oid.data,offset:o}],(function(e,t){s.init(e,t,i),a(Object(Kt.a)(s))})),s}return Object(fe.a)(n,[{key:"init",value:function(e,t,n){var i=this.createGeometry(e,t);this.createMesh(i),this.createPickingMesh(i),this.visible=n.visible,this.renderer.changed=!0}},{key:"createPickingMesh",value:function(e){var t=new ge.C(e,this.renderer.matlib.pickingPointMaterial);t.frustumCulled=!1,this.renderer.pickingScene.add(t),this.pickingMesh=t}},{key:"createMesh",value:function(e){var t=this.renderer.matlib.pointMaterial,n=new ge.C(e,t);n.frustumCulled=!1,this.renderer.scene.add(n),this.mesh=n}},{key:"createGeometry",value:function(e,t){var n=new ge.G(5,0),i=new Float32Array(n.attributes.position.array);n.dispose();var a=new ge.q;return a.instanceCount=e.length/3,a.setAttribute("position",new ge.e(i,3)),a.setAttribute("location",new ge.p(e,3,!1,1)),a.setAttribute("objectID",new ge.p(t,4,!0,1)),a.setAttribute("color",new ge.p(this.baseColors(e.length),3,!0,1)),a.computeVertexNormals(),a}}]),n}(Jt),on=function(e){Object(xe.a)(n,e);var t=Object(Oe.a)(n);function n(e,i,a,r){var s;Object(ue.a)(this,n),s=t.call(this,i.renderer);var o=i.renderer.picker.offsetForLayer(i.layer.source);return Vt.Instance.process([{datatype:Rt.float32,buffer:e.vertices},{datatype:Rt.int32,buffer:e.attributes.source_oid.data,offset:o}],(function(e,t){s.init(e,t,i),a(Object(Kt.a)(s))})),s}return Object(fe.a)(n,[{key:"init",value:function(e,t,n){var i=this.createGeometry(e,t);this.createMesh(i),this.createPickingMesh(i),this.visible=n.visible,this.renderer.changed=!0}},{key:"createPickingMesh",value:function(e){var t=new ge.C(e,this.renderer.matlib.pickingPointMaterial);t.frustumCulled=!1,this.renderer.pickingScene.add(t),this.pickingMesh=t}},{key:"createMesh",value:function(e){var t=this.renderer.matlib.pointMaterial,n=new ge.C(e,t);n.frustumCulled=!1,this.renderer.scene.add(n),this.mesh=n}},{key:"createGeometry",value:function(e,t){var n=new ge.G(5,0),i=new Float32Array(n.attributes.position.array);n.dispose();var a=new ge.q;return a.instanceCount=e.length/3,a.setAttribute("position",new ge.e(i,3)),a.setAttribute("location",new ge.p(e,3,!1,1)),a.setAttribute("objectID",new ge.p(t,4,!0,1)),a.setAttribute("color",new ge.p(this.baseColors(e.length),3,!0,1)),a.computeVertexNormals(),a}}]),n}(qt),cn=function(e){Object(xe.a)(n,e);var t=Object(Oe.a)(n);function n(e,i,a,r){var s;Object(ue.a)(this,n),(s=t.call(this,i.renderer)).time=void 0,s.time=e.time;var o=i.layer.getOffset();return Vt.Instance.process([{datatype:Rt.float32,buffer:e.from},{datatype:Rt.float32,buffer:e.to},{datatype:Rt.int32,buffer:e.oid,offset:o},{datatype:Rt.float32,buffer:e.from_speed},{datatype:Rt.float32,buffer:e.to_speed}],(function(e,t,n,i,r){s.init(e,t,n,i,r),a(Object(Kt.a)(s))})),s}return Object(fe.a)(n,[{key:"init",value:function(e,t,n,i,a){var r=this.createGeometry(e,t,n,i,a);this.createMesh(r),this.createPickingMesh(r),this.visible=!0,this.renderer.changed=!0}},{key:"createMesh",value:function(e){var t=this.renderer.matlib.agentMaterial,n=new ge.C(e,t);n.frustumCulled=!1,this.renderer.scene.add(n),this.mesh=n}},{key:"createPickingMesh",value:function(e){var t=this.renderer.matlib.pickingAgentMaterial,n=new ge.C(e,t);n.frustumCulled=!1,this.renderer.pickingScene.add(n),this.pickingMesh=n}},{key:"createGeometry",value:function(e,t,n,i,a){var r=new ge.G(35,0),s=new Float32Array(r.attributes.position.array);r.dispose();var o=new ge.q;return o.instanceCount=e.length/3,o.setAttribute("position",new ge.e(s,3)),o.setAttribute("from",new ge.p(e,3,!1,1)),o.setAttribute("from_speed",new ge.p(i,1,!1,1)),o.setAttribute("to",new ge.p(t,3,!1,1)),o.setAttribute("to_speed",new ge.p(a,1,!1,1)),o.setAttribute("objectID",new ge.p(n,4,!0,1)),o.setAttribute("color",new ge.p(this.baseColors(e.length),3,!0,1)),o.computeVertexNormals(),o}}]),n}(Jt),ln={model:{simplepolygon:Zt,simpleline:an,simplepoint:sn},proxy:{simpleline:rn,simplepolygon:Qt,simplepoint:on}},dn=Object.keys(ln.model),hn=Object.keys(ln.proxy);function un(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){return!1};if(e.tags&&!0===e.tags.proxy){if(hn.includes(e.type))return new ln.proxy[e.type](e,t,n,i);throw new Error("Proxy type ".concat(e.type," is not registered"))}if(dn.includes(e.type))return new ln.model[e.type](e,t,n,i);throw new Error("Model type ".concat(e.type," is not registered"))}var fn=function(){function e(){Object(ue.a)(this,e),this.stopFlag=void 0,this.loaded=void 0,this.loaded=!1}return Object(fe.a)(e,[{key:"get",value:function(e,t){var n=this;this.stopFlag=j.a.CancelToken.source(),e.renderer.status.actions.loadingGeometry.start();var i=(Math.abs(e.x)+Math.abs(e.y))%6;x.get("".concat(se).concat(e.layer.project,"/").concat(e.layer.name,"/grid/stream/").concat(e.sourceFile),{cancelToken:this.stopFlag.token,baseURL:"http://static".concat(i,".").concat(Yn)}).then((function(i){e.renderer.status.actions.loadingGeometry.stop(),n.loaded||(n.loaded=!0,n.stopFlag=null,t(i.data))})).catch((function(t){e.renderer.status.actions.loadingGeometry.stop(),n.stopFlag=null}))}},{key:"abort",value:function(){this.stopFlag&&this.stopFlag.cancel(),this.stopFlag=null}}]),e}(),mn=function(){function e(t,n,i){Object(ue.a)(this,e),this.bbox=void 0,this.brect=void 0,this.x=void 0,this.y=void 0,this.renderer=void 0,this.layer=void 0,this.sourceFile=void 0,this.models=void 0,this.isVisible=void 0,this.loader=void 0,this.caching=void 0,this.bbox=[Object($t.a)(ge.X,Object(Ut.a)(t.box[0])),Object($t.a)(ge.X,Object(Ut.a)(t.box[1]))],this.brect=[new ge.W(this.bbox[0].x,this.bbox[0].y),new ge.W(this.bbox[1].x,this.bbox[1].y)],this.x=t.x,this.y=t.y,this.sourceFile=t.file,this.layer=i,this.renderer=n,this.isVisible=!1,this.models=[],this.loader=new fn,this.caching=!1,this.renderer.placeholders.addPlaceholder(this.x,this.y)}return Object(fe.a)(e,[{key:"visible",get:function(){return this.isVisible},set:function(e){this.isVisible!==e&&(this.isVisible=e,e?this.show():this.hide())}},{key:"show",value:function(){var e=this;if(this.renderer.placeholders.hidePlaceholder(this.x,this.y),this.loader.loaded||this.loader.get(this,(function(t){if(!e.isVisible&&!e.caching)return e.disposeCache();var n,i=Object(Ft.a)(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;e.renderer.status.actions.parsingGeometry.start(),un(a,e,(function(t){return e.renderer.status.actions.parsingGeometry.stop(),e.models.push(t),e.isVisible||e.caching?(e.layer.applyStyleToModels(e.models),e.isVisible||e.caching?void 0:e.disposeCache()):e.disposeCache()}),(function(){return e.isVisible||(e.renderer.status.actions.parsingGeometry.stop(),e.disposeCache()),!e.isVisible}))}}catch(r){i.e(r)}finally{i.f()}})),this.caching){var t,n=Object(Ft.a)(this.models);try{for(n.s();!(t=n.n()).done;){t.value.visible=!0}}catch(i){n.e(i)}finally{n.f()}}}},{key:"hide",value:function(){if(this.renderer.placeholders.showPlaceholder(this.x,this.y),this.loader.loaded||this.loader.abort(),this.caching){var e,t=Object(Ft.a)(this.models);try{for(t.s();!(e=t.n()).done;){e.value.visible=!1}}catch(n){t.e(n)}finally{t.f()}}else this.disposeCache()}},{key:"remove",value:function(){if(this.models.length>0){var e,t=Object(Ft.a)(this.models);try{for(t.s();!(e=t.n()).done;){e.value.remove()}}catch(n){t.e(n)}finally{t.f()}this.models=[]}}},{key:"enableCache",value:function(){this.caching=!0}},{key:"disableCache",value:function(){this.caching=!1,this.isVisible||this.disposeCache()}},{key:"disposeCache",value:function(){console.log("dispose cache");var e,t=Object(Ft.a)(this.models);try{for(t.s();!(e=t.n()).done;){e.value.remove()}}catch(n){t.e(n)}finally{t.f()}this.models=[],this.loader.loaded=!1}}]),e}();var pn,vn=function(){function e(t,n,i){Object(ue.a)(this,e),this.bbox=void 0,this.brect=void 0,this.focusPoint=void 0,this.renderer=void 0,this.tileSize=void 0,this.tiles=void 0,this.visible_radius=void 0,this.visible=void 0,this.visibleSwap=void 0,this.zero2=void 0,this.layer=void 0,this.tileSize=t.tile_size,this.renderer=n,this.layer=i,this.bbox=[new ge.X(1/0,1/0,1/0),new ge.X(-1/0,-1/0,-1/0)],this.tiles=new Map,this.createTiles(t,n,i),this.brect=[new ge.W(this.bbox[0].x,this.bbox[0].y),new ge.W(this.bbox[1].x,this.bbox[1].y)],this.focusPoint=new ge.W(1/0,1/0),this.visible_radius=2e3,this.visibleSwap=new Set,this.visible=new Set,this.zero2=new ge.W}return Object(fe.a)(e,[{key:"center",get:function(){return e=this.bbox,new ge.W(.5*(e[0].x+e[1].x),.5*(e[0].y+e[1].y));var e}},{key:"hide",value:function(){var e,t=Object(Ft.a)(this.visible.values());try{for(t.s();!(e=t.n()).done;){e.value.visible=!1}}catch(n){t.e(n)}finally{t.f()}}},{key:"show",value:function(){var e,t=Object(Ft.a)(this.visible.values());try{for(t.s();!(e=t.n()).done;){e.value.visible=!0}}catch(n){t.e(n)}finally{t.f()}}},{key:"createTiles",value:function(e,t,n){var i,a,r,s=Object(Ft.a)(e.tiles);try{for(s.s();!(i=s.n()).done;){var o=i.value,c=Xt(o.x,o.y),l=new mn(o,t,n);a=this.bbox,r=l.bbox,a[0].min(r[0]),a[1].max(r[1]),this.tiles.set(c,l)}}catch(d){s.e(d)}finally{s.f()}}},{key:"updateVisibleTiles",value:function(e){var t=this.focusPoint.clone().divideScalar(this.tileSize).floor(),n=new ge.W(e.x,e.y).divideScalar(this.tileSize).floor();t.equals(n)||(this.focusPoint.set(e.x,e.y),this.updateVisibility(n))}},{key:"reloadVisibility",value:function(){this.updateVisibility(this.focusPoint.clone().divideScalar(this.tileSize).floor())}},{key:"updateVisibility",value:function(e){var t=this,n=this.visible;this.visible=this.visibleSwap,this.visibleSwap=n;var i=Math.ceil(this.visible_radius/this.tileSize),a=e.clone().subScalar(i),r=e.clone().addScalar(i+1);this.visible.clear();for(var s=a.x;s<r.x;++s)for(var o=a.y;o<r.y;++o){var c=Xt(s,o),l=this.tiles.get(c);l&&(l.visible=!0,this.visible.add(l))}this.visibleSwap.forEach((function(e){t.visible.has(e)||(e.visible=!1)}))}}]),e}(),gn=n(141),bn=function(){function e(t,n,i,a){Object(ue.a)(this,e),this.start=void 0,this.end=void 0,this.length=void 0,this.file=void 0,this.renderer=void 0,this.layer=void 0,this.moves=void 0,this.loading=void 0,this.init=void 0,this.acitve=void 0,this.delayedCall=void 0,this.start=t.start_time,this.length=n,this.end=this.start+n,this.file=t.file,this.renderer=i,this.layer=a,this.loading=!1,this.init=!1,this.delayedCall=void 0,this.acitve=-1,this.moves=[]}return Object(fe.a)(e,[{key:"load",value:function(e){var t=this;return!this.loading&&!this.init&&(this.loading=!0,this.delayedCall=setTimeout((function(){t.delayedCall=void 0,t.renderer.status.actions.loadingGeometry.start(),x.get("".concat(se).concat(t.layer.project,"/").concat(t.layer.name,"/timeline/stream/").concat(t.file)).then((function(n){var i=n.data;t.renderer.status.actions.loadingGeometry.stop(),t.renderer.status.actions.parsingGeometry.start(),function(e,t,n,i){for(var a=0;a<e.length;++a)new cn({from:e.from[a],to:e.to[a],oid:e.oid[a],time:e.start_time+a,from_speed:e.from_speed[a],to_speed:e.to_speed[a]},t,n,i)}(i,t,(function(n){t.moves.push(n),n.visible=!1,t.moves.length===t.length&&(t.renderer.status.actions.parsingGeometry.stop(),t.finalizeInit(),e())}),(function(){return!1}))}))}),1e3),!0)}},{key:"finalizeInit",value:function(){this.moves.sort((function(e,t){return e.time-t.time})),this.init=!0,this.loading=!1}},{key:"render",value:function(e){if(this.init){var t=Math.floor(e)-this.start;this.acitve!==t&&(-1!==this.acitve&&(this.moves[this.acitve].visible=!1),t>=this.moves.length||(this.moves[t].visible=!0,this.acitve=t))}}},{key:"contains",value:function(e){return e>=this.start&&e<this.end}},{key:"remove",value:function(){var e,t=Object(Ft.a)(this.moves);try{for(t.s();!(e=t.n()).done;){e.value.remove()}}catch(n){t.e(n)}finally{t.f()}this.delayedCall&&clearTimeout(this.delayedCall),this.loading=!1,this.init=!1,this.moves=[]}},{key:"hide",value:function(){-1!==this.acitve&&(this.moves[this.acitve].visible=!1)}},{key:"show",value:function(){-1!==this.acitve&&(this.moves[this.acitve].visible=!0)}}]),e}();!function(e){e[e.loading=0]="loading",e[e.wontload=1]="wontload",e[e.loaded=2]="loaded"}(pn||(pn={}));var jn=function(){function e(t,n,i){Object(ue.a)(this,e),this.intervals=void 0,this.intervalLength=void 0,this.isVisible=void 0,this.active=void 0,this.start=void 0,this.end=void 0,this.fillingBuffer=void 0,this.loaded=void 0,this.intervals=[],this.intervalLength=t.interval_length,this.active=-1,this.isVisible=!0,this.fillingBuffer=!0,this.loaded=new Map;var a,r=Object(Ft.a)(t.intervals);try{for(r.s();!(a=r.n()).done;){var s=a.value;this.intervals.push(new bn(s,this.intervalLength,n,i))}}catch(o){r.e(o)}finally{r.f()}this.intervals.sort((function(e,t){return e.start-t.start})),this.start=this.intervals[0].start,this.end=this.intervals[this.intervals.length-1].start+this.intervalLength,n.timeline.addTimeline(this)}return Object(fe.a)(e,[{key:"visible",set:function(e){this.isVisible!==e&&(this.isVisible=e,e?this.show():this.hide())}},{key:"countLoaded",get:function(){var e,t=0,n=Object(Ft.a)(this.loaded.values());try{for(n.s();!(e=n.n()).done;){e.value!==pn.loading&&t++}}catch(i){n.e(i)}finally{n.f()}return t}},{key:"ready",get:function(){var e=this.countLoaded;return this.fillingBuffer?e>=2&&(this.fillingBuffer=!1,!0):e>=2}},{key:"render",value:function(e){this.isVisible&&(this.updateLoaded(e),this.intervals[this.active]&&this.intervals[this.active].contains(e)||this.swapActive(e),-1!==this.active&&this.intervals[this.active].render(e))}},{key:"updateLoaded",value:function(e){for(var t=this.current(e),n=t;n<t+5;n++)this.loadInterval(n);this.discard(t)}},{key:"swapActive",value:function(e){var t=this.current(e);this.active=-1,this.intervals[t]&&this.intervals[t].init&&(this.active=t)}},{key:"current",value:function(e){return Object(gn.le)(this.intervals,{start:e},(function(e,t){return e.start-t.start}))}},{key:"loadInterval",value:function(e){var t=this,n=this.intervals[e];n?n.init||n.loading||(this.loaded.set(e,pn.loading),n.load((function(){t.loaded.set(e,pn.loaded)}))):this.loaded.set(e,pn.wontload)}},{key:"discard",value:function(e){var t,n=Object(Ft.a)(this.loaded.keys());try{for(n.s();!(t=n.n()).done;){var i=t.value;(i<e||i>=e+5)&&this.unloadInterval(i)}}catch(a){n.e(a)}finally{n.f()}}},{key:"unloadInterval",value:function(e){this.loaded.get(e)!==pn.wontload&&this.intervals[e].remove(),this.loaded.delete(e)}},{key:"hide",value:function(){this.visible=!1,-1!==this.active&&this.intervals[this.active].hide()}},{key:"show",value:function(){this.visible=!0,-1!==this.active&&this.intervals[this.active].show()}}]),e}(),yn=function(){function e(t,n,i,a){Object(ue.a)(this,e),this.name=void 0,this.project=void 0,this.renderer=void 0,this.grid=void 0,this.timeline=void 0,this.style=void 0,this.visibility=void 0,this.name=i.name,this.project=n,this.renderer=t,this.visibility=!0}return Object(fe.a)(e,[{key:"visible",get:function(){return this.visibility},set:function(e){e!==this.visibility&&(this.visibility=e,this.visibility?this.show():this.hide())}},{key:"init",value:function(e){e.grid&&(this.grid=new vn(e.grid,this.renderer,this),this.renderer.controls.focus(this.grid.center),this.grid.updateVisibleTiles(this.renderer.controls.target),this.renderer.changed=!0),e.timeline&&(this.timeline=new jn(e.timeline,this.renderer,this),this.renderer.changed=!0)}},{key:"updateVisibleRadius",value:function(e){this.visibility&&this.grid&&this.grid.updateVisibleTiles(e)}},{key:"hide",value:function(){this.grid&&this.grid.hide(),this.timeline&&this.timeline.hide(),this.renderer.changed=!0}},{key:"show",value:function(){this.grid&&this.grid.reloadVisibility(),this.timeline&&this.timeline.show(),this.renderer.changed=!0}},{key:"setVisibleRadius",value:function(e){this.grid&&(this.grid.visible_radius=e,this.visible&&this.grid.reloadVisibility()),this.renderer.changed=!0}},{key:"applyStyle",value:function(e){var t=this;this.renderer.status.actions.loadingStyles.start(),x.get("".concat(se).concat(this.project,"/styles/").concat(e,"/").concat(this.name,".json"),{headers:{"Cache-Control":"no-cache",Pragma:"no-cache",Expires:"0"}}).then((function(e){t.renderer.status.actions.loadingStyles.stop(),t.renderer.status.actions.applyingStyles.start(),new Gt(e.data,(function(e){if(t.style=e,t.grid){var n,i=Object(Ft.a)(t.grid.tiles.values());try{for(i.s();!(n=i.n()).done;){var a=n.value;t.applyStyleToModels(a.models)}}catch(r){i.e(r)}finally{i.f()}}t.renderer.status.actions.applyingStyles.stop()}))})).catch((function(){t.clearStyle()}))}},{key:"clearStyle",value:function(){if(this.style=void 0,this.grid){var e,t=Object(Ft.a)(this.grid.tiles.values());try{for(t.s();!(e=t.n()).done;){var n=e.value;this.applyStyleToModels(n.models)}}catch(i){t.e(i)}finally{t.f()}}}},{key:"enableCache",value:function(){if(this.grid){var e,t=Object(Ft.a)(this.grid.tiles.values());try{for(t.s();!(e=t.n()).done;){e.value.enableCache()}}catch(n){t.e(n)}finally{t.f()}}}},{key:"disableCache",value:function(){if(this.grid){var e,t=Object(Ft.a)(this.grid.tiles.values());try{for(t.s();!(e=t.n()).done;){e.value.disableCache()}}catch(n){t.e(n)}finally{t.f()}}}}]),e}(),xn=function(e){Object(xe.a)(n,e);var t=Object(Oe.a)(n);function n(e,i,a,r){var s;return Object(ue.a)(this,n),(s=t.call(this,e,i,a,r)).size=void 0,s.size=a.size,s.renderer.picker.offsetForLayer(s.name,s.size),s.init(a),s}return Object(fe.a)(n,[{key:"applyStyleToModels",value:function(e){var t,n=this.renderer.picker.offsetForLayer(this.name),i=Object(Ft.a)(e);try{for(i.s();!(t=i.n()).done;){t.value.applyStyle(n,this.style)}}catch(a){i.e(a)}finally{i.f()}}},{key:"getOffset",value:function(){return this.renderer.picker.offsetForLayer(this.name)}}]),n}(yn),On=function(e){Object(xe.a)(n,e);var t=Object(Oe.a)(n);function n(e,i,a,r){var s;return Object(ue.a)(this,n),(s=t.call(this,e,i,a,r)).source=void 0,s.target=void 0,s.size=void 0,s.source=a.source,s.target=a.target,s.size=a.size,s.renderer.picker.offsetForLayer(s.source,s.size[0]),s.renderer.picker.offsetForLayer(s.target,s.size[1]),s.init(a),s}return Object(fe.a)(n,[{key:"applyStyleToModels",value:function(e){var t,n=this.renderer.picker.offsetForLayer(this.source),i=Object(Ft.a)(e);try{for(i.s();!(t=i.n()).done;){t.value.applyStyle(n,this.style)}}catch(a){i.e(a)}finally{i.f()}}},{key:"getOffset",value:function(){return this.renderer.picker.offsetForLayer(this.source)}}]),n}(yn),_n=function(){function e(t,n){var i=this;Object(ue.a)(this,e),this.name=void 0,this.renderer=void 0,this.layers=void 0,this.styles=void 0,this.usedStyle=void 0,this.name=t,this.renderer=n,this.layers=[],this.styles=[],x.get("".concat(se).concat(this.name,"/layout.json"),{headers:{"Cache-Control":"no-cache",Pragma:"no-cache",Expires:"0"}}).then((function(e){var t=e.data.styles;i.styles=t;var n,a=Object(Ft.a)(e.data.layers);try{for(a.s();!(n=a.n()).done;){var r=n.value;r.disabled||!r.grid&&!r.timeline||"layer"===r.type&&i.layers.push(new xn(i.renderer,i.name,r,t))}}catch(l){a.e(l)}finally{a.f()}var s,o=Object(Ft.a)(e.data.layers);try{for(o.s();!(s=o.n()).done;){var c=s.value;c.disabled||!c.grid&&!c.timeline||"overlay"===c.type&&i.layers.push(new On(i.renderer,i.name,c,t))}}catch(l){o.e(l)}finally{o.f()}}))}return Object(fe.a)(e,[{key:"updateVisibleRadius",value:function(e){var t,n=Object(Ft.a)(this.layers);try{for(n.s();!(t=n.n()).done;){t.value.updateVisibleRadius(e)}}catch(i){n.e(i)}finally{n.f()}}},{key:"setVisibleRadius",value:function(e){var t,n=Object(Ft.a)(this.layers);try{for(n.s();!(t=n.n()).done;){t.value.setVisibleRadius(e)}}catch(i){n.e(i)}finally{n.f()}}},{key:"useCache",value:function(e){var t,n=Object(Ft.a)(this.layers);try{for(n.s();!(t=n.n()).done;){var i=t.value;e?i.enableCache():i.disableCache()}}catch(a){n.e(a)}finally{n.f()}}},{key:"applyStyle",value:function(e){if(-1!==this.styles.indexOf(e)){this.usedStyle=e;var t,n=Object(Ft.a)(this.layers);try{for(n.s();!(t=n.n()).done;){t.value.applyStyle(e)}}catch(i){n.e(i)}finally{n.f()}}}},{key:"clearStyle",value:function(){this.usedStyle=void 0;var e,t=Object(Ft.a)(this.layers);try{for(t.s();!(e=t.n()).done;){e.value.clearStyle()}}catch(n){t.e(n)}finally{t.f()}}}]),e}(),wn=(n(107),function(){function e(t){Object(ue.a)(this,e),this.renderer=void 0,this.timelines=void 0,this.time=void 0,this.start=void 0,this.end=void 0,this.play=void 0,this.speed=void 0,this.renderer=t,this.timelines=[],this.time=0,this.start=1/0,this.end=-1/0,this.play=!1,this.speed=1}return Object(fe.a)(e,[{key:"isEmpty",get:function(){return 0===this.timelines.length}},{key:"addTimeline",value:function(e){this.timelines.push(e),this.start=Math.min(this.start,e.start),this.end=Math.max(this.end,e.end)}},{key:"ready",get:function(){var e,t=Object(Ft.a)(this.timelines);try{for(t.s();!(e=t.n()).done;){if(!e.value.ready)return!1}}catch(n){t.e(n)}finally{t.f()}return!0}},{key:"hasData",get:function(){return this.timelines.length>0}},{key:"tick",value:function(){var e=1/60*this.speed;this.play&&this.ready&&(this.time+=e,this.time=this.time%this.end,this.time=Math.max(this.time,this.start),this.renderer.matlib.setTime(this.time),this.renderer.changed=!0),this.render()}},{key:"render",value:function(){var e,t=Object(Ft.a)(this.timelines);try{for(t.s();!(e=t.n()).done;){e.value.render(this.time)}}catch(n){t.e(n)}finally{t.f()}this.renderer.changed=!0}}]),e}()),Sn=function(){function e(t,n){Object(ue.a)(this,e),this.name=void 0,this.counter=void 0,this.manager=void 0,this.name=t,this.counter=0,this.manager=n}return Object(fe.a)(e,[{key:"start",value:function(){this.counter++,this.manager.update()}},{key:"stop",value:function(){this.counter--,this.manager.update()}},{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.counter," remaining")}},{key:"isRunning",get:function(){return this.counter>0}}]),e}(),kn=function(){function e(){Object(ue.a)(this,e),this.actions=void 0,this.actions={loadingGeometry:new Sn("Loading Geometry",this),parsingGeometry:new Sn("Parsing Geometry",this),loadingStyles:new Sn("Loading Styles",this),applyingStyles:new Sn("Applying Styles",this)}}return Object(fe.a)(e,[{key:"update",value:function(){var e=document.getElementById("viewStatusBar");if(e){for(var t in this.actions)if(this.actions[t].isRunning){var n=this.actions[t].toString();return void(e.innerHTML=n)}e.innerHTML="Ready."}}}]),e}(),Cn=function(){function e(t){Object(ue.a)(this,e),this.camera=void 0,this.camera=new ge.J(65,window.innerWidth/window.innerHeight,1,6e3)}return Object(fe.a)(e,[{key:"update",value:function(e){e.update()}},{key:"topView",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3;this.camera.position.copy(e.target),this.camera.position.z=t,this.camera.updateMatrixWorld()}},{key:"enable",value:function(e){e.enableRotate=!0,e.maxDistance=5e3}},{key:"resize",value:function(e,t){this.camera.aspect=e/t,this.camera.updateProjectionMatrix()}}]),e}(),Ln=function(){function e(t,n){Object(ue.a)(this,e),this.camera=void 0,this.csm=void 0,this.camera=new ge.H(-window.innerWidth/2,window.innerWidth/2,window.innerHeight/2,-window.innerHeight/2,1,1e4),this.csm=n}return Object(fe.a)(e,[{key:"update",value:function(e){var t=e.target.distanceTo(e.object.position),n=e.object.aspect;this.camera.left=t*n/-2,this.camera.right=t*n/2,this.camera.top=t/2,this.camera.bottom=t/-2,this.camera.position.copy(e.object.position),this.camera.updateProjectionMatrix(),e.update(),this.csm.updateFrustums()}},{key:"enable",value:function(e){this.camera.position.copy(e.object.position),e.target.copy(this.camera.position),e.target.z=0,e.minDistance=50,e.maxDistance=1e4,e.enableRotate=!1}},{key:"topView",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3;this.camera.position.copy(e.target),this.camera.position.z=t,this.camera.updateMatrixWorld()}},{key:"resize",value:function(e,t){this.camera.left=-e/2,this.camera.right=e/2,this.camera.top=t/2,this.camera.bottom=-t/2,this.camera.updateProjectionMatrix()}}]),e}(),Mn=function(){function e(t){Object(ue.a)(this,e),this.controls=void 0,this.perspective=void 0,this.orthographic=void 0,this.current=void 0,this.csm=void 0,this.perspective=new Cn(t),this.controls=new _e(this.perspective.camera,t),this.current=this.perspective,this.current.enable(this.controls)}return Object(fe.a)(e,[{key:"initOrthographic",value:function(e,t){this.orthographic=new Ln(e,t),this.csm=t}},{key:"resize",value:function(e,t){this.perspective.resize(e,t),this.orthographic&&this.orthographic.resize(e,t)}},{key:"zoomIn",value:function(e){var t=this.controls.object.position.clone(),n=(new ge.X).subVectors(t,this.controls.target);n.normalize(),n.multiplyScalar(10*e),this.controls.object.position.sub(n),this.controls.object.updateProjectionMatrix(),this.current.update(this.controls)}},{key:"zoomOut",value:function(e){var t=this.controls.object.position.clone(),n=(new ge.X).subVectors(t,this.controls.target);n.normalize(),n.multiplyScalar(10*e),this.controls.object.position.add(n),this.controls.object.updateProjectionMatrix(),this.current.update(this.controls)}},{key:"update",value:function(){this.current.update(this.controls)}},{key:"enable",value:function(){this.current.enable(this.controls)}},{key:"topView",value:function(){if(this.current.camera.isOrthographicCamera)this.current.topView(this.controls);else{var e=this.controls.target.distanceTo(this.controls.object.position);this.current.topView(this.controls,e)}}},{key:"camera",get:function(){return this.current.camera}},{key:"target",get:function(){return this.controls.target}},{key:"useOrtho",value:function(){this.orthographic&&this.current!==this.orthographic&&this.swap()}},{key:"usePerspective",value:function(){this.current!==this.perspective&&this.swap()}},{key:"swap",value:function(){this.orthographic&&this.csm&&(this.current.topView(this.controls),this.current=this.current===this.perspective?this.orthographic:this.perspective,this.current.enable(this.controls),this.csm.camera=this.current.camera,this.csm.updateFrustums())}},{key:"focus",value:function(e){var t=this.current.camera.isOrthographicCamera;t&&this.swap(),this.controls.target=new ge.X(e.x,e.y,0),this.perspective.camera.position.x=e.x,this.perspective.camera.position.y=e.y,this.perspective.camera.position.z=1e3,t&&this.swap()}},{key:"screenToWorldOrthographic",value:function(e,t){if(this.current.camera.isOrthographicCamera){var n=this.current.camera,i=new ge.X;return i.set(e/window.innerWidth*2-1,-t/window.innerHeight*2+1,(n.near+n.far)/(n.near-n.far)),i.unproject(n)}}}]),e}(),Dn=function(){function e(t){Object(ue.a)(this,e),this.renderer=void 0,this.camDirection3=void 0,this.camDirection2=void 0,this.north=void 0,this.angle=void 0,this.renderer=t,this.camDirection3=new ge.X(0,0,0),this.camDirection2=new ge.W(0,0),this.north=new ge.W(0,1),this.angle=0}return Object(fe.a)(e,[{key:"update",value:function(e){this.camDirection3.copy(this.renderer.controls.target),this.camDirection3.sub(this.renderer.controls.camera.position),this.camDirection3.normalize(),this.camDirection2.set(this.camDirection3.x,this.camDirection3.y),1===this.renderer.controls.camera.up.y?this.angle=0:(this.camDirection2.normalize(),this.angle=Math.acos(this.north.dot(this.camDirection2)),this.camDirection2.x<0&&(this.angle=-this.angle)),e&&e(this.angle)}}]),e}(),Nn=new ge.B,In=function(){function e(t){Object(ue.a)(this,e),t=t||{},this.vertices={near:[new ge.X,new ge.X,new ge.X,new ge.X],far:[new ge.X,new ge.X,new ge.X,new ge.X]},void 0!==t.projectionMatrix&&this.setFromProjectionMatrix(t.projectionMatrix,t.maxFar||1e4)}return Object(fe.a)(e,[{key:"setFromProjectionMatrix",value:function(e,t){var n=0===e.elements[11];return Nn.copy(e).invert(),this.vertices.near[0].set(1,1,-1),this.vertices.near[1].set(1,-1,-1),this.vertices.near[2].set(-1,-1,-1),this.vertices.near[3].set(-1,1,-1),this.vertices.near.forEach((function(e){e.applyMatrix4(Nn)})),this.vertices.far[0].set(1,1,1),this.vertices.far[1].set(1,-1,1),this.vertices.far[2].set(-1,-1,1),this.vertices.far[3].set(-1,1,1),this.vertices.far.forEach((function(e){e.applyMatrix4(Nn);var i=Math.abs(e.z);n?e.z*=Math.min(t/i,1):e.multiplyScalar(Math.min(t/i,1))})),this.vertices}},{key:"split",value:function(t,n){for(;t.length>n.length;)n.push(new e);n.length=t.length;for(var i=0;i<t.length;i++){var a=n[i];if(0===i)for(var r=0;r<4;r++)a.vertices.near[r].copy(this.vertices.near[r]);else for(var s=0;s<4;s++)a.vertices.near[s].lerpVectors(this.vertices.near[s],this.vertices.far[s],t[i-1]);if(i===t.length-1)for(var o=0;o<4;o++)a.vertices.far[o].copy(this.vertices.far[o]);else for(var c=0;c<4;c++)a.vertices.far[c].lerpVectors(this.vertices.near[c],this.vertices.far[c],t[i])}}},{key:"toSpace",value:function(e,t){for(var n=0;n<4;n++)t.vertices.near[n].copy(this.vertices.near[n]).applyMatrix4(e),t.vertices.far[n].copy(this.vertices.far[n]).applyMatrix4(e)}}]),e}(),En={lights_fragment_begin:"\nGeometricContext geometry;\n\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n\n#ifdef CLEARCOAT\n\n\tgeometry.clearcoatNormal = clearcoatNormal;\n\n#endif\n\nIncidentLight directLight;\n\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n\t\tpointLight = pointLights[ i ];\n\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n\t\tspotLight = spotLights[ i ];\n\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_DIR_LIGHTS > 0) && defined( RE_Direct ) && defined( USE_CSM ) && defined( CSM_CASCADES )\n\n\tDirectionalLight directionalLight;\n\tfloat linearDepth = (vViewPosition.z) / (shadowFar - cameraNear);\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\n\t#if defined( USE_SHADOWMAP ) && defined( CSM_FADE )\n\tvec2 cascade;\n\tfloat cascadeCenter;\n\tfloat closestEdge;\n\tfloat margin;\n\tfloat csmx;\n\tfloat csmy;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\n\t\t// NOTE: Depth gets larger away from the camera.\n\t\t// cascade.x is closer, cascade.y is further\n\t\tcascade = CSM_cascades[ i ];\n\t\tcascadeCenter = ( cascade.x + cascade.y ) / 2.0;\n\t\tclosestEdge = linearDepth < cascadeCenter ? cascade.x : cascade.y;\n\t\tmargin = 0.25 * pow( closestEdge, 2.0 );\n\t\tcsmx = cascade.x - margin / 2.0;\n\t\tcsmy = cascade.y + margin / 2.0;\n\t\tif( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS && linearDepth >= csmx && ( linearDepth < csmy || UNROLLED_LOOP_INDEX == CSM_CASCADES - 1 ) ) {\n\n\t\t\tfloat dist = min( linearDepth - csmx, csmy - linearDepth );\n\t\t\tfloat ratio = clamp( dist / margin, 0.0, 1.0 );\n\t\t\tif( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS ) {\n\n\t\t\t\tvec3 prevColor = directLight.color;\n\t\t\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\t\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\n\t\t\t\tbool shouldFadeLastCascade = UNROLLED_LOOP_INDEX == CSM_CASCADES - 1 && linearDepth > cascadeCenter;\n\t\t\t\tdirectLight.color = mix( prevColor, directLight.color, shouldFadeLastCascade ? ratio : 1.0 );\n\n\t\t\t}\n\n\t\t\tReflectedLight prevLight = reflectedLight;\n\t\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t\t\tbool shouldBlend = UNROLLED_LOOP_INDEX != CSM_CASCADES - 1 || UNROLLED_LOOP_INDEX == CSM_CASCADES - 1 && linearDepth < cascadeCenter;\n\t\t\tfloat blendRatio = shouldBlend ? ratio : 1.0;\n\n\t\t\treflectedLight.directDiffuse = mix( prevLight.directDiffuse, reflectedLight.directDiffuse, blendRatio );\n\t\t\treflectedLight.directSpecular = mix( prevLight.directSpecular, reflectedLight.directSpecular, blendRatio );\n\t\t\treflectedLight.indirectDiffuse = mix( prevLight.indirectDiffuse, reflectedLight.indirectDiffuse, blendRatio );\n\t\t\treflectedLight.indirectSpecular = mix( prevLight.indirectSpecular, reflectedLight.indirectSpecular, blendRatio );\n\n\t\t}\n\n\t}\n\t#pragma unroll_loop_end\n\t#else\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tif(linearDepth >= CSM_cascades[UNROLLED_LOOP_INDEX].x && linearDepth < CSM_cascades[UNROLLED_LOOP_INDEX].y) directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\n\t\t#endif\n\n\t\tif(linearDepth >= CSM_cascades[UNROLLED_LOOP_INDEX].x && (linearDepth < CSM_cascades[UNROLLED_LOOP_INDEX].y || UNROLLED_LOOP_INDEX == CSM_CASCADES - 1)) RE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n#endif\n\n\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct ) && !defined( USE_CSM ) && !defined( CSM_CASCADES )\n\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tdirectionalLight = directionalLights[ i ];\n\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\n\tRectAreaLight rectAreaLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if defined( RE_IndirectDiffuse )\n\n\tvec3 iblIrradiance = vec3( 0.0 );\n\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\n\t\t}\n\t\t#pragma unroll_loop_end\n\n\t#endif\n\n#endif\n\n#if defined( RE_IndirectSpecular )\n\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n\n#endif\n",lights_pars_begin:"\n#if defined( USE_CSM ) && defined( CSM_CASCADES )\nuniform vec2 CSM_cascades[CSM_CASCADES];\nuniform float cameraNear;\nuniform float shadowFar;\n#endif\n\t"+ge.Q.lights_pars_begin},zn=new ge.B,Pn=new In,Tn=new ge.X,An=new ge.b,Rn=[],Fn=[],Un=function(){function e(t){Object(ue.a)(this,e),t=t||{},this.camera=t.camera,this.parent=t.parent,this.cascades=t.cascades||3,this.maxFar=t.maxFar||1e5,this.mode=t.mode||"practical",this.shadowMapSize=t.shadowMapSize||2048,this.shadowBias=[];for(var n=0;n<this.cascades;++n)this.shadowBias.push(t.shadowBias?t.shadowBias[n]:1e-6);this.lightDirection=t.lightDirection||new ge.X(1,-1,1).normalize(),this.lightIntensity=t.lightIntensity||1,this.lightNear=t.lightNear||1,this.lightFar=t.lightFar||2e3,this.lightMargin=t.lightMargin||200,this.customSplitsCallback=t.customSplitsCallback,this.fade=!1,this.mainFrustum=new In,this.frustums=[],this.breaks=[],this.lights=[],this.shaders=new Map,this.createLights(),this.updateFrustums(),this.injectInclude()}return Object(fe.a)(e,[{key:"createLights",value:function(){for(var e=0;e<this.cascades;e++){var t=new ge.i(16777215,this.lightIntensity);t.castShadow=!0,t.shadow.mapSize.width=this.shadowMapSize,t.shadow.mapSize.height=this.shadowMapSize,t.shadow.camera.near=this.lightNear,t.shadow.camera.far=this.lightFar,t.shadow.bias=this.shadowBias[e],this.parent.add(t),this.parent.add(t.target),this.lights.push(t)}}},{key:"initCascades",value:function(){var e=this.camera;e.updateProjectionMatrix(),this.mainFrustum.setFromProjectionMatrix(e.projectionMatrix,this.maxFar),this.mainFrustum.split(this.breaks,this.frustums)}},{key:"updateShadowBounds",value:function(){for(var e=this.frustums,t=0;t<e.length;t++){var n=this.lights[t].shadow.camera,i=this.frustums[t],a=i.vertices.near,r=i.vertices.far,s=r[0],o=void 0;o=s.distanceTo(r[2])>s.distanceTo(a[2])?r[2]:a[2];var c=s.distanceTo(o);if(this.fade){var l=this.camera,d=Math.max(l.far,this.maxFar),h=i.vertices.far[0].z/(d-l.near);c+=.25*Math.pow(h,2)*(d-l.near)}n.left=-c/2,n.right=c/2,n.top=c/2,n.bottom=-c/2,n.updateProjectionMatrix()}}},{key:"getBreaks",value:function(){var e=this.camera,t=Math.min(e.far,this.maxFar);switch(this.breaks.length=0,this.mode){case"uniform":n(this.cascades,e.near,t,this.breaks);break;case"logarithmic":i(this.cascades,e.near,t,this.breaks);break;case"practical":!function(e,t,a,r,s){Rn.length=0,Fn.length=0,i(e,t,a,Fn),n(e,t,a,Rn);for(var o=1;o<e;o++)s.push(ge.A.lerp(Rn[o-1],Fn[o-1],r));s.push(1)}(this.cascades,e.near,t,.8,this.breaks);break;case"custom":void 0===this.customSplitsCallback&&console.error("CSM: Custom split scheme callback not defined."),this.customSplitsCallback(this.cascades,e.near,t,this.breaks)}function n(e,t,n,i){for(var a=1;a<e;a++)i.push((t+(n-t)*a/e)/n);i.push(1)}function i(e,t,n,i){for(var a=1;a<e;a++)i.push(t*Math.pow(n/t,a/e)/n);i.push(1)}}},{key:"update",value:function(){for(var e=this.camera,t=this.frustums,n=0;n<t.length;n++){var i=this.lights[n],a=i.shadow.camera,r=(a.right-a.left)/this.shadowMapSize,s=(a.top-a.bottom)/this.shadowMapSize;i.shadow.camera.updateMatrixWorld(!0),zn.multiplyMatrices(i.shadow.camera.matrixWorldInverse,e.matrixWorld),t[n].toSpace(zn,Pn);var o=Pn.vertices.near,c=Pn.vertices.far;An.makeEmpty();for(var l=0;l<4;l++)An.expandByPoint(o[l]),An.expandByPoint(c[l]);An.getCenter(Tn),Tn.z=An.max.z+this.lightMargin,Tn.x=Math.floor(Tn.x/r)*r,Tn.y=Math.floor(Tn.y/s)*s,Tn.applyMatrix4(i.shadow.camera.matrixWorld),i.position.copy(Tn),i.target.position.copy(Tn),i.target.position.x+=this.lightDirection.x,i.target.position.y+=this.lightDirection.y,i.target.position.z+=this.lightDirection.z}}},{key:"injectInclude",value:function(){ge.Q.lights_fragment_begin=En.lights_fragment_begin,ge.Q.lights_pars_begin=En.lights_pars_begin}},{key:"setupMaterial",value:function(e){e.defines=e.defines||{},e.defines.USE_CSM=1,e.defines.CSM_CASCADES=this.cascades,this.fade&&(e.defines.CSM_FADE="");var t=[],n=this,i=this.shaders;e.onBeforeCompile=function(a){var r=Math.min(n.camera.far,n.maxFar);n.getExtendedBreaks(t),a.uniforms.CSM_cascades={value:t},a.uniforms.cameraNear={value:n.camera.near},a.uniforms.shadowFar={value:r},i.set(e,a)},i.set(e,null)}},{key:"updateUniforms",value:function(){var e=Math.min(this.camera.far,this.maxFar);this.shaders.forEach((function(t,n){if(null!==t){var i=t.uniforms;this.getExtendedBreaks(i.CSM_cascades.value),i.cameraNear.value=this.camera.near,i.shadowFar.value=e}!this.fade&&"CSM_FADE"in n.defines?(delete n.defines.CSM_FADE,n.needsUpdate=!0):this.fade&&!("CSM_FADE"in n.defines)&&(n.defines.CSM_FADE="",n.needsUpdate=!0)}),this)}},{key:"getExtendedBreaks",value:function(e){for(;e.length<this.breaks.length;)e.push(new ge.W);e.length=this.breaks.length;for(var t=0;t<this.cascades;t++){var n=this.breaks[t],i=this.breaks[t-1]||0;e[t].x=i,e[t].y=n}}},{key:"updateFrustums",value:function(){this.getBreaks(),this.initCascades(),this.updateShadowBounds(),this.updateUniforms()}},{key:"remove",value:function(){for(var e=0;e<this.lights.length;e++)this.parent.remove(this.lights[e])}},{key:"dispose",value:function(){var e=this.shaders;e.forEach((function(e,t){delete t.onBeforeCompile,delete t.defines.USE_CSM,delete t.defines.CSM_CASCADES,delete t.defines.CSM_FADE,null!==e&&(delete e.uniforms.CSM_cascades,delete e.uniforms.cameraNear,delete e.uniforms.shadowFar),t.needsUpdate=!0})),e.clear()}}]),e}(),Bn=function(e){Object(xe.a)(n,e);var t=Object(Oe.a)(n);function n(e){var i;Object(ue.a)(this,n),(i=t.call(this)).csm=e,i.displayFrustum=!0,i.displayPlanes=!0,i.displayShadowBounds=!0;var a=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),s=new ge.f;s.setIndex(new ge.e(a,1)),s.setAttribute("position",new ge.e(r,3,!1));var o=new ge.v(s,new ge.u);return i.add(o),i.frustumLines=o,i.cascadeLines=[],i.cascadePlanes=[],i.shadowLines=[],i}return Object(fe.a)(n,[{key:"updateVisibility",value:function(){for(var e=this.displayFrustum,t=this.displayPlanes,n=this.displayShadowBounds,i=this.frustumLines,a=this.cascadeLines,r=this.cascadePlanes,s=this.shadowLines,o=0,c=a.length;o<c;o++){var l=a[o],d=r[o],h=s[o];l.visible=e,d.visible=e&&t,h.visible=n}i.visible=e}},{key:"update",value:function(){var e=this.csm,t=e.camera,n=e.cascades,i=e.mainFrustum,a=e.frustums,r=e.lights,s=this.frustumLines.geometry.getAttribute("position"),o=this.cascadeLines,c=this.cascadePlanes,l=this.shadowLines;for(this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.updateMatrixWorld(!0);o.length>n;)this.remove(o.pop()),this.remove(c.pop()),this.remove(l.pop());for(;o.length<n;){var d=new ge.c(new ge.b,0),h=new ge.D({color:0,transparent:!0,opacity:.1,depthWrite:!1,side:ge.j}),u=new ge.C(new ge.K,h),f=new ge.n,m=new ge.c(new ge.b,16711680);f.add(m),this.add(d),this.add(u),this.add(f),o.push(d),c.push(u),l.push(f)}for(var p=0;p<n;p++){var v=a[p],g=r[p].shadow.camera,b=v.vertices.far,j=o[p],y=c[p],x=l[p],O=x.children[0];j.box.min.copy(b[2]),j.box.max.copy(b[0]),j.box.max.z+=1e-4,y.position.addVectors(b[0],b[2]),y.position.multiplyScalar(.5),y.scale.subVectors(b[0],b[2]),y.scale.z=1e-4,this.remove(x),x.position.copy(g.position),x.quaternion.copy(g.quaternion),x.scale.copy(g.scale),x.updateMatrixWorld(!0),this.attach(x),O.box.min.set(g.bottom,g.left,-g.far),O.box.max.set(g.top,g.right,-g.near)}var _=i.vertices.near,w=i.vertices.far;s.setXYZ(0,w[0].x,w[0].y,w[0].z),s.setXYZ(1,w[3].x,w[3].y,w[3].z),s.setXYZ(2,w[2].x,w[2].y,w[2].z),s.setXYZ(3,w[1].x,w[1].y,w[1].z),s.setXYZ(4,_[0].x,_[0].y,_[0].z),s.setXYZ(5,_[3].x,_[3].y,_[3].z),s.setXYZ(6,_[2].x,_[2].y,_[2].z),s.setXYZ(7,_[1].x,_[1].y,_[1].z),s.needsUpdate=!0}}]),n}(ge.n),Vn=function(){function e(t){Object(ue.a)(this,e),this.pickingTexture=void 0,this.pixelBuffer=void 0,this.renderer=void 0,this.selected=void 0,this.id=void 0,this.offsets=void 0,this.maxOffest=void 0,this.pickingTexture=new ge.Y(1,1),this.pixelBuffer=new Uint8Array(4),this.renderer=t,this.selected=[-1,-1,-1,-1],this.id=-1,this.offsets=new Map,this.maxOffest=0}return Object(fe.a)(e,[{key:"offsetForLayer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;if(!this.offsets.has(e)){if(-1===t)throw new Error("Layer ".concat(e," not registered."));this.offsets.set(e,[this.maxOffest,this.maxOffest+t]),this.maxOffest+=t}var n=this.offsets.get(e);return n[0]}},{key:"layerAndOidForId",value:function(e){var t,n=Object(Ft.a)(this.offsets.entries());try{for(n.s();!(t=n.n()).done;){var i=Object(u.a)(t.value,2),a=i[0],r=i[1];if(e>=r[0]&&e<r[1])return{layer:a,oid:e-r[0]}}}catch(s){n.e(s)}finally{n.f()}}},{key:"select",value:function(e){this.id=e;var t=new Uint32Array([e]),n=new DataView(t.buffer);this.selected=[n.getUint8(0)/255,n.getUint8(1)/255,n.getUint8(2)/255,n.getUint8(3)/255]}},{key:"pick",value:function(e,t,n,i){var a=this.pickingTexture,r=this.pixelBuffer,s=this.renderer.getPixelRatio();return i.setViewOffset(this.renderer.getContext().drawingBufferWidth,this.renderer.getContext().drawingBufferHeight,e*s|0,t*s|0,1,1),this.renderer.setRenderTarget(a),this.renderer.render(n,i),this.renderer.setRenderTarget(null),i.clearViewOffset(),this.renderer.readRenderTargetPixels(a,0,0,1,1,r),this.selected=[r[0]/255,r[1]/255,r[2]/255,r[3]/255],this.id=new DataView(r.buffer).getUint32(0,!0),this.id}}]),e}();var Gn=function(){function e(t){Object(ue.a)(this,e),this.placeholders=void 0,this.visibilityMap=void 0,this.renderer=void 0,this.renderer=t,this.placeholders=new Map,this.visibilityMap=new Map}return Object(fe.a)(e,[{key:"genPlaceholder",value:function(e,t){var n=new ge.K(1e3,1e3),i=function(){for(var e="89ABCDEF",t="",n=Math.floor(7*Math.random()),i=Math.floor(7*Math.random()),a=0;a<3;a++)t+=e[n],t+=e[i];return t}(),a=new ge.D({color:parseInt(i,16),opacity:.1,transparent:!0}),r=new ge.C(n,a);return r.position.set(1e3*e+500,1e3*t+500,0),r.visible=!0,r}},{key:"addPlaceholder",value:function(e,t){var n=Xt(e,t);if(void 0===this.placeholders.get(n)){var i=this.genPlaceholder(e,t);this.placeholders.set(n,i),this.renderer.scene.add(i)}}},{key:"hidePlaceholder",value:function(e,t){var n=Xt(e,t),i=this.visibilityMap.get(n);void 0===i&&(i=0),this.visibilityMap.set(n,i+1),i>=0&&(this.placeholders.get(n).visible=!1)}},{key:"showPlaceholder",value:function(e,t){var n=Xt(e,t),i=this.visibilityMap.get(n);void 0!==i&&(this.visibilityMap.set(n,i-1),i-1===0&&(this.placeholders.get(n).visible=!0))}}]),e}(),Hn=function(){function e(t){Object(ue.a)(this,e),this.renderer=void 0,this.cube=void 0,this.ends=void 0,this.region=void 0,this.renderer=t;var n=new ge.d(1,1,1),i=new ge.D({color:65280,transparent:!0,opacity:.5});this.cube=new ge.C(n,i),this.renderer.scene.add(this.cube),this.ends=[],this.cube.visible=!1}return Object(fe.a)(e,[{key:"select",value:function(e,t){var n=this.renderer.controls.screenToWorldOrthographic(e,t);if(n)return this.ends.push(new ge.W(n.x,n.y)),this.cube.visible=!0,this.renderer.changed=!0,this.ends.length<2?this.initCube(n):this.transformCube()}},{key:"transformCube",value:function(){var e=this.ends.pop(),t=this.ends[0].clone(),n=new ge.W(e.x,e.y);n.min(t),e.max(t),t.copy(e).sub(n),this.cube.scale.set(t.x,t.y,1),this.cube.position.set(n.x+.5*t.x,n.y+.5*t.y,this.renderer.controls.camera.position.z-10),this.cube.updateMatrixWorld(),this.region={start:[n.x,n.y],end:[e.x,e.y],size:[t.x,t.y]}}},{key:"initCube",value:function(e){this.cube.position.x=e.x,this.cube.position.y=e.y,this.cube.position.z=0,this.cube.scale.set(1,1,1),this.cube.updateMatrixWorld()}},{key:"clear",value:function(){this.ends=[],this.cube.visible=!1,this.renderer.changed=!0,this.region=void 0}}]),e}();var Wn=function(){function e(t){Object(ue.a)(this,e),this.polygonMaterial=void 0,this.pointMaterial=void 0,this.lineMaterial=void 0,this.agentMaterial=void 0,this.pickingPolygonMaterial=void 0,this.pickingLineMaterial=void 0,this.pickingPointMaterial=void 0,this.pickingAgentMaterial=void 0,this.polygonMaterial=function(){var e=ge.V.merge([ge.R.phong.uniforms,{selectedID:{value:[-1,-1,-1,-1]}}]);return new ge.S({uniforms:e,vertexShader:"\n#define PHONG\n\nvarying vec3 vViewPosition;\n\nuniform vec4 selectedID;\n\nattribute vec4 objectID;\nattribute vec3 color;\nvarying float varyingObjectID;\nvarying vec3 colorFrag;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n    int marked = 1;\n\n    for(int i = 0; i < 4; ++i)\n        marked *= int(floor(selectedID[i] * 255.0 + 0.5) == floor(objectID[i] * 255.0 + 0.5));\n\n    varyingObjectID = float(marked);\n\tcolorFrag = color;\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",fragmentShader:"\n#define PHONG\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n\nvarying float varyingObjectID;\nvarying vec3 colorFrag;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4(diffuse, opacity);\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = clamp(reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance, 0.75, 1.0) * colorFrag;\n\t\n\tif (varyingObjectID > 0.5) \n\t\toutgoingLight -= vec3(0.0, 0.6, 0.6); \n\n\n\t//outgoingLight -= vec3(0.8);\n\t//vec3 shade = outgoingLight;\n\t//const vec3 slices = vec3(10.0);\n\t//const vec3 slices_inv = vec3(1.0) / slices;\n\t//outgoingLight *= vec3(5.0);\n\t//outgoingLight *= slices;\n\t//outgoingLight = floor(outgoingLight + vec3(0.5));\n\t//outgoingLight *= slices_inv;\n\t//outgoingLight = pow(outgoingLight, vec3(0.4));\n\t//outgoingLight *= vec3(0.3);\n\t//outgoingLight += vec3(0.7);\n\n\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",lights:!0,side:ge.j,name:"custom-polygon-material"})}(),t.setupMaterial(this.polygonMaterial),this.lineMaterial=function(){var e=ge.V.merge([{zoffset:{value:1}},{thickness:{value:1}},{selectedID:{value:[-1,-1,-1,-1]}}]);return new ge.S({uniforms:e,vertexShader:"\n#define PHONG\n\nvarying vec3 vViewPosition;\n\nattribute vec3 lineStart;\nattribute vec3 lineEnd;\nattribute vec3 color;\nattribute vec4 objectID;\n\nuniform float zoffset;\nuniform vec4 selectedID;\nuniform float thickness;\n\nvarying float varyingObjectID;\nvarying vec3 colorFrag;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\n/**\n * Create rotation matrix from field vector.\n * The returned matrix can rotate vector (1, 0, 0)\n * into the desired setup.\n */\nmat4 getRotationMat(vec3 vector)\n{\n\tvec3 unit = vec3(1, 0, 0);\n\tvec3 f = normalize(vector);\n\tvec3 cross = cross(f, unit);\n\tvec3 a = normalize(cross);\n\tfloat s = length(cross);\n\tfloat c = dot(f, unit);\n\tfloat oc = 1.0 - c;\n\treturn mat4(oc * a.x * a.x + c,        oc * a.x * a.y - a.z * s,  oc * a.z * a.x + a.y * s,  0.0,\n                oc * a.x * a.y + a.z * s,  oc * a.y * a.y + c,        oc * a.y * a.z - a.x * s,  0.0,\n                oc * a.z * a.x - a.y * s,  oc * a.y * a.z + a.x * s,  oc * a.z * a.z + c,        0.0,\n                0.0,                       0.0,                       0.0,                       1.0);\n\n}\n\nvoid main() {\n    int marked = 1;\n\n    for(int i = 0; i < 4; ++i)\n        marked *= int(floor(selectedID[i] * 255.0 + 0.5) == floor(objectID[i] * 255.0 + 0.5));\n\n    varyingObjectID = float(marked);\n\tcolorFrag = color;\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\n\t#include <begin_vertex> //transformed contains location\n\n\tvec3 dir = lineEnd - lineStart;\n    float dist = length(dir);\n    mat4 rot = getRotationMat(dir);\n\n\tfloat end = float(transformed.x >= 0.9);\n\ttransformed.x = end * (dist + (transformed.x - 1.0) * thickness) + (1.0 - end) * transformed.x * thickness; //subtract one because its the original length of the template line\n\ttransformed.y *= thickness;\n\n    transformed = lineStart + (rot * vec4(transformed, 1.0)).xyz;\n\ttransformed.z += zoffset;\n\n\tif (varyingObjectID > 0.5)\n\t\ttransformed.z += zoffset;\n\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = -mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",fragmentShader:"\n#define PHONG\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n\nvarying float varyingObjectID;\nvarying vec3 colorFrag;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\t//vec4 diffuseColor = vec4(diffuse, opacity);\n\t//ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t//vec3 totalEmissiveRadiance = emissive;\n\n\t//#include <logdepthbuf_fragment>\n\t//#include <map_fragment>\n\t//#include <color_fragment>\n\t//#include <alphamap_fragment>\n\t//#include <alphatest_fragment>\n\t//#include <specularmap_fragment>\n\t//#include <normal_fragment_begin>\n\t//#include <normal_fragment_maps>\n\t//#include <emissivemap_fragment>\n\n\t// accumulation\n\t//#include <lights_phong_fragment>\n\t//#include <lights_fragment_begin>\n\t//#include <lights_fragment_maps>\n\t//#include <lights_fragment_end>\n\n\t// modulation\n\t//#include <aomap_fragment>\n\n\t//vec3 outgoingLight = clamp(reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance, 0.75, 1.0) * colorFrag;\n\tvec3 outgoingLight = colorFrag;\n\n\t\n\tif (varyingObjectID > 0.5) \n\t\toutgoingLight -= vec3(0.0, 0.6, 0.6); \n\n\n\t//#include <envmap_fragment>\n\t//#include <output_fragment>\n\t//the output is replaced by the segment bellow\n\tgl_FragColor = vec4( outgoingLight, 1.0 );\n\n\t//#include <tonemapping_fragment>\n\t//#include <encodings_fragment>\n\t//#include <fog_fragment>\n\t//#include <premultiplied_alpha_fragment>\n\t//#include <dithering_fragment>\n}\n",side:ge.j,name:"custom-line-material"})}(),this.pointMaterial=function(){var e=ge.V.merge([ge.R.phong.uniforms,{selectedID:{value:[-1,-1,-1,-1]}},{pointSize:{value:1}}]);return new ge.S({uniforms:e,vertexShader:"\n#define PHONG\n\nvarying vec3 vViewPosition;\n\nuniform vec4 selectedID;\nuniform float pointSize;\n\nattribute vec3 location;\nattribute vec4 objectID;\nattribute vec3 color;\n\nvarying float varyingObjectID;\nvarying vec3 colorFrag;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n    int marked = 1;\n\n    for(int i = 0; i < 4; ++i)\n        marked *= int(floor(selectedID[i] * 255.0 + 0.5) == floor(objectID[i] * 255.0 + 0.5));\n\n    varyingObjectID = float(marked);\n\tcolorFrag = color;\n\n\t//#include <uv_vertex>\n\t//#include <uv2_vertex>\n\t//#include <color_vertex>\n\n\t//#include <beginnormal_vertex>\n\t//#include <morphnormal_vertex>\n\t//#include <skinbase_vertex>\n\t//#include <skinnormal_vertex>\n\t//#include <defaultnormal_vertex>\n\t//#include <normal_vertex>\n\n\t#include <begin_vertex>\n\n\ttransformed *= pointSize;\n\ttransformed += location;\n\n\t//#include <morphtarget_vertex>\n\t//#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t//#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t//#include <envmap_vertex>\n\t//#include <shadowmap_vertex>\n\t//#include <fog_vertex>\n}\n",fragmentShader:"\n#define PHONG\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n\nvarying float varyingObjectID;\nvarying vec3 colorFrag;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\t//vec4 diffuseColor = vec4(diffuse, opacity);\n\t//ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t//vec3 totalEmissiveRadiance = emissive;\n\n\t//#include <logdepthbuf_fragment>\n\t//#include <map_fragment>\n\t//#include <color_fragment>\n\t//#include <alphamap_fragment>\n\t//#include <alphatest_fragment>\n\t//#include <specularmap_fragment>\n\t//#include <normal_fragment_begin>\n\t//#include <normal_fragment_maps>\n\t//#include <emissivemap_fragment>\n\n\t// accumulation\n\t//#include <lights_phong_fragment>\n\t//#include <lights_fragment_begin>\n\t//#include <lights_fragment_maps>\n\t//#include <lights_fragment_end>\n\n\t// modulation\n\t//#include <aomap_fragment>\n\n\t//vec3 outgoingLight = clamp(reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance, 0.75, 1.0) * colorFrag;\n\tvec3 outgoingLight = colorFrag;\n\n\t\n\tif (varyingObjectID > 0.5) \n\t\toutgoingLight -= vec3(0.0, 0.6, 0.6); \n\n\n\t//#include <envmap_fragment>\n\t//#include <output_fragment>\n\t//the output is replaced by the segment bellow\n\tgl_FragColor = vec4( outgoingLight, 1.0 );\n\n\t//#include <tonemapping_fragment>\n\t//#include <encodings_fragment>\n\t//#include <fog_fragment>\n\t//#include <premultiplied_alpha_fragment>\n\t//#include <dithering_fragment>\n}\n",lights:!0,side:ge.j,name:"custom-point-material"})}(),this.agentMaterial=function(){var e=ge.V.merge([{pointSize:{value:1}},{time:{value:0}},{time:{value:0}}]);return new ge.S({uniforms:e,vertexShader:"\nattribute vec4 objectID;\nattribute vec3 from;\nattribute float from_speed;\nattribute vec3 to;\nattribute float to_speed;\n\nvarying float varyingObjectID;\nvarying float speed;\nuniform float pointSize;\nuniform vec4 selectedID;\nuniform float time;\n\n\n/**\n * Create rotation matrix from field vector.\n * The returned matrix can rotate vector (1, 0, 0)\n * into the desired setup.\n */\nmat4 getRotationMat(vec3 vector)\n{\n\tvec3 unit = vec3(1, 0, 0);\n\tvec3 f = normalize(vector);\n\tvec3 cross = cross(f, unit);\n\tvec3 a = normalize(cross);\n\tfloat s = length(cross);\n\tfloat c = dot(f, unit);\n\tfloat oc = 1.0 - c;\n\treturn mat4(oc * a.x * a.x + c,        oc * a.x * a.y - a.z * s,  oc * a.z * a.x + a.y * s,  0.0,\n                oc * a.x * a.y + a.z * s,  oc * a.y * a.y + c,        oc * a.y * a.z - a.x * s,  0.0,\n                oc * a.z * a.x - a.y * s,  oc * a.y * a.z + a.x * s,  oc * a.z * a.z + c,        0.0,\n                0.0,                       0.0,                       0.0,                       1.0);\n\n}\n\nvoid main() {\n\tint marked = 1;\n\n    for(int i = 0; i < 4; ++i)\n        marked *= int(floor(selectedID[i] * 255.0 + 0.5) == floor(objectID[i] * 255.0 + 0.5));\n\n    varyingObjectID = float(marked);\n\n\n\tvec3 transformed = position;\n\t//vec3 dir = from - to;\n    //float dist = length(dir);\n    //if (dist > 0.01)\n\t//{\n\t//\tmat4 rot = getRotationMat(dir);\n\t//\ttransformed = (rot * vec4(transformed, 1.0)).xyz;\n\t//}\n\n\n    gl_Position = projectionMatrix * (modelViewMatrix * vec4( (pointSize * transformed) + from * (1.0 - time) + to * time, 1.0 ));\n\tspeed = clamp((from_speed * (1.0 - time) + to_speed * time) / 20.0, 0.0, 1.0);\n}\n",fragmentShader:"\nvarying float varyingObjectID;\nvarying float speed;\n\nvoid main() {\n\tvec3 color = vec3(1.0 - speed, speed, 0.0) * 0.7 + vec3(0.3, 0.3, 0.3);\n\tif (varyingObjectID > 0.5) \n\t\tcolor -= vec3(0.0, 0.6, 0.6); \n\n\tgl_FragColor = vec4(color, 1.0);\n}\n",side:ge.j,name:"custom-agent-picking-material"})}(),this.pickingPolygonMaterial=function(){var e=ge.V.merge([]);return new ge.S({uniforms:e,vertexShader:"\nattribute vec4 objectID;\nvarying vec4 objectIDColor;\n\nvoid main() {\n    objectIDColor = objectID;\n    gl_Position = projectionMatrix * (modelViewMatrix * vec4( position, 1.0 ));\n}\n",fragmentShader:"\nvarying vec4 objectIDColor;\n\nvoid main() {\n\tgl_FragColor = vec4(objectIDColor);\n}\n",side:ge.j,name:"custom-picking-material"})}(),this.pickingLineMaterial=function(){var e=ge.V.merge([{zoffset:{value:1}},{thickness:{value:5}}]);return new ge.S({uniforms:e,vertexShader:"\nattribute vec4 objectID;\nattribute vec3 lineStart;\nattribute vec3 lineEnd;\n\nuniform float zoffset;\nuniform float thickness;\n\nvarying vec4 objectIDColor;\n\n\n/**\n * Create rotation matrix from field vector.\n * The returned matrix can rotate vector (1, 0, 0)\n * into the desired setup.\n */\nmat4 getRotationMat(vec3 vector)\n{\n\tvec3 unit = vec3(1, 0, 0);\n\tvec3 f = normalize(vector);\n\tvec3 cross = cross(f, unit);\n\tvec3 a = normalize(cross);\n\tfloat s = length(cross);\n\tfloat c = dot(f, unit);\n\tfloat oc = 1.0 - c;\n\treturn mat4(oc * a.x * a.x + c,        oc * a.x * a.y - a.z * s,  oc * a.z * a.x + a.y * s,  0.0,\n                oc * a.x * a.y + a.z * s,  oc * a.y * a.y + c,        oc * a.y * a.z - a.x * s,  0.0,\n                oc * a.z * a.x - a.y * s,  oc * a.y * a.z + a.x * s,  oc * a.z * a.z + c,        0.0,\n                0.0,                       0.0,                       0.0,                       1.0);\n\n}\n\n\nvoid main() {\n    objectIDColor = objectID;\n\n\tvec3 transformed = position;\n\tvec3 dir = lineEnd - lineStart;\n    float dist = length(dir);\n    mat4 rot = getRotationMat(dir);\n\n\tfloat end = float(transformed.x >= 0.9);\n\ttransformed.x = end * (dist + (transformed.x - 1.0) * thickness) + (1.0 - end) * transformed.x * thickness; //subtract one because its the original length of the template line\n\ttransformed.y *= thickness;\n\n    transformed = lineStart + (rot * vec4(transformed, 1.0)).xyz;\n\ttransformed.z += zoffset;\n\n    gl_Position = projectionMatrix * (modelViewMatrix * vec4( transformed, 1.0 ));\n}\n",fragmentShader:"\nvarying vec4 objectIDColor;\n\nvoid main() {\n\tgl_FragColor = vec4(objectIDColor);\n}\n",side:ge.j,name:"custom-point-picking-material"})}(),this.pickingPointMaterial=function(){var e=ge.V.merge([{pointSize:{value:1}}]);return new ge.S({uniforms:e,vertexShader:"\nattribute vec4 objectID;\nattribute vec3 location;\nvarying vec4 objectIDColor;\n\nuniform float pointSize;\nuniform vec4 selectedID;\n\nvoid main() {\n    objectIDColor = objectID;\n    gl_Position = projectionMatrix * (modelViewMatrix * vec4( (pointSize * position) + location, 1.0 ));\n}\n",fragmentShader:"\nvarying vec4 objectIDColor;\n\nvoid main() {\n\tgl_FragColor = vec4(objectIDColor);\n}\n",side:ge.j,name:"custom-point-picking-material"})}(),this.pickingAgentMaterial=function(){var e=ge.V.merge([{pointSize:{value:1}},{time:{value:0}}]);return new ge.S({uniforms:e,vertexShader:"\nattribute vec4 objectID;\nattribute vec3 from;\nattribute vec3 to;\nvarying vec4 objectIDColor;\nuniform float pointSize;\nuniform float time;\n\nvoid main() {\n\tobjectIDColor = objectID;\n    gl_Position = projectionMatrix * (modelViewMatrix * vec4( (pointSize * position) + from * (1.0 - time) + to * time, 1.0 ));\n}\n",fragmentShader:"\nvarying vec4 objectIDColor;\n\nvoid main() {\n\tgl_FragColor = vec4(objectIDColor);\n}\n",side:ge.j,name:"custom-agent-picking-material"})}()}return Object(fe.a)(e,[{key:"setPointSize",value:function(e){this.pointMaterial.uniforms.pointSize.value=e,this.pointMaterial.uniformsNeedUpdate=!0,this.pickingPointMaterial.uniforms.pointSize.value=e,this.pickingPointMaterial.uniformsNeedUpdate=!0,this.agentMaterial.uniforms.pointSize.value=e,this.agentMaterial.uniformsNeedUpdate=!0,this.pickingAgentMaterial.uniforms.pointSize.value=e,this.pickingAgentMaterial.uniformsNeedUpdate=!0}},{key:"setLineWidth",value:function(e){this.lineMaterial.uniforms.thickness={value:e},this.lineMaterial.uniformsNeedUpdate=!0,this.pickingLineMaterial.uniforms.thickness={value:Math.max(e,5)},this.pickingLineMaterial.uniformsNeedUpdate=!0}},{key:"setSelectedID",value:function(e){this.polygonMaterial.uniforms.selectedID={value:e},this.polygonMaterial.uniformsNeedUpdate=!0,this.lineMaterial.uniforms.selectedID={value:e},this.lineMaterial.uniformsNeedUpdate=!0,this.pointMaterial.uniforms.selectedID={value:e},this.pointMaterial.uniformsNeedUpdate=!0,this.pointMaterial.uniforms.selectedID={value:e},this.pointMaterial.uniformsNeedUpdate=!0}},{key:"setTime",value:function(e){this.pickingAgentMaterial.uniforms.time={value:e-Math.floor(e)},this.pickingAgentMaterial.uniformsNeedUpdate=!0,this.agentMaterial.uniforms.time={value:e-Math.floor(e)},this.agentMaterial.uniformsNeedUpdate=!0}}]),e}(),Xn=function(){function e(t,n){Object(ue.a)(this,e),this.canvas=void 0,this.scene=void 0,this.pickingScene=void 0,this.renderer=void 0,this.controls=void 0,this.picker=void 0,this.matlib=void 0,this.csm=void 0,this.helper=void 0,this.compas=void 0,this.stats1=void 0,this.stats2=void 0,this.changed=void 0,this.updateShadows=!1,this.actionCall=void 0,this.status=void 0,this.timeline=void 0,this.selector=void 0,this.placeholders=void 0,this.canvas=t,this.actionCall=n,this.status=new kn,this.scene=new ge.P,this.pickingScene=new ge.P,this.controls=new Mn(this.canvas),this.renderer=new ge.Z({canvas:this.canvas,antialias:!0}),this.setupRenderer(),this.setupLightsAndShadows(),this.controls.initOrthographic(this.canvas,this.csm),this.controls.useOrtho(),this.compas=new Dn(this),this.matlib=new Wn(this.csm),this.picker=new Vn(this.renderer),this.changed=!0,this.timeline=new wn(this),this.selector=new Hn(this),this.placeholders=new Gn(this)}return Object(fe.a)(e,[{key:"setupLightsAndShadows",value:function(){var e=new ge.o(16777215,5592405,.4);e.position.set(0,1,1),this.scene.add(e),this.scene.add(new ge.a(16777215,.5)),this.csm=new Un({fade:!0,mode:"practical",cascades:4,shadowBias:[-5e-4,-.001,-.001,-.003],shadowMapSize:2048,lightDirection:new ge.X(-1,-1,-1).normalize(),camera:this.controls.camera,parent:this.scene,lightNear:1,lightFar:1e4,maxFar:5e3,margin:0,lightIntensity:.2,autoUpdateHelper:!1}),this.helper=new Bn(this.csm),this.helper.visible=!0,this.scene.add(this.helper),this.helper.update()}},{key:"setupRenderer",value:function(){var e=this;this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.autoUpdate=!1,this.renderer.shadowMap.type=ge.I,this.renderer.setClearColor(1382688),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setAnimationLoop((function(){return e.frame()}))}},{key:"enableShadows",value:function(){this.updateShadows=!0,this.changed=!0,console.log("shadows enabled")}},{key:"disableShadows",value:function(){var e;this.updateShadows=!1,this.changed=!0;var t,n=Object(Ft.a)(this.csm.lights);try{for(n.s();!(t=n.n()).done;){e=t.value;var i=this.renderer.getRenderTarget();e.shadow&&e.shadow.map&&(this.renderer.setRenderTarget(e.shadow.map),this.renderer.clear()),this.renderer.setRenderTarget(i)}}catch(a){n.e(a)}finally{n.f()}console.log("shadows disabled")}},{key:"frame",value:function(){this.actionCall(),this.timeline.tick(),this.controls.update(),this.changed&&(this.csm.update(),this.updateShadows&&(this.renderer.shadowMap.needsUpdate=!0),this.renderer.render(this.scene,this.controls.camera)),this.changed=!1}},{key:"click",value:function(e,t){var n=this.picker.pick(e,t,this.pickingScene,this.controls.camera);return this.select(n)}},{key:"select",value:function(e){this.picker.id!==e&&this.picker.select(e);var t=this.picker.layerAndOidForId(e);return console.log(t,this.picker.selected),t?this.matlib.setSelectedID(this.picker.selected):this.matlib.setSelectedID([-1,-1,-1,-1]),this.changed=!0,t}},{key:"setPointSize",value:function(e){this.matlib.setPointSize(e),this.changed=!0}},{key:"setLineWidth",value:function(e){this.matlib.setLineWidth(e),this.changed=!0}},{key:"updateHelper",value:function(){this.helper.update(),this.updateShadows=!1,this.changed=!0}},{key:"resize",value:function(e,t){this.controls.resize(e,t),this.renderer.setSize(e,t),this.changed=!0}}]),e}(),Yn=window.location.host;var $n=function(){function e(t,n){Object(ue.a)(this,e),this.renderer=void 0,this.project=void 0,this.keymap=void 0,this.showMetaCallback=void 0,this.closeMetaCallback=void 0,this.updateCompasCallback=void 0,this.updateTimeCallback=void 0,this.updateSelection=void 0,this.clickTime=void 0,this.selectingRegion=void 0,this.selectingRegionDown=void 0,this.renderer=t,this.project=n,this.keymap={},this.clickTime=0,this.selectingRegion=!1,this.selectingRegionDown=!1}return Object(fe.a)(e,[{key:"select",value:function(e){this.renderer.select(e)}},{key:"selectCoord",value:function(e,t){var n=this;if(!this.selectingRegion){var i=this.renderer.click(e,t);i&&x.post(U,{project:this.project.name,layer:i.layer,oid:i.oid}).then((function(e){var t=e.data;t.oid=i.oid,t.layer=i.layer,n.showMetaCallback&&n.showMetaCallback(e.data)}))}}},{key:"mouseDown",value:function(e,t,n,i){this.clickTime=n,this.selectingRegion&&(this.renderer.selector.clear(),this.renderer.selector.select(e,t),this.selectingRegionDown=!0,this.renderer.changed=!0)}},{key:"mouseOver",value:function(e,t){this.selectingRegion&&this.selectingRegionDown&&(this.renderer.selector.select(e,t),this.updateSelection&&this.renderer.selector.region&&this.updateSelection(this.renderer.selector.region),this.renderer.changed=!0)}},{key:"mouseUp",value:function(e,t,n,i){n-this.clickTime<200&&(0===i?this.selectCoord(e,t):2===i&&this.closeMetaCallback&&this.closeMetaCallback()),this.selectingRegion&&(this.selectingRegionDown=!1,this.updateSelection&&this.renderer.selector.region&&this.updateSelection(this.renderer.selector.region)),this.clickTime=n}},{key:"hasTimeData",get:function(){return this.renderer.timeline.hasData}},{key:"keyDown",value:function(e){console.log("key down",e),this.keymap[e]=!0}},{key:"keyUp",value:function(e){console.log("key up",e),this.keymap[e]=!1}},{key:"actions",value:function(){this.keymap.KeyU&&(this.renderer.updateHelper(),this.keymap.KeyU=!1),this.updateTimeCallback&&this.updateTimeCallback(this.renderer.timeline.time,this.renderer.timeline.start,this.renderer.timeline.end)}},{key:"swapCamera",value:function(){this.renderer.controls.swap(),this.renderer.changed=!0}},{key:"disableCamera",value:function(){this.renderer.controls.controls.enabled=!1,this.renderer.controls.controls.update()}},{key:"enableCamera",value:function(){this.renderer.controls.controls.enabled=!0,this.renderer.controls.controls.update()}},{key:"startSelectingRegion",value:function(){this.selectingRegion=!0}},{key:"endSelectingRegion",value:function(){this.selectingRegion=!1,this.renderer.selector.clear()}},{key:"useOrthogonalProjection",value:function(){this.renderer.controls.useOrtho(),this.renderer.changed=!0}},{key:"resize",value:function(e,t){this.renderer.resize(e,t)}},{key:"zoomIn",value:function(){this.renderer.controls.zoomIn(10),this.renderer.changed=!0}},{key:"zoomOut",value:function(){this.renderer.controls.zoomOut(10),this.renderer.changed=!0}},{key:"setPointSize",value:function(e){this.renderer.setPointSize(e)}},{key:"setLineWidth",value:function(e){this.renderer.setLineWidth(e)}},{key:"updateVisibleRadius",value:function(e){this.project.updateVisibleRadius(e)}},{key:"setVisibleRadius",value:function(e){this.project.setVisibleRadius(e)}},{key:"useCache",value:function(e){this.project.useCache(e)}},{key:"applyStyle",value:function(e){this.project.applyStyle(e)}},{key:"useShadows",value:function(e){e?this.renderer.enableShadows():this.renderer.disableShadows()}},{key:"setTime",value:function(e){this.renderer.timeline.time=e}},{key:"setPlay",value:function(e){this.renderer.timeline.play=e}},{key:"getPlay",value:function(){return this.renderer.timeline.play}},{key:"setSpeed",value:function(e){this.renderer.timeline.speed=e}},{key:"getSpeed",value:function(){return this.renderer.timeline.speed}}]),e}(),Kn=function(){function e(t,n){var i=this;Object(ue.a)(this,e),this.project_name=void 0,this.canvas=void 0,this.renderer=void 0,this.selector=void 0,this.project=void 0,this.controls=void 0,this.project_name=t,this.canvas=n,this.renderer=new Xn(this.canvas,(function(){i.controls&&i.controls.actions()})),this.selector=new Hn(this.renderer)}return Object(fe.a)(e,[{key:"init",value:function(){var e=this;this.project=new _n(this.project_name,this.renderer),this.controls=new $n(this.renderer,this.project),this.renderer.controls.controls.addEventListener("change",(function(){return e.moved()}))}},{key:"moved",value:function(){var e;this.project.updateVisibleRadius(this.renderer.controls.target),this.renderer.compas.update(null===(e=this.controls)||void 0===e?void 0:e.updateCompasCallback),this.renderer.changed=!0}},{key:"exit",value:function(){}}]),e}(),Jn=n(356),qn=n(357),Zn=n(358),Qn=n(359),ei=n(360),ti=n(350);function ni(e){var t=e.engine,n=Object(i.useState)(0),a=Object(u.a)(n,2),r=a[0],s=a[1],o=function(e){var t=-180*e/Math.PI;s(t)};Object(i.useEffect)((function(){t&&t.controls&&(t.controls.updateCompasCallback=o)}),[t]);return Object(we.jsx)(qe.a,{content:"Reset view rotation",children:Object(we.jsx)(ft.a,{icon:Object(we.jsx)(ti.a,{style:{transform:"rotate(".concat(r,"deg)")}}),appearance:"minimal",onClick:function(){null===t||void 0===t||t.renderer.controls.topView()}})})}var ii=n(351),ai=n(352);function ri(e){var t=e.engine,n=e.visible,a=Object(i.useState)([]),r=Object(u.a)(a,2),s=r[0],o=r[1];Object(i.useEffect)((function(){t&&o(t.project.layers.map((function(e){return e.visible})))}),[t,n]);return Object(we.jsx)(we.Fragment,{children:n&&Object(we.jsxs)(we.Fragment,{children:[Object(we.jsx)(me.a,{size:300,className:"title",children:"Layers"}),Object(we.jsx)(f.a,{className:"layers",children:null===t||void 0===t?void 0:t.project.layers.map((function(e,n){return Object(we.jsxs)(f.a,{className:"layer",onClick:function(){return e=n,void(t&&(t.project.layers[e].visible=!s[e],o(s.map((function(t,n){return n===e?!t:t})))));var e},children:[s[n]?Object(we.jsx)($e.a,{icon:ii.a}):Object(we.jsx)($e.a,{icon:ai.a}),Object(we.jsx)(f.a,{className:"layerName",children:e.name})]},e.name)}))})]})})}function si(e){var t=e.engine,n=e.visible,a=Object(i.useState)(void 0),r=Object(u.a)(a,2),s=r[0],o=r[1];Object(i.useEffect)((function(){t&&t.controls&&(t.controls.updateSelection=o,n||o(void 0))}),[t,n]);var c=function(e){return e.toFixed(2)};return Object(we.jsx)(we.Fragment,{children:n&&Object(we.jsxs)(we.Fragment,{children:[Object(we.jsx)(me.a,{size:300,className:"title",children:"Selection"}),Object(we.jsxs)(f.a,{className:"selector",children:[Object(we.jsx)(zt.a,{className:"field",size:300,children:"Selecting region with locked orthographic camera. If you wish to reposition your view, please close this menu first."}),s?Object(we.jsxs)(we.Fragment,{children:[Object(we.jsxs)(f.a,{className:"field",children:[Object(we.jsx)(me.a,{size:100,children:"Start coordinate"}),Object(we.jsxs)(f.a,{className:"values",children:[c(s.start[0])," ",c(s.start[1])]})]}),Object(we.jsxs)(f.a,{className:"field",children:[Object(we.jsx)(me.a,{size:100,children:"End coordinate"}),Object(we.jsxs)(f.a,{className:"values",children:[c(s.end[0])," ",c(s.end[1])]})]}),Object(we.jsxs)(f.a,{className:"field",children:[Object(we.jsx)(me.a,{size:100,children:"Area Size (coordinate diff)"}),Object(we.jsxs)(f.a,{className:"values",children:[c(s.size[0])," ",c(s.size[1])]})]}),Object(we.jsxs)(f.a,{className:"field buttons",children:[Object(we.jsx)(v.a,{marginRight:4,onClick:function(){t&&s&&x.post(de,{project:t.project.name,start:s.start,end:s.end}).then((function(e){window.open(z+e.data.exportID,"_blank")})).catch((function(e){d.b.error("Failed to export OBJ, try again later")}))},children:"Export OBJ"}),Object(we.jsx)(v.a,{onClick:function(){t&&s&&x.post(he,{project:t.project.name,start:s.start,end:s.end}).then((function(e){window.open(z+e.data.exportID,"_blank")})).catch((function(e){d.b.error("Failed to export LEGO, try again later")}))},children:"Export Lego"})]})]}):Object(we.jsx)(me.a,{size:100,children:"No selection"})]})]})})}var oi=n(353);function ci(e){var t=e.engine,n=e.visible,a=Object(i.useState)(2e3),r=Object(u.a)(a,2),s=r[0],o=r[1],c=Object(i.useState)(1),l=Object(u.a)(c,2),d=l[0],h=l[1],m=Object(i.useState)(5),p=Object(u.a)(m,2),v=p[0],g=p[1],b=Object(i.useState)(!1),j=Object(u.a)(b,2),y=j[0],x=j[1],O=Object(i.useState)(!1),_=Object(u.a)(O,2),w=_[0],S=_[1];Object(i.useEffect)((function(){t&&Promise.resolve(1).then((function(){var e;return null===(e=t.controls)||void 0===e?void 0:e.setVisibleRadius(s)}))}),[t,s]),Object(i.useEffect)((function(){t&&Promise.resolve(1).then((function(){var e;null===(e=t.controls)||void 0===e||e.useShadows(y)}))}),[t,y]),Object(i.useEffect)((function(){t&&Promise.resolve(1).then((function(){var e;null===(e=t.controls)||void 0===e||e.useCache(w)}))}),[t,w]),Object(i.useEffect)((function(){t&&Promise.resolve(1).then((function(){var e;return null===(e=t.controls)||void 0===e?void 0:e.setPointSize(d)}))}),[t,d]),Object(i.useEffect)((function(){t&&Promise.resolve(1).then((function(){var e;return null===(e=t.controls)||void 0===e?void 0:e.setLineWidth(v)}))}),[t,v]);return Object(we.jsx)(we.Fragment,{children:n&&Object(we.jsxs)(we.Fragment,{children:[Object(we.jsx)(me.a,{size:300,className:"title",children:"Settings"}),Object(we.jsxs)(f.a,{className:"settings",children:[Object(we.jsxs)(f.a,{className:"setting",children:[Object(we.jsxs)(me.a,{size:100,children:["Visible Radius: ",s]}),Object(we.jsx)(f.a,{className:"controls",children:Object(we.jsx)("input",{type:"range",min:0,max:2e4,step:1e3,defaultValue:s,onChange:function(e){return function(e){var t=parseInt(e);t!==s&&o(t)}(e.target.value)}})})]}),Object(we.jsxs)(f.a,{className:"setting",children:[Object(we.jsxs)(me.a,{size:100,children:["Point Size: ",d]}),Object(we.jsx)(f.a,{className:"controls",children:Object(we.jsx)("input",{type:"range",min:0,max:5,step:.1,defaultValue:d,onChange:function(e){return function(e){var t=parseFloat(e);t!==d&&h(t)}(e.target.value)}})})]}),Object(we.jsxs)(f.a,{className:"setting",children:[Object(we.jsxs)(me.a,{size:100,children:["Line width: ",v]}),Object(we.jsx)(f.a,{className:"controls",children:Object(we.jsx)("input",{type:"range",min:0,max:10,step:.1,defaultValue:v,onChange:function(e){return function(e){var t=parseFloat(e);t!==d&&g(t)}(e.target.value)}})})]}),Object(we.jsx)(f.a,{className:"setting",children:Object(we.jsxs)(f.a,{className:"inlineControls",children:[Object(we.jsxs)(me.a,{size:100,children:["Shadows: ",y?"on":"off"]}),Object(we.jsx)(oi.a,{checked:y,onChange:function(e){return function(e){t&&x(e.target.checked)}(e)}})]})}),Object(we.jsx)(f.a,{className:"setting",children:Object(we.jsxs)(f.a,{className:"inlineControls",children:[Object(we.jsxs)(me.a,{size:100,children:["Caching Data: ",w?"on":"off"]}),Object(we.jsx)(oi.a,{checked:w,onChange:function(e){return function(e){t&&S(e.target.checked)}(e)}})]})})]})]})})}function li(e){var t=e.engine,n=e.visible,a=Object(i.useState)(void 0),r=Object(u.a)(a,2),s=r[0],o=r[1],c=Object(i.useState)(void 0),l=Object(u.a)(c,2),d=l[0],h=l[1],m=function(e){null!=t&&(o(e),e?(t.project.applyStyle(e),x.get("".concat(se).concat(t.project.name,"/styles/").concat(e,"_legend.mss.json"),{headers:{"Cache-Control":"no-cache",Pragma:"no-cache",Expires:"0"}}).then((function(e){h(e.data)})).catch((function(){h(void 0)}))):(t.project.clearStyle(),h(void 0)))};return Object(i.useEffect)((function(){t&&o(t.project.usedStyle)}),[t]),Object(we.jsx)(we.Fragment,{children:n&&Object(we.jsxs)(we.Fragment,{children:[Object(we.jsx)(me.a,{size:300,className:"title",children:"Styles"}),Object(we.jsxs)(f.a,{className:"styles",children:[null===t||void 0===t?void 0:t.project.styles.map((function(e){return Object(we.jsx)(f.a,{onClick:function(){return m(e)},className:"style ".concat(s===e?"selected":""),children:e},e)})),Object(we.jsx)(f.a,{onClick:function(){return m()},className:"style ".concat(void 0===s?"selected":""),children:"No Style"})]}),Object(we.jsx)(me.a,{size:300,className:"title",children:"Legend"}),Object(we.jsx)(f.a,{className:"legend",children:d?Object.keys(d).map((function(e){return Object(we.jsxs)(f.a,{className:"legend-item ".concat(d[e].range&&"vertical"),children:[Object(we.jsx)(f.a,{className:"legend-name",children:e}),d[e].range?Object(we.jsxs)(f.a,{className:"legend-colormap-cont",children:[Object(we.jsx)(f.a,{className:"legend-colormap",style:{backgroundImage:"linear-gradient(to right, ".concat(d[e].colors.map((function(e){return"rgb(".concat(e[0],", ").concat(e[1],", ").concat(e[2],")")})).join(", "),")")}}),Object(we.jsxs)(f.a,{className:"legend-range",children:[Object(we.jsx)(f.a,{children:d[e].range[0]}),Object(we.jsx)(f.a,{children:d[e].range[1]})]})]}):Object(we.jsx)(f.a,{className:"legend-color",style:{backgroundColor:"rgb(".concat(d[e][0],", ").concat(d[e][1],", ").concat(d[e][2],")")}})]},e)})):Object(we.jsx)(f.a,{className:"legend-item",children:"No Legend"})})]})})}var di,hi,ui=n(354),fi=n(355);function mi(e){var t,n=e.engine,a=e.visible,r=Object(i.useState)(0),s=Object(u.a)(r,2),o=s[0],c=s[1],l=Object(i.useState)(0),d=Object(u.a)(l,2),h=d[0],m=d[1],p=Object(i.useState)(!1),g=Object(u.a)(p,2),b=g[0],j=g[1],y=Object(i.useState)(0),x=Object(u.a)(y,2),O=x[0],_=x[1],w=Object(i.useState)(1),S=Object(u.a)(w,2),k=S[0],C=S[1],L=Object(i.useRef)(null),M=function(e,t,n){c(Math.floor(e)),m(t),_(n)};Object(i.useEffect)((function(){n&&n.controls&&n.controls.setSpeed(k)}),[k,n]),Object(i.useEffect)((function(){n&&n.controls&&(n.controls.updateTimeCallback=M,j(n.controls.getPlay()),C(n.controls.getSpeed()))}),[n]);var D=function(e){return e.toString().padStart(2,"0")};return Object(we.jsx)(we.Fragment,{children:a&&((null===n||void 0===n||null===(t=n.controls)||void 0===t?void 0:t.hasTimeData)?Object(we.jsxs)(we.Fragment,{children:[Object(we.jsx)(me.a,{size:300,className:"title",children:"Timeline"}),Object(we.jsx)(f.a,{className:"timeline",children:Object(we.jsxs)(f.a,{className:"setting",children:[Object(we.jsxs)(f.a,{display:"flex",flexDirection:"row",justifyContent:"center",children:[Object(we.jsxs)(f.a,{flexGrow:"1",children:[Object(we.jsx)(me.a,{size:100,children:"Time"}),Object(we.jsx)(me.a,{size:400,children:D(Math.floor(o/3600))+":"+D(Math.floor(o%3600/60))+":"+D(Math.floor(o%60))})]}),Object(we.jsxs)(f.a,{children:[Object(we.jsx)(ft.a,{icon:b?ui.a:fi.a,appearance:"minimal",onClick:function(){n&&n.controls&&(n.controls.setPlay(!b),j(!b))}}),Object(we.jsx)(ve.a,{title:"Select speed",options:[.25,.5,1,2,5,10,20,30,60].map((function(e){return{label:"".concat(e,"\xd7"),value:e}})),selected:"".concat(k,"\xd7"),hasFilter:!1,onSelect:function(e){return C(e.value)},children:Object(we.jsx)(v.a,{appearance:"minimal",children:"Speed ".concat(k,"\xd7")})})]})]}),Object(we.jsx)(f.a,{className:"controls",children:Object(we.jsx)(f.a,{className:"timescroll",children:Object(we.jsx)("input",{ref:L,type:"range",min:h,max:O,step:1,value:o,onChange:function(){return function(){var e,t=null===(e=L.current)||void 0===e?void 0:e.value;if(n&&n.controls&&t){var i=parseFloat(t);isNaN(i)||n.controls.setTime(i)}}()}})})})]})})]}):Object(we.jsx)(we.Fragment,{children:Object(we.jsx)(me.a,{size:300,paddingBottom:32,className:"title",children:"No dynamic data"})}))})}function pi(e){var t=e.children,n=e.isShown;return Object(we.jsx)(f.a,{className:"viewMenu",display:n?"block":"none",children:t})}function vi(e){var t=e.engine,n=Object(i.useState)(!1),a=Object(u.a)(n,2),r=a[0],s=a[1],o=Object(i.useState)(hi.D2),c=Object(u.a)(o,2),l=c[0],d=c[1],h=Object(i.useState)(di.None),m=Object(u.a)(h,2),p=m[0],g=m[1],b=function(e){r&&e===p?(g(-1),s(!1)):(g(e),s(!0))};return Object(i.useEffect)((function(){if(t){var e,n,i,a,r;if(p===di.Selector)null===(e=t.controls)||void 0===e||e.useOrthogonalProjection(),d(hi.D2),null===(n=t.controls)||void 0===n||n.disableCamera(),null===(i=t.controls)||void 0===i||i.startSelectingRegion();if(p!==di.Selector)null===(a=t.controls)||void 0===a||a.enableCamera(),null===(r=t.controls)||void 0===r||r.endSelectingRegion()}}),[t,p]),Object(we.jsxs)(f.a,{className:"viewControls",children:[Object(we.jsxs)(f.a,{className:"controlBar",children:[Object(we.jsx)(qe.a,{content:"Layers",children:Object(we.jsx)(ft.a,{icon:pt.a,className:p===di.Layers&&r?"active":"",appearance:"minimal",onClick:function(){return b(di.Layers)}})}),Object(we.jsx)(qe.a,{content:"Styles",children:Object(we.jsx)(ft.a,{icon:nt.a,className:p===di.Styles&&r?"active":"",appearance:"minimal",onClick:function(){return b(di.Styles)}})}),Object(we.jsx)(qe.a,{content:"Settings",children:Object(we.jsx)(ft.a,{icon:Jn.a,className:p===di.Settings&&r?"active":"",appearance:"minimal",onClick:function(){return b(di.Settings)}})}),Object(we.jsx)(qe.a,{content:"Timeline",children:Object(we.jsx)(ft.a,{icon:qn.a,className:p===di.Timeline&&r?"active":"",appearance:"minimal",onClick:function(){return b(di.Timeline)}})}),Object(we.jsx)(qe.a,{content:"Export region",children:Object(we.jsx)(ft.a,{icon:Zn.a,className:p===di.Selector&&r?"active":"",appearance:"minimal",onClick:function(){return b(di.Selector)}})}),Object(we.jsx)(qe.a,{content:"Switch between 2D/3D view",children:Object(we.jsx)(v.a,{appearance:"minimal",id:"perspectiveControl",onClick:function(){var e;t&&p!==di.Selector&&(null===(e=t.controls)||void 0===e||e.swapCamera(),d(l===hi.D2?hi.D3:hi.D2))},disabled:p===di.Selector,children:l===hi.D2?"3D":"2D"})}),Object(we.jsx)(qe.a,{content:"Zoom in",children:Object(we.jsx)(ft.a,{icon:Qn.a,appearance:"minimal",onClick:function(){var e;null===t||void 0===t||null===(e=t.controls)||void 0===e||e.zoomIn()}})}),Object(we.jsx)(qe.a,{content:"Zoom out",children:Object(we.jsx)(ft.a,{icon:ei.a,appearance:"minimal",onClick:function(){var e;null===t||void 0===t||null===(e=t.controls)||void 0===e||e.zoomOut()}})}),Object(we.jsx)(ni,{engine:t})]}),Object(we.jsxs)(pi,{isShown:r,onClose:function(){return b(p)},children:[Object(we.jsx)(ri,{engine:t,visible:p===di.Layers}),Object(we.jsx)(li,{engine:t,visible:p===di.Styles}),Object(we.jsx)(ci,{engine:t,visible:p===di.Settings}),Object(we.jsx)(mi,{engine:t,visible:p===di.Timeline}),Object(we.jsx)(si,{engine:t,visible:p===di.Selector})]})]})}function gi(e){var t=e.engine,n=Object(i.useState)({}),a=Object(u.a)(n,2),r=a[0],s=a[1],o=Object(i.useState)(!1),c=Object(u.a)(o,2),l=c[0],d=c[1],h=function(e){s(e),d(!0)},m=Object(i.useCallback)((function(){var e;null===t||void 0===t||null===(e=t.controls)||void 0===e||e.select(-1),d(!1)}),[null===t||void 0===t?void 0:t.controls]);return Object(i.useEffect)((function(){t&&t.controls&&(t.controls.showMetaCallback=h,t.controls.closeMetaCallback=m)}),[t,null===t||void 0===t?void 0:t.controls,m]),Object(we.jsx)(St.a,{title:"Metadata",hasCancel:!1,hasFooter:!1,width:"auto",isShown:l,onCloseComplete:m,onCancel:m,children:Object(we.jsx)(f.a,{className:"meta",children:Object.keys(r).map((function(e){return Object(we.jsxs)(f.a,{className:"attribute",children:[Object(we.jsxs)(zt.a,{className:"key",children:[e,":"]})," ",Object(we.jsx)(zt.a,{className:"value",children:r[e]})]},e)}))})})}function bi(){var e=Object(l.h)().project_name,t=function(){var e=Object(i.useState)([0,0]),t=Object(u.a)(e,2),n=t[0],a=t[1];return Object(i.useLayoutEffect)((function(){function e(){a([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",e),e(),function(){return window.removeEventListener("resize",e)}}),[]),n}(),n=Object(u.a)(t,2),a=n[0],r=n[1],s=Object(i.useState)(void 0),o=Object(u.a)(s,2),c=o[0],d=o[1],h=Object(i.createRef)();return Object(i.useEffect)((function(){if(null!=h.current){var t=new Kn(e,h.current);return t.init(),d(t),t.renderer.frame(),function(){window.location.reload()}}}),[e]),Object(i.useEffect)((function(){var e;null!=c&&(null===(e=c.controls)||void 0===e||e.resize(a,r))}),[a,r,c]),Object(we.jsxs)(f.a,{className:"canvasAnchor",children:[Object(we.jsx)(gi,{engine:c}),Object(we.jsx)(vi,{engine:c}),Object(we.jsx)("canvas",{ref:h,onMouseDown:function(e){var t;c&&(null===(t=c.controls)||void 0===t||t.mouseDown(e.clientX,e.clientY,e.timeStamp,e.button))},onMouseUp:function(e){var t;c&&(null===(t=c.controls)||void 0===t||t.mouseUp(e.clientX,e.clientY,e.timeStamp,e.button))},onMouseMove:function(e){var t;c&&(null===(t=c.controls)||void 0===t||t.mouseOver(e.clientX,e.clientY))},onKeyDown:function(e){var t;!e.repeat&&c&&(null===(t=c.controls)||void 0===t||t.keyDown(e.code))},onKeyUp:function(e){var t;!e.repeat&&c&&(null===(t=c.controls)||void 0===t||t.keyUp(e.code))},tabIndex:0,children:"Your browser does not support HTML5 canvas"}),Object(we.jsx)(f.a,{id:"viewStatusBar",children:"Status"})]})}!function(e){e[e.None=0]="None",e[e.Layers=1]="Layers",e[e.Styles=2]="Styles",e[e.Settings=3]="Settings",e[e.Timeline=4]="Timeline",e[e.Selector=5]="Selector"}(di||(di={})),function(e){e[e.D2=0]="D2",e[e.D3=1]="D3"}(hi||(hi={}));n(295);function ji(){return Object(we.jsxs)(c.a,{children:[Object(we.jsx)(d.a,{position:"top-center",autoClose:5e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0}),Object(we.jsxs)(l.d,{children:[Object(we.jsx)(l.b,{exact:!0,path:["/"],children:Object(we.jsx)(l.a,{to:"/app"})}),Object(we.jsx)(l.b,{path:E,children:Object(we.jsx)(Ne,{})}),Object(we.jsx)(l.b,{path:N,children:Object(we.jsx)(Ye,{children:Object(we.jsx)(Qe,{})})}),Object(we.jsx)(l.b,{path:C,children:Object(we.jsx)(Ye,{children:Object(we.jsx)(At,{})})}),Object(we.jsx)(l.b,{path:S,children:Object(we.jsx)(Ye,{children:Object(we.jsx)(_t,{})})}),Object(we.jsx)(l.b,{path:M,children:Object(we.jsx)(Ye,{children:Object(we.jsx)(Et,{})})}),Object(we.jsx)(l.b,{path:_,children:Object(we.jsx)(bi,{})}),Object(we.jsx)(l.b,{path:O,children:Object(we.jsx)(Ge,{})})]})]})}s.a.render(Object(we.jsx)(a.a.StrictMode,{children:Object(we.jsx)(o.a.Provider,{value:{className:"react-icons"},children:Object(we.jsx)(ji,{})})}),document.getElementById("root"))}},[[296,1,2]]]);
//# sourceMappingURL=main.9781246d.chunk.js.map